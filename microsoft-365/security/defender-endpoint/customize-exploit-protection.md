---
title: 自訂利用保護
keywords: Exploit protection，緩解，enable，powershell，dep，cfg，emet，aslr
description: 您可以使用 Windows 安全性應用程式或 PowerShell，啟用或停用 exploit protection 所使用的特定緩解。 您也可以審核緩解及匯出設定。
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
audience: ITPro
author: dansimp
ms.author: dansimp
ms.reviewer: ''
manager: dansimp
ms.technology: mde
ms.openlocfilehash: 3337389df045775f8a31417894ee1ecbac9f1ae5
ms.sourcegitcommit: 6e5c00f84b5201422aed094f2697016407df8fc2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/02/2021
ms.locfileid: "51570957"
---
# <a name="customize-exploit-protection"></a>自訂利用保護

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**適用於：**
- [適用於端點的 Microsoft Defender](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

>想要體驗 Defender for Endpoint？ [註冊免費試用版。](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-assignaccess-abovefoldlink)


Exploit protection 會在作業系統進程和個別應用程式上自動套用許多利用漏洞緩解技術。

在個別裝置上使用 Windows 安全性應用程式來設定這些設定。 然後，將設定匯出為 XML 檔案，讓您可以部署至其他裝置。 使用群組原則將 XML 檔案同時發佈至多個裝置。 您也可以使用 PowerShell 設定緩解。

本文列出可在 exploit protection 中使用的每個緩解措施。 它會指出是否可以將緩解措施套用到整個系統或個別應用程式，並提供緩解措施運作方式的簡短描述。

同時也說明如何使用 Windows 安全性、PowerShell 及行動裝置管理 (MDM) 設定服務提供者 (Csp) 來啟用或設定緩解。 這是建立設定的第一個步驟，您可以在網路上部署。 接下來的步驟包括 [對多個裝置產生、匯出、匯入和部署](import-export-exploit-protection-emet-xml.md)設定。

> [!WARNING]
> 某些安全性緩解技術可能會對某些應用程式產生相容性問題。 在整個實際執行環境中或網路的其餘部分部署設定之前，您應該使用「 [審計模式](evaluate-exploit-protection.md) 」來測試所有目標使用案例中的 exploit protection。

## <a name="exploit-protection-mitigations"></a>Exploit protection 緩解

所有的緩解可以設定為個別應用程式。 有些遷移也可以套用至作業系統層級。

您可以將每個緩解措施設定為 [開啟]、[關閉] 或 [其預設值]。 有些遷移具有表格描述中所指出的其他選項。

預設值在每個緩解措施的 [ **使用預設** 值] 選項中，永遠會以括弧括住。 在下列範例中，資料執行防護的預設值為「開啟」。

每個緩解設定的 **使用預設** 設定表示我們為家用使用者日常使用提供基本層級保護的建議。 企業部署應該考慮其個人需求所需的保護，而且可能需要修改離預設值的設定。

針對每個緩解工作相關聯的 PowerShell Cmdlet，請參閱本文底部的 [PowerShell 參考資料表](#cmdlets-table) 。

| 風險降低 | 說明 | 可套用至 | 可使用的審計模式 |
| ---------- | ----------- | ----------------- | -------------------- |
| 控制流量防護 (CFG)  | 確保間接通話的控制流程完整性。 可以選擇性地抑制匯出，並使用嚴格的 CFG。 | 系統和應用層級 | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 資料執行防護 (DEP)  | 禁止從僅限資料的記憶體頁面（如堆和堆疊）執行程式碼。 僅適用于32位 (x86) 應用程式，可針對所有其他架構永久啟用。 可以選擇啟用 ATL Thunk 模擬。 | 系統和應用層級  | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
|  (強制的 ASLR 中強制執行影像的隨機化)  | 強制重新安置未以/DYNAMICBASE. 編譯的影像 可以選擇性地載入不會重新安置資訊的影像。 | 系統和應用層級  | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 在 (自下而上的 ASLR) 隨機化記憶體分配 | 虛擬記憶體分配的 Randomizes 位置。 它包含系統結構堆、堆疊、TEBs 及 PEBs。 您可以選擇性地使用64位程式的更大隨機變化。 | 系統和應用層級 | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 驗證例外鏈 (SEHOP)  | 在例外狀況派遣期間確保例外狀況鏈的完整性。 僅可設定32位 (x86) 應用程式。 | 系統和應用層級  | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 驗證堆完整性 | 在偵測到堆損毀時終止進程。 | 系統和應用層級  | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 任意代碼防護 (ACG)  | 防止引入未影像備份的可執行程式碼，並防止修改程式字碼頁。 可以選擇性地允許執行緒自願退出，並且允許遠端降級 (僅可設定 PowerShell) 。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 封鎖低誠信影像 | 避免載入標示為低完整性的影像。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes)|
| 封鎖遠端映射 | 防止從遠端裝置載入影像。 | 僅限應用層級 | ![核取記號 no] (/security/defender-endpoint/images/svg/check-no |
| 封鎖不受信任的字體 | 避免載入任何未安裝在 [系統字體] 目錄中的 GDI 式字型，尤其是網頁中的字型。 | 僅限應用層級 | ！包含[核取記號 yes](/security/defender-endpoint/images/svg/check-yes) |
| 程式碼整體性防護 | 限制載入由 Microsoft、WHQL 或更高版本所簽署的影像。 可以選擇性地允許 Microsoft Store 簽署的影像。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 停用分機點 | 停用各種可允許 DLL 插入所有程式的擴充機制，例如 AppInit Dll、視窗掛鉤及 Winsock 服務提供者。 | 僅限應用層級 | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 停用 Win32k 系統通話 | 防止應用程式使用 Win32k 系統呼叫表。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 不允許子流程 | 阻止應用程式建立子流程。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 匯出位址篩選 (EAF)  | 偵測惡意程式碼解決的危險作業。 可以選擇性地驗證受攻擊常用的模組存取。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 匯入位址篩選 (IAF)  | 偵測惡意程式碼解決的危險作業。 | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 模擬執行 (SimExec)  | 確保對機密 APIs 的呼叫回到合法來電者。 僅可設定32位 (x86) 應用程式。 不相容 ACG | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 驗證 API 呼叫 (CallerCheck)  | 確保合法的來電者會呼叫敏感 APIs。 僅可設定32位 (x86) 應用程式。 不相容 ACG | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |
| 驗證控制碼使用狀況 | 會導致任何不正確控點參照引發例外狀況。 | 僅限應用層級 | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 驗證映射相依性完整性 | 強制執行 Windows 映像相依性載入的代碼簽署。 | 僅限應用層級 | ![核取記號否](/security/defender-endpoint/images/svg/check-no) |
| 驗證堆疊整體性 (StackPivot)  | 確保堆疊未重新導向機密 APIs。 不相容 ACG | 僅限應用層級 | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) |


> [!IMPORTANT]
> 如果您將應用程式新增至 [ **程式設定** ] 區段中，並在其中設定個別的緩解設定，則會在 [ **系統設定** ] 區段中所指定的相同緩解措施的設定之上進行設定。 下列矩陣和範例可協助說明預設值的運作方式：
>
>
> | 啟用于 **程式設定** | 在 [**系統設定**] 中啟用 | 行為 |
> | ------------------------------- | ------------------------------ | -------- |
> | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) | ![核取記號否](/security/defender-endpoint/images/svg/check-no) | 如 **程式設定** 中所定義 |
> | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) | 如 **程式設定** 中所定義 |
> | ![核取記號否](/security/defender-endpoint/images/svg/check-no) | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) | 如 **系統設定** 中所定義 |
> | ![核取記號否](/security/defender-endpoint/images/svg/check-no) | ![核取記號是](/security/defender-endpoint/images/svg/check-yes) | **使用預設** 選項中定義的預設值 |
>
>
>
> * **範例 1**
>
>    Mikael 會在 [**系統設定**] 區段中設定 **資料執行防護 (DEP)** **預設為關閉**。
>
>    Mikael 然後將 app *test.exe* 新增至 [ **程式設定** ] 區段。 在該應用程式的選項中，在 [ **資料執行防護 (DEP)**] 底下，啟用 [覆 **寫系統設定** ] 選項，並將開關設定為 [ **開啟**]。 [ **程式設定** ] 區段中沒有列出任何其他應用程式。
>
>    結果會是，只會對 *test.exe* 啟用 DEP。 所有其他應用程式都不會套用 DEP。
>
>
> * **範例 2**
>
>    Josie 會在 [**系統設定**] 區段中設定 **資料執行防護 (DEP)** **預設為關閉**。
>
>    Josie 然後將 app *test.exe* 新增至 [ **程式設定** ] 區段。 在該應用程式的選項中，在 [ **資料執行防護 (DEP)**] 底下，啟用 [覆 **寫系統設定** ] 選項，並將開關設定為 [ **開啟**]。
>
>    Josie 也會將應用程式 *miles.exe* 新增至 [ **程式設定** ] 區段，並將 **控制流程防護 (CFG)** 設定為 [ **開啟**]。 她沒有為該應用程式啟用 DEP 或任何其他緩解措施的覆 **寫系統設定** 選項。
>
>    其結果將會啟用 *test.exe* 的 DEP。 任何其他應用程式（包括 *miles.exe*）都不會啟用 DEP。 將為 *miles.exe* 啟用 CFG。

> [!NOTE]
> 如果您已發現本文中的任何問題，您可以直接向 Windows Server/Windows 用戶端合作夥伴報告問題，或為您的國家/地區使用 Microsoft 技術支援號碼。

### <a name="configure-system-level-mitigations-with-the-windows-security-app"></a>使用 Windows 安全性應用程式設定系統層級的緩解

1. 選取工作列中的盾牌圖示，或搜尋 **Defender** 的 [開始] 功能表，以開啟 [Windows 安全性] 應用程式。

2. 在左功能表列上選取 [ **app & browser control** (或 app 圖示) 然後選取 [利用方式 **保護**]。

3. 在 [ **系統設定** ] 區段下，找出您要設定的緩解措施，然後選取下列其中一項。 未在 [ **程式設定** ] 區段中個別設定的應用程式，將會使用這裡設定的設定：
   * **依預設，在** 應用程式特有的 **程式設定** 區段中，對於未具備此緩解集的應用程式 *啟用* 緩解功能
   * **預設關閉**-應用程式特定的 **程式設定** 區段中未啟用此緩解設定的應用程式會 *停用* 緩解。
   * **使用預設值**-根據 Windows 10 安裝所設定的預設設定，緩解已啟用或已停用;預設值 (開啟或 **關閉**) 會永遠 **在** 每個緩解的 **使用預設** 標籤旁指定

   > [!NOTE]
   > 變更某些設定時，您可能會看到 [使用者帳戶控制] 視窗。 輸入管理員認證以套用設定。

   變更某些設定可能需要重新開機。

4. 針對您要設定的所有系統層級緩解重複此步驟。

5. 移至 [ **程式設定** ] 區段，然後選擇您要套用緩解的應用程式：

   1. 如果您想要設定的應用程式已經列出，請選取它，然後選取 [**編輯**]
   2. 若未列出該應用程式，請在清單頂端選取 [ **新增程式] 以自訂** ，然後選擇您想要新增應用程式的方式：
      * 使用 [ **依程式名稱新增** ]，可對任何執行的程式套用具有該名稱的緩解。 您必須指定副檔名為的檔案。 您可以輸入完整的路徑，以限制僅限此位置的應用程式的緩解。
      * 使用 **[選擇確切** 的檔案路徑]，使用標準 Windows Explorer 檔案選擇器視窗來尋找並選取您想要的檔。

6. 選取應用程式之後，您會看到可套用的所有緩解措施清單。 若要啟用緩解，請選取核取方塊，然後將滑杆變更為 [ **開啟**]。 選取任何其他選項。 選擇 [ **審計** ] 只會在審計模式中套用緩解。 如果您需要重新開機此程式或應用程式，或需要重新開機 Windows，您將會收到通知。

7. 針對您要設定的所有應用程式和緩解措施，重複這些步驟。 當您設定好 **設定後，** 請選取 [套用]。

您現在可以將 [這些設定匯出為 XML](import-export-exploit-protection-emet-xml.md) 檔案，或繼續設定應用程式特定的緩解。

將設定匯出為 XML 檔案，可讓您將設定從一部裝置複製到其他裝置。

## <a name="powershell-reference"></a>PowerShell 參照

您可以使用 Windows 安全性應用程式來設定 Exploit protection，也可以使用 PowerShell Cmdlet。

不論您使用 PowerShell 還是 Windows 安全性，都必須套用最近修改的設定設定。 這表示如果您使用此應用程式來設定緩解，然後使用 PowerShell 設定相同的緩解，應用程式會更新以顯示您使用 PowerShell 所做的變更。 如果您想要再次使用此應用程式變更緩解，將會套用該變更。

> [!IMPORTANT]
> 透過「群組原則」部署至裝置的任何變更，都將會覆寫本機設定。 設定初始設定時，請使用未套用群組原則設定的裝置，以確保您的變更不會覆寫。

您可以使用 PowerShell 動詞 `Get` 或 `Set` Cmdlet `ProcessMitigation` 。 使用 `Get` 會列出已在裝置上啟用之任何緩解作業的目前設定狀態-新增 `-Name` Cmdlet 和應用程式 exe，以查看僅適用于該應用程式的緩解：

```PowerShell
Get-ProcessMitigation -Name processName.exe
```

> [!IMPORTANT]
> 尚未設定的系統層級緩解措施會顯示狀態 `NOTSET` 。
>
> 針對系統層級設定，表示已套用此 `NOTSET` 緩解的預設設定。
>
> 針對應用層級設定， `NOTSET` 表示將會套用緩解的系統層級設定。
>
> Windows 安全性會顯示每個系統層級緩解的預設設定。

使用 `Set` 以下列格式設定每項緩解措施：

```PowerShell
Set-ProcessMitigation -<scope> <app executable> -<action> <mitigation or options>,<mitigation or options>,<mitigation or options>
```

其中：

* \<Scope>:
    * `-Name` 表示應將緩解措施套用至特定的應用程式。 指定此旗標之後的應用程式可執行檔。
    * `-System` 若要指出應該在系統層級套用緩解
- \<Action>:
    * `-Enable` 啟用緩解
    * `-Disable` 停用緩解
* \<Mitigation>:
    * 在下一個 [緩解指令程式] [表格](#cmdlets-table) 中所定義的緩解的指令程式，以及任何 suboptions (以空格括住) 。 每個緩解都是以逗號分隔。

例如，若要啟用資料執行防護 (DEP) 以 ATL Thunk 模擬進行緩解，並針對資料夾 *C:\Apps\LOB\tests* 中稱為 *testing.exe* 的可執行檔加以緩解，並防止該可執行檔建立子進程，您可以使用下列命令：

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable DEP, EmulateAtlThunks, DisallowChildProcessCreation
```

> [!IMPORTANT]
> 以逗號分隔每個緩解選項。

如果您想要在系統層級應用 DEP，請使用下列命令：

```PowerShell
Set-Processmitigation -System -Enable DEP
```

若要停用緩解，您可以取代 `-Enable` `-Disable` 。 不過，對於應用層級的緩解，這只會對該應用程式強制停用緩解。

如果您需要將緩解措施還原回系統預設值，您也需要加入 `-Remove` Cmdlet，如下列範例所示：

```PowerShell
Set-Processmitigation -Name test.exe -Remove -Disable DEP
```

您也可以將部分遷移設定為稽核模式。 請使用下列 [緩解指令程式][表格](#cmdlets-table)中所指定的「**審計模式** Cmdlet」，而不是使用 PowerShell Cmdlet 進行緩解。

例如，若要為先前使用的 *testing.exe* 啟用 [任意代碼保護 (ACG) ，請使用下列命令：

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable AuditDynamicCode
```

您可以使用同一個命令取代 `-Enable` ，以停用稽核模式 `-Disable` 。

### <a name="powershell-reference-table"></a>PowerShell 參照表格

下表列出 PowerShell Cmdlet (和相關聯的審計模式 Cmdlet) 可用於設定每項緩解。

<a id="cmdlets-table"></a>

| 風險降低 | 適用於 | PowerShell Cmdlet | 稽核模式 Cmdlet |
| ---------- | ---------- | ------------------ | ----------------- |
| 控制流量防護 (CFG)  | 系統和應用層級 |   CFG、StrictCFG、SuppressExports  | 無法使用審計 |
| 資料執行防護 (DEP)  | 系統和應用層級 |   DEP，EmulateAtlThunks  | 無法使用審計 |
|  (強制的 ASLR 中強制執行影像的隨機化)  | 系統和應用層級 |   ForceRelocateImages  | 無法使用審計 |
| 在 (自下而上的 ASLR) 隨機化記憶體分配 | 系統和應用層級 |   BottomUp, HighEntropy  | 無法使用審計 |
| 驗證例外鏈 (SEHOP)  | 系統和應用層級 |   SEHOP, SEHOPTelemetry  | 無法使用審計 |
| 驗證堆完整性 | 系統和應用層級 |   TerminateOnError  | 無法使用審計 |
| 任意代碼防護 (ACG)  | 僅限應用層級 |   DynamicCode  |   AuditDynamicCode |
| 封鎖低誠信影像 | 僅限應用層級 |   BlockLowLabel  |   AuditImageLoad |
| 封鎖遠端映射 | 僅限應用層級 |   BlockRemoteImages  | 無法使用審計 |
| 封鎖不受信任的字體 | 僅限應用層級 |   DisableNonSystemFonts  |   AuditFont, FontAuditOnly |
| 程式碼整體性防護 | 僅限應用層級 |   BlockNonMicrosoftSigned, AllowStoreSigned  |   AuditMicrosoftSigned, AuditStoreSigned |
| 停用分機點 | 僅限應用層級 |   ExtensionPoint  | 無法使用審計 |
| 停用 Win32k 系統通話 | 僅限應用層級 |   DisableWin32kSystemCalls  |   AuditSystemCall |
| 不允許子流程 | 僅限應用層級 |   DisallowChildProcessCreation  |   AuditChildProcess |
| 匯出位址篩選 (EAF)  | 僅限應用層級 |   EnableExportAddressFilterPlus，EnableExportAddressFilter <a href="#r1" id="t1"> \[ 1 \] </a> | 無法使用審核<a href="#r2" id="t2"> \[ 2 \] </a> |
| 匯入位址篩選 (IAF)  | 僅限應用層級 |   EnableImportAddressFilter  | 無法使用審核<a href="#r2" id="t2"> \[ 2 \] </a> |
| 模擬執行 (SimExec)  | 僅限應用層級 |   EnableRopSimExec  | 無法使用審核<a href="#r2" id="t2"> \[ 2 \] </a> |
| 驗證 API 呼叫 (CallerCheck)  | 僅限應用層級 |   EnableRopCallerCheck  | 無法使用審核<a href="#r2" id="t2"> \[ 2 \] </a> |
| 驗證控制碼使用狀況 | 僅限應用層級 |   StrictHandle  | 無法使用審計 |
| 驗證映射相依性完整性 | 僅限應用層級 |   EnforceModuleDepencySigning  | 無法使用審計 |
| 驗證堆疊整體性 (StackPivot)  | 僅限應用層級 |   EnableRopStackPivot  | 無法使用審核<a href="#r2" id="t2"> \[ 2 \] </a> |

<a href="#t1" id="r1"> \[ 1 \] </a>：使用下列格式為處理常式啟用 dll 的 EAF 模組：

```PowerShell
Set-ProcessMitigation -Name processName.exe -Enable EnableExportAddressFilterPlus -EAFModules dllName1.dll,dllName2.dll
```

<a href="#t2" id="r2"> \[ 2 \] </a>：無法透過 PowerShell Cmdlet 取得此緩解措施的審計。

## <a name="customize-the-notification"></a>自訂通知

如需在觸發規則時自訂通知並封鎖應用程式或檔案的詳細資訊，請參閱 [Windows 安全性](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-security-center/windows-defender-security-center#customize-notifications-from-the-windows-defender-security-center)。

## <a name="see-also"></a>另請參閱：

* [保護裝置不受利用](exploit-protection.md)
* [評估 exploit protection](evaluate-exploit-protection.md)
* [啟用入侵防護](enable-exploit-protection.md)
* [匯入、匯出及部署利用保護群組原則](import-export-exploit-protection-emet-xml.md)
