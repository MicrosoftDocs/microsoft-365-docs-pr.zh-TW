---
title: 使用郵件流程規則來封鎖具有可執行附件的郵件
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 系統管理員可以瞭解如何建立郵件流程規則 (傳輸規則) 以封鎖包含可執行附件的郵件。
ms.openlocfilehash: 4552cb76238ad995bab04a9ac50873bc22115ce4
ms.sourcegitcommit: ee39faf3507d0edc9497117b3b2854955c959c6c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "49615909"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="a39ab-103">在 EOP 中使用郵件流程規則來封鎖含有可執行附件的郵件</span><span class="sxs-lookup"><span data-stu-id="a39ab-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]


<span data-ttu-id="a39ab-104">在有信箱在 Exchange Online 或獨立 Exchange Online Protection 中的 Microsoft 365 組織中 (EOP) 不含 Exchange Online 信箱的組織，EOP 會使用反惡意程式碼原則來封鎖有害的郵件，包括具有可執行附件的郵件。</span><span class="sxs-lookup"><span data-stu-id="a39ab-104">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="a39ab-105">如需詳細資訊，請參閱 [EOP 中的反惡意程式碼保護](anti-malware-protection.md)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-105">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="a39ab-106">若要進一步增強保護，您可以使用郵件流程規則 (也稱為傳輸規則) 來識別及封鎖包含可執行附件的郵件，如本主題所述。</span><span class="sxs-lookup"><span data-stu-id="a39ab-106">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this topic.</span></span>

<span data-ttu-id="a39ab-107">例如，在惡意程式碼發作的情況下，公司可以套用此規則的時間限制，讓受影響的使用者可以在指定的時間長度後傳回傳送附件。</span><span class="sxs-lookup"><span data-stu-id="a39ab-107">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="a39ab-108">開始之前有哪些須知？</span><span class="sxs-lookup"><span data-stu-id="a39ab-108">What do you need to know before you begin?</span></span>

- <span data-ttu-id="a39ab-109">您必須已獲指派許可權，才能執行這些程式：</span><span class="sxs-lookup"><span data-stu-id="a39ab-109">You need to be assigned permissions before you can do these procedures:</span></span>

  - <span data-ttu-id="a39ab-110">在 Exchange Online 中，請參閱在 [Exchange online 中的功能許可權中](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions)的「郵件流程」專案。</span><span class="sxs-lookup"><span data-stu-id="a39ab-110">In Exchange Online, see the "Mail flow" entry in [Feature Permissions in Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions).</span></span>

  - <span data-ttu-id="a39ab-111">在獨立 EOP 中，您需要傳輸規則角色，預設會指派給 OrganizationManagement、ComplianceManagement 和 RecordsManagement 角色。</span><span class="sxs-lookup"><span data-stu-id="a39ab-111">In standalone EOP, you need the Transport Rules role, which is assigned to the OrganizationManagement, ComplianceManagement, and RecordsManagement roles by default.</span></span> <span data-ttu-id="a39ab-112">如需詳細資訊，請參閱 [獨立 EOP 中的許可權](feature-permissions-in-eop.md) 和 [使用 EAC 修改角色群組中的成員清單](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-112">For more information, see [Permissions in standalone EOP](feature-permissions-in-eop.md) and [Use the EAC modify the list of members in role groups](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups).</span></span>

- <span data-ttu-id="a39ab-113">若要在 Exchange Online 中開啟 EAC，請參閱 exchange [online 中的 exchange admin center](https://docs.microsoft.com/Exchange/exchange-admin-center)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-113">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](https://docs.microsoft.com/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="a39ab-114">若要在獨立 EOP 中開啟 EAC，請參閱 [Exchange admin center in 獨立 EOP](exchange-admin-center-in-exchange-online-protection-eop.md)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-114">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="a39ab-115">若要連線至 Exchange Online PowerShell，請參閱[連線至 Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-115">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="a39ab-116">若要連接至獨立版 EOP PowerShell，請參閱[連線到 Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-116">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="a39ab-117">如需 Exchange Online 和獨立 EOP 中郵件流程規則的相關資訊，請參閱下列主題：</span><span class="sxs-lookup"><span data-stu-id="a39ab-117">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="a39ab-118">Exchange Online 中的郵件流程規則 (傳輸規則)</span><span class="sxs-lookup"><span data-stu-id="a39ab-118">Mail flow rules (transport rules) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="a39ab-119">Exchange Online 中的郵件流程規則條件和例外狀況 (述詞)</span><span class="sxs-lookup"><span data-stu-id="a39ab-119">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="a39ab-120">Exchange Online 中的郵件流程規則動作</span><span class="sxs-lookup"><span data-stu-id="a39ab-120">Mail flow rule actions in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="a39ab-121">使用 EAC 來建立一個規則，以封鎖具有可執行附件的郵件</span><span class="sxs-lookup"><span data-stu-id="a39ab-121">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="a39ab-122">在 EAC 中，移至 [郵件流程] \> [規則]。</span><span class="sxs-lookup"><span data-stu-id="a39ab-122">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="a39ab-123">按一下 [ **新增** ![ 加入圖示] ](../../media/ITPro-EAC-AddIcon.png) ，然後選取 [ **建立新的規則**]。</span><span class="sxs-lookup"><span data-stu-id="a39ab-123">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="a39ab-124">在開啟的 [ **新增規則** ] 頁面中，設定下列設定：</span><span class="sxs-lookup"><span data-stu-id="a39ab-124">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="a39ab-125">**名稱**：輸入規則的唯一描述性名稱。</span><span class="sxs-lookup"><span data-stu-id="a39ab-125">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="a39ab-126">按一下 [ **更多選項**]。</span><span class="sxs-lookup"><span data-stu-id="a39ab-126">Click **More Options**.</span></span>

   - <span data-ttu-id="a39ab-127">**在下列情況中套用此規則**：選取 **任何附件** \> **都有可執行檔內容**。</span><span class="sxs-lookup"><span data-stu-id="a39ab-127">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="a39ab-128">**請執行下列** 動作：選取 [ **封鎖郵件** ]，然後選擇您想要的動作：</span><span class="sxs-lookup"><span data-stu-id="a39ab-128">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="a39ab-129">**拒絕郵件並包含說明**：在出現的 [ **指定拒絕原因** ] 對話方塊中，輸入您要顯示在未傳遞回報中的文字， (也稱為 NDR 或退回郵件) 。</span><span class="sxs-lookup"><span data-stu-id="a39ab-129">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="a39ab-130">使用的預設增強型狀態碼為5.7.1。</span><span class="sxs-lookup"><span data-stu-id="a39ab-130">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="a39ab-131">**使用增強型狀態碼拒絕郵件**：在出現的 [ **輸入增強型狀態碼** ] 對話方塊中，輸入您要顯示在 NDR 中的增強狀態碼。</span><span class="sxs-lookup"><span data-stu-id="a39ab-131">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="a39ab-132">有效的值為5.7.1 或5.7.900 到5.7.999 的值。</span><span class="sxs-lookup"><span data-stu-id="a39ab-132">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="a39ab-133">預設拒絕文字為：傳遞未獲授權，郵件被拒絕。</span><span class="sxs-lookup"><span data-stu-id="a39ab-133">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="a39ab-134">**拒絕郵件而不通知任何人**</span><span class="sxs-lookup"><span data-stu-id="a39ab-134">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="a39ab-135">完成後，按一下 **[儲存]**。</span><span class="sxs-lookup"><span data-stu-id="a39ab-135">When you're finished, click **Save**.</span></span> <span data-ttu-id="a39ab-136">您的附件封鎖規則目前處於強制狀態。</span><span class="sxs-lookup"><span data-stu-id="a39ab-136">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="a39ab-137">使用 PowerShell 建立封鎖郵件與可執行附件的規則</span><span class="sxs-lookup"><span data-stu-id="a39ab-137">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="a39ab-138">使用下列語法來建立規則，以封鎖包含可執行附件的郵件：</span><span class="sxs-lookup"><span data-stu-id="a39ab-138">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="a39ab-139">**附註**：</span><span class="sxs-lookup"><span data-stu-id="a39ab-139">**Notes**:</span></span>

- <span data-ttu-id="a39ab-140">如果您使用不是 _RejectMessageReasonText_ 參數的 _RejectMessageEnhancedStatusCode_ 參數，則預設文字為：傳遞未獲授權，郵件會遭到拒絕。</span><span class="sxs-lookup"><span data-stu-id="a39ab-140">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="a39ab-141">如果您使用不是 _RejectMessageEnhancedStatusCode_ 參數的 _RejectMessageReasonText_ 參數，則預設的程式碼為5.7.1。</span><span class="sxs-lookup"><span data-stu-id="a39ab-141">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="a39ab-142">這個範例會建立一個名為 Block 的可執行附件的新規則，此規則會以無訊息方式刪除包含可執行附件</span><span class="sxs-lookup"><span data-stu-id="a39ab-142">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="a39ab-143">如需詳細的語法和參數資訊，請參閱 [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule)。</span><span class="sxs-lookup"><span data-stu-id="a39ab-143">For detailed syntax and parameter information, see [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="a39ab-144">如何知道這是否正常運作？</span><span class="sxs-lookup"><span data-stu-id="a39ab-144">How do you know this worked?</span></span>

<span data-ttu-id="a39ab-145">若要確認您是否已成功建立郵件流程規則，以封鎖包含可執行附件的郵件，請執行下列任一步驟：</span><span class="sxs-lookup"><span data-stu-id="a39ab-145">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="a39ab-146">在 EAC 中，移至 [ **郵件流程** \> **規則**] \> 選取規則 \> ，然後按一下 [ **編輯** ![ 編輯圖示] ](../../media/ITPro-EAC-EditIcon.png) ，然後驗證設定。</span><span class="sxs-lookup"><span data-stu-id="a39ab-146">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="a39ab-147">在 PowerShell 中，執行下列命令來確認設定：</span><span class="sxs-lookup"><span data-stu-id="a39ab-147">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
