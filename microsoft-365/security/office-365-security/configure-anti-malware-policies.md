---
title: 設定反惡意程式碼原則
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: 系統管理員可以瞭解如何在 Exchange Online Protection (EOP) 中查看、建立、修改和移除反惡意程式碼原則。
ms.custom: seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 0787bc9ebe355eebdd7736c81b361af3ea4e1cde
ms.sourcegitcommit: ebb1c3b4d94058a58344317beb9475c8a2eae9a7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/24/2021
ms.locfileid: "53108076"
---
# <a name="configure-anti-malware-policies-in-eop"></a>在 EOP 中設定反惡意程式碼原則

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**適用於**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [適用於 Office 365 的 Microsoft Defender 方案 1 和方案 2](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

在 Microsoft 365 具有 Exchange Online 或獨立 Exchange Online Protection 中信箱的組織 (EOP) 組織沒有 Exchange Online 信箱，電子郵件會自動受到 EOP 的惡意程式碼保護。 EOP 會使用反惡意程式碼原則進行惡意程式碼保護設定。 如需詳細資訊，請參閱 [反惡意程式碼保護](anti-malware-protection.md)。

系統管理員可以查看、編輯和設定 (，但不會刪除預設反惡意程式碼原則) ，以符合組織的需求。 為了獲得更多細微性，您也可以建立適用于組織中特定使用者、群組或網域的自訂反惡意程式碼原則。 自訂原則一律優先於預設原則，但您可以變更自訂原則的優先順序 (執行順序)。

您可以在 Microsoft 365 Defender 入口網站中設定反惡意程式碼原則，或在 PowerShell 使用信箱的 Microsoft 365 組織中設定 PowerShell (Exchange Online Exchange Online;組織的獨立 EOP PowerShell，不 Exchange Online 信箱) 。

## <a name="what-do-you-need-to-know-before-you-begin"></a>開始之前有哪些須知？

- 您於 <https://security.microsoft.com> 開啟 Microsoft 365 Defender 入口網站。 若要直接移至 **反惡意** 字碼頁面，請使用 <https://security.microsoft.com/antimalwarev2> 。

- 若要連線至 Exchange Online PowerShell，請參閱[連線至 Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell)。 若要連接至獨立版 EOP PowerShell，請參閱[連線到 Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell)。

- 您必須已在 **Exchange Online** 中獲派權限，才能執行此文章中的程序：
  - 若要新增、修改和刪除反惡意程式碼原則，您必須是「 **組織管理** 」或「 **安全性管理員** 」角色群組的成員。
  - 若要唯讀的反惡意程式碼原則的存取權，您必須是 **全域讀取器** 或 **安全性讀取器** 角色群組的成員。

  如需詳細資訊，請參閱 [Exchange Online 中的權限](/exchange/permissions-exo/permissions-exo)。

  **附註**：

  - 在 Microsoft 365 系統管理中心中，將使用者新增至對應的 Azure Active Directory 角色可為使用者提供所需的權限 _和_ Microsoft 365 中其他功能的權限。 如需詳細資訊，請參閱[關於系統管理員角色](../../admin/add-users/about-admin-roles.md)。
  - [Exchange Online](/Exchange/permissions-exo/permissions-exo#role-groups) 中的 **僅限檢視組織管理** 角色群組也會提供功能的唯讀存取權。

- 如需有關反惡意程式碼原則的建議設定，請參閱 [EOP 防盜-惡意程式碼原則設定](recommended-settings-for-eop-and-office365.md#eop-anti-malware-policy-settings)。

## <a name="use-the-microsoft-365-defender-portal-to-create-anti-malware-policies"></a>使用 Microsoft 365 Defender 入口網站建立反惡意程式碼原則

在 Microsoft 365 Defender 入口網站中建立自訂的反惡意程式碼原則，會同時使用相同的名稱建立惡意軟體篩選規則和相關聯的惡意程式碼篩選原則。

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則 & 規則** \> **威脅原則**] 頁面 \> **原則**] \> **Anti-Malware**。

2. 在 [ **反惡意** 代碼] 頁面上，按一下 [ ![ 建立圖示 ](../../media/m365-cc-sc-create-icon.png) **建立**]。

3. 原則精靈隨即開啟。 在 [ **命名您的原則** ] 頁面上，設定下列設定：
   - **名稱**：輸入原則的唯一描述性名稱。
   - **說明**：輸入原則的選擇性說明。

   完成後，按 [下一步 **]**。

4. 在出現的 [ **使用者和網域** ] 頁面上，識別原則套用至 (收件者條件) 的內部收件者：
   - **使用者**：您組織中指定的信箱、郵件使用者或郵件連絡人。
   - **群組**：您組織中指定的通訊群組、啟用郵件功能的安全性群組或 Microsoft 365 群組。
   - **網域**：您組織中指定的 [公認的網域](/exchange/mail-flow-best-practices/manage-accepted-domains/manage-accepted-domains)中的所有收件者。

   按一下適當的方塊，開始輸入值，然後從結果中選取您想要的值。 視需要重複此程序多次。 若要移除現有的值，請按一下 ![[移除] 圖示](../../media/m365-cc-sc-remove-selection-icon.png) 值旁邊的 [移除]。

   針對使用者或群組，您可以使用大部分識別碼 (名稱、顯示名稱、別名、電子郵件地址、帳戶名稱等)，但會在結果中顯示對應的顯示名稱。 針對使用者，接著輸入星號 (\*) 來查看所有可用的值。

   相同條件中的多個值使用 OR 邏輯 (例如，_\<recipient1\>_ 或 _\<recipient2\>_)。 不同的條件則使用 AND 邏輯 (例如，_\<recipient1\>_ 和 _\<member of group 1\>_)。

   - **排除這些使用者、群組和網域**：若要為原則適用的內部收件者新增例外 (收件者例外)，請選取此選項並設定例外。 設定和行為就像是條件。

   完成後，按 [下一步 **]**。

5. 在出現的 [ **保護設定** ] 頁面上，設定下列設定：

   - **啟用常見附件篩選器**：如果您選取此選項，則會將具有指定附件的郵件視為惡意程式碼，而且會自動隔離。 您可以選取 [ **自訂檔案類型**]，修改預設清單。

   - **為惡意程式碼啟用零小時自動清除**：如果您選取此選項，則 ZAP 會隔離已傳遞的惡意程式碼郵件。 如需詳細資訊，請參閱[Exchange Online 中的零小時自動清除 (ZAP) ](zero-hour-auto-purge.md)。 選取下列其中一個值：

   - **當郵件隔離為惡意程式碼時通知收件** 者：
     - 如果您選取此選項，則會隔離郵件，但不會通知預定的收件者。
     - 如果您未選取此選項，則會隔離郵件。 郵件的複本會傳送給收件者，但是 *所有* 附件 (都不只是偵測到的檔案) 會取代為單一文字檔（名為 **惡意程式碼警示 Text.txt**）。

       在 [反惡意程式碼原則](anti-malware-protection.md#anti-malware-policies)中，會說明取代文字檔中的預設文字。 若要改為使用自訂文字，請在 [ **自訂通知文字為收件** 者] 方塊中輸入文字。

   - **寄件者通知**：請選取 [無]、下列兩個選項之一：
       - **當郵件隔離為惡意程式碼時通知內部寄件者**：內部寄件者在組織內。
       - **當郵件隔離為惡意程式碼時通知外部寄件者**：外部寄件者在組織外。

   - 系統 **管理員通知**：選取 [無]、下列兩個選項之一：
       - **通知系統管理員來自內部寄件者的未傳遞郵件**：如果您選取此選項，請在出現的 [系統 **管理員電子郵件地址** ] 方塊中輸入通知電子郵件地址。
       - **通知系統管理員來自外部寄件者的未傳遞郵件**：如果您選取此選項，請在出現的 [系統 **管理員電子郵件地址** ] 方塊中，輸入通知電子郵件地址。

   - **自訂通知**：這些設定會取代寄件者或系統管理員所用的預設通知文字。 如需預設值的詳細資訊，請參閱[反惡意程式碼原則](anti-malware-protection.md#anti-malware-policies)。
       - **使用自訂的通知文字**：如果您選取此選項，則必須使用 [寄件者 **名稱** ] 和 [寄件者 **位址** ] 方塊來指定自訂通知訊息中所使用的寄件者名稱和電子郵件地址。
       - **自訂來自內部寄件者的郵件通知**：如果您選擇通知寄件者或系統管理員無法從內部寄件者傳遞郵件，您必須使用主旨及 **消息** 框來指定自訂通知訊息的 **主旨和郵件** 內文。
       - **自訂來自外部寄件者的郵件通知**：如果您選擇通知寄件者或系統管理員無法傳遞來自外部寄件者的郵件，您必須使用主旨及 **消息** 框來指定自訂通知訊息的 **主旨和郵件** 內文。

   完成後，按 [下一步 **]**。

6. 在顯示的 [檢閱 **]** 頁面上，檢閱您的設定。 您可以在每個區段中選取 [編輯 **]**，以修改該區段內的設定。 或者，您可以按一下 [上一步] 或在精靈中選取特定頁面。

   當您完成時，按一下 [ **提交**]。

7. 在顯示的確認頁面上，按一下 [完成 **]**。

## <a name="use-the-microsoft-365-defender-portal-to-view-anti-malware-policies"></a>使用 Microsoft 365 Defender 入口網站來查看反惡意程式碼原則

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則] & 規則** \> **威脅原則**] 頁面 \> **策略**] 區域 \> **反惡意** 代碼]。

2. 在 [ **反惡意** 代碼] 頁面上，反惡意程式碼原則的清單中會顯示下列屬性：
   - **名稱**
   - **狀態**
   - **優先順序**

3. 當您按一下名稱來選取原則時，原則設定會顯示在浮出控制項中。

## <a name="use-the-microsoft-365-defender-portal-to-modify-anti-malware-policies"></a>使用 Microsoft 365 Defender 入口網站修改反惡意程式碼原則

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則] & 規則** \> **威脅原則**] 頁面 \> **策略**] 區域 \> **反惡意** 代碼]。

2. 在 [ **反惡意** 代碼] 頁面上，按一下清單中的名稱，以選取原則。

3. 在顯示的原則詳細資料飛出視窗中，在每個區段中選取 [編輯 **]**，以修改該區段內的設定。 如需這些設定的詳細資訊，請參閱本文中[的「Microsoft 365 Defender 入口網站以建立反惡意程式碼原則](#use-the-microsoft-365-defender-portal-to-create-anti-malware-policies)」一節。  

   針對預設的反惡意程式碼原則，無法使用 [ **使用者、群組及網域** ] 區段 (原則套用至所有人) ，而且您無法重新命名原則。

若要啟用或停用原則或設定原則優先順序順序，請參閱下列各節。

### <a name="enable-or-disable-custom-anti-malware-policies"></a>啟用或停用自訂的反惡意程式碼原則

您無法停用預設的反惡意程式碼原則。

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則] & 規則** \> **威脅原則**] 頁面 \> **策略**] 區域 \> **反惡意** 代碼]。

2. 在 [ **反惡意** 代碼] 頁面上，按一下清單中的名稱，以選取自訂原則。

3. 在顯示的原則詳細資料飛出視窗頂端，您會看到下列其中一個值：
   - **原則關閉**：若要開啟原則，請按一下 ![開啟圖示](../../media/m365-cc-sc-turn-on-off-icon.png) [開啟 **]**。
   - **原則開啟**：若要關閉原則，請按一下 ![關閉圖示](../../media/m365-cc-sc-turn-on-off-icon.png) [關閉 **]**。

4. 在顯示的確認對話方塊中，按一下 [開啟 **]** 或 [關閉 **]**。

5. 按一下原則詳細資料飛出視窗中的 [關閉 **]**。

回到主要原則頁面，原則的 [狀態 **]** 值將會是 [開啟 **]** 或 [關閉 **]**。

### <a name="set-the-priority-of-custom-anti-malware-policies"></a>設定自訂反惡意程式碼原則的優先順序

根據預設，反惡意程式碼原則的優先順序會根據它們在 (較舊的原則中所建立的順序來降低優先順序) 。 較小的優先順序數字表示原則的優先順序較高 (0 最高)，原則是依據優先順序進行處理，較高優先順序的原則會在較低優先順序的原則前面進行處理。 不論有幾個原則，都不會具有相同的優先順序，且在套用第一個原則之後，原則處理就會停止。

若要變更原則的優先順序，請在原則內容中按一下 [增加優先順序 **]** 或 [降低優先順序 **]** (您無法在 Microsoft 365 Defender 入口網站直接修改 [優先順序 **]** 編號)。 只有在您有多個原則時，變更原則的優先順序才有意義。

 **附註**：

- 在 Microsoft 365 Defender 入口網站中，您可以在建立反惡意程式碼原則之後，才變更其優先順序。 在 PowerShell 中，您可以在建立惡意程式碼篩選規則時覆寫預設優先順序 (會影響現有規則的優先順序)。
- 反惡意程式碼原則會依顯示的連續處理 (第一個原則的 **Priority** 值為 0) 。 預設反惡意程式碼原則的優先順序值為 **最低**，您無法變更。

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則] & 規則** \> **威脅原則**] 頁面 \> **策略**] 區域 \> **反惡意** 代碼]。

2. 在 [ **反惡意** 代碼] 頁面上，按一下清單中的名稱，以選取自訂原則。

3. 在顯示的原則詳細資料飛出視窗的頂端，根據目前的優先順序值和自訂原則數目，您會看到 [增加優先順序 **]** 或 [降低優先順序 **]**：
   - **優先順序** 值為 **0** 的原則只有 [**降低優先順序**] 選項可用。
   - 具有最低 **優先順序** 值的原則 (例如， **3**) 只有 [ **增加優先順序** ] 選項可用。
   - 如果您有三個或多個原則，則最高和最低優先順序值之間的原則都具有 [ **增加優先順序** ] 和 [ **降低優先順序** ] 選項。

   按一下 ![增加優先順序圖示](../../media/m365-cc-sc-increase-icon.png) [增加優先順序 **]** 或 ![降低優先順序圖示](../../media/m365-cc-sc-decrease-icon.png) [降低優先順序 **]** 以變更 [優先順序 **]** 值。

4. 完成後，請按一下原則詳細資料飛出視窗中的 [關閉 **]**。

## <a name="use-the-microsoft-365-defender-portal-to-remove-custom-anti-malware-policies"></a>使用 Microsoft 365 Defender 入口網站來移除自訂的反惡意程式碼原則

當您使用 Microsoft 365 Defender 入口網站移除自訂的反惡意程式碼原則時，惡意軟體篩選規則和對應的惡意程式碼篩選原則都會同時刪除。 您無法移除預設的反惡意程式碼原則。

1. 在 Microsoft 365 Defender 入口網站中，移至 [**電子郵件 &** 共同作業 \> **原則] & 規則** \> **威脅原則**] 頁面 \> **策略**] 區域 \> **反惡意** 代碼]。

2. 在 [ **反惡意** 代碼] 頁面上，按一下清單中的名稱，以選取自訂原則。

3. 在顯示的原則詳細資料飛出視窗頂端，按一下 ![更多動作圖示](../../media/m365-cc-sc-more-actions-icon.png) [其他動作 **]** \> ![刪除原則圖示](../../media/m365-cc-sc-delete-icon.png) [刪除原則 **]**。

4. 在顯示的確認對話方塊中，按一下 [是 **]**。

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>使用 Exchange Online PowerShell 或獨立 EOP PowerShell 設定反惡意程式碼原則

如需 PowerShell 中的反垃圾郵件原則的詳細資訊，請參閱[Microsoft 365 Defender 入口網站和 PowerShell 中的反惡意程式碼原則](anti-malware-protection.md#anti-malware-policies-in-the-microsoft-365-defender-portal-vs-powershell)。

### <a name="use-powershell-to-create-anti-malware-policies"></a>使用 PowerShell 來建立反惡意程式碼原則

若要在 PowerShell 中建立反惡意程式碼原則，需執行兩個步驟：

1. 建立惡意程式碼篩選原則。
2. 建立惡意程式碼篩選規則，此規則會指定要套用規則的惡意程式碼篩選原則。

 **附註**：

- 您可以建立新的惡意程式碼篩選規則，並對其指派未關聯的現有惡意程式碼篩選原則。 惡意程式碼篩選規則無法與多個惡意程式碼篩選原則相關聯。
- 在建立原則之前，您可以在新的反惡意程式碼原則上進行下列兩項設定 PowerShell Microsoft 365 Defender 入口網站中不提供：
  - _在_ `$false` **New-MalwareFilterRule** Cmdlet) 上，建立新原則做為已停用 (。
  - 在 _\<Number\>_ **New-MalwareFilterRule** Cmdlet) 上建立 (優先順序) 時，設定原則的優先順序。
- 在您將原則指派給惡意軟體篩選規則之前，您在 PowerShell 中建立的新惡意程式碼篩選原則不會顯示在 Microsoft 365 Defender 入口網站中。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>步驟 1：使用 PowerShell 建立惡意程式碼篩選原則

**附注**：在雲端式服務中， _Action_ 參數值 `DeleteMessage` ， `DeleteAttachmentAndUseDefaultAlert` 而 `DeleteAttachmentAndUseCustomAlert` 不會刪除郵件。 相反地，郵件會被隔離。 如需有關檢索隔離郵件的詳細資訊，請參閱 [在 EOP 中以系統管理員身分管理隔離的郵件和](manage-quarantined-messages-and-files.md)檔案。

若要建立惡意程式碼篩選原則，請使用下列語法：

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

本範例搭配下列設定建立命名為 Contoso Malware Filter Policy 的新惡意程式篩選原則：

- 隔離包含惡意程式碼的郵件，但未通知收件者 (我們不會使用 _Action_ 參數，而且預設值是 `DeleteMessage`) 。
- 在郵件中偵測到惡意程式碼時不通知郵件寄件者 (我們不是使用 _EnableExternalSenderNotifications_ 或 _EnableInternalSenderNotifications_ 參數，兩個參數的預設值都是 `$false`)。
- 從內部寄件者的訊息中偵測到惡意程式時，通知管理員 admin@contoso.com。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

如需詳細的語法及參數資訊，請參閱 [New-MalwareFilterPolicy](/powershell/module/exchange/new-malwarefilterpolicy)。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>步驟 2：使用 PowerShell 建立惡意程式碼篩選規則

若要建立惡意程式碼篩選規則，請使用下列語法：

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

此範例使用下列設定來建立名稱為 Contoso Recipients 的新惡意軟體篩選規則：

- 名為 Contoso Malware Filter Policy 的惡意程式碼篩選原則會與規則產生關聯。
- 規則會套用至 contoso.com 網域中的收件者。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

如需詳細的語法及參數資訊，請參閱 [New-MalwareFilterRule](/powershell/module/exchange/new-malwarefilterrule)。

### <a name="use-powershell-to-view-malware-filter-policies"></a>使用 PowerShell 檢視惡意程式碼篩選原則

若要傳回所有惡意程式碼篩選原則的摘要清單，請執行下列命令：

```PowerShell
Get-MalwareFilterPolicy
```

若要傳回特定惡意程式碼篩選原則的詳細資訊，請使用下列語法：

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

此範例會傳回惡意程式碼篩選原則 (名稱為 Executives) 的所有屬性值。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

此範例只會傳回相同原則的指定屬性。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

如需詳細的語法及參數資訊，請參閱 [Get-MalwareFilterPolicy](/powershell/module/exchange/get-malwarefilterpolicy)。

### <a name="use-powershell-to-view-malware-filter-rules"></a>使用 PowerShell 檢視惡意程式碼篩選規則

若要傳回所有惡意程式碼篩選規則的摘要清單，請執行下列命令：

```PowerShell
Get-MalwareFilterRule
```

若要依啟用或停用篩選規則的清單，請執行下列命令：

```PowerShell
Get-HostedContentFilterRule -State Disabled
```

```PowerShell
Get-HostedContentFilterRule -State Enabled
```

若要傳回特定惡意程式碼篩選規則的詳細資訊，請使用下列語法：

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

此範例會傳回惡意程式碼篩選規則 (名稱為 Executives) 的所有屬性值。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

此範例只會傳回相同規則的指定屬性。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

如需詳細的語法及參數資訊，請參閱 [Get-MalwareFilterRule](/powershell/module/exchange/get-malwarefilterrule)。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>使用 PowerShell 修改惡意程式碼篩選原則

除了下列專案之外，當您在 PowerShell 中修改惡意程式碼篩選原則時，當您在本文稍早 [：使用 [步驟1：使用 PowerShell 建立惡意程式碼篩選原則](#step-1-use-powershell-to-create-a-malware-filter-policy) ] 區段中所述的情況下，修改惡意程式碼篩選原則時，就可以使用相同的設定。

- _MakeDefault_ 參數會將指定的原則轉換成預設原則 (套用至所有人、不可修改的 **最低** 優先順序，而且您無法刪除只有當您在 PowerShell 中修改惡意程式碼篩選原則時，才可使用此參數) 。
- 您無法重新命名惡意程式碼篩選原則 (**Set-MalwareFilterPolicy** Cmdlet 沒有 _Name_ 參數) 。 當您重新命名 Microsoft 365 Defender 入口網站中的反惡意程式碼原則時，您只是重新命名惡意程式碼篩選 _規則_。

若要修改惡意程式碼篩選原則，請使用下列語法：

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

如需詳細的語法及參數資訊，請參閱 [Set-MalwareFilterPolicy](/powershell/module/exchange/set-malwarefilterpolicy)。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>使用 PowerShell 修改惡意程式碼篩選規則

當您在 PowerShell 中修改惡意程式碼篩選規則時，唯一可用的設定是 _Enabled_ 參數，可讓您建立已停用的規則。 若要啟用或停用現有的惡意程式碼篩選規則，請參閱下一節。

否則，當您在 PowerShell 中修改惡意程式碼篩選規則時，不會有其他設定可供使用。 當您建立規則時，如您在本文稍早的 [步驟2：使用 PowerShell 來建立惡意軟體篩選規則](#step-2-use-powershell-to-create-a-malware-filter-rule) 一節所述，您可以使用相同的設定。

若要修改惡意程式碼篩選規則，請使用下列語法：

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

如需詳細的語法及參數資訊，請參閱 [Set-MalwareFilterRule](/powershell/module/exchange/set-malwarefilterrule)。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>使用 PowerShell 來啟用或停用惡意程式碼篩選規則

在 PowerShell 中啟用或停用惡意程式碼篩選規則，可啟用或停用惡意程式碼篩選規則和指派的惡意程式碼篩選原則)  (的整個反惡意程式碼原則。 您無法啟用或停用預設反惡意程式碼原則 (永遠永遠套用至所有收件者) 。

若要在 PowerShell 中啟用或停用惡意程式碼篩選規則，請使用下列語法：

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

此範例會停用名稱為 Marketing Department 的惡意程式碼篩選規則。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

此範例會啟用相同規則。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

如需詳細的語法及參數資訊，請參閱 [Enable-MalwareFilterRule](/powershell/module/exchange/enable-malwarefilterrule) 和 [Disable-MalwareFilterRule](/powershell/module/exchange/disable-malwarefilterrule)。

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>使用 PowerShell 設定惡意軟體篩選規則的優先順序

您可以對規則設定的最高優先順序值為 0。 您可以設定的最低值則取決於規則的數目。 例如，如果您有五個規則，則您可以使用 0 到 4 的優先順序值。 變更現有規則的優先順序會對其他規則造成階層式影響。 例如，如果您有五個自訂規則 (優先順序 0 到 4)，而您將規則的優先順序變更為 2，則優先順序為 2 的現有規則會變更為優先順序 3，優先順序 3 的規則會變更為優先順序 4。

若要在 PowerShell 中設定惡意軟體篩選規則的優先順序，請使用下列語法：

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

此範例會將規則 (名稱為 Marketing Department) 的優先順序設定為 2。 優先順序小於或等於 2 的所有現有規則會減 1 (它們的優先順序數字會加 1)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**附註**：

- 若要在建立新規則時設定其優先順序，請改用 **New-MalwareFilterRule** Cmdlet 上的 _priority_ 參數。
- 預設惡意程式碼篩選原則沒有對應的惡意軟體篩選規則，它永遠具有「未修改的優先順序 **」值。**

### <a name="use-powershell-to-remove-malware-filter-policies"></a>使用 PowerShell 移除惡意程式碼篩選原則

當您使用 PowerShell 來移除惡意程式碼篩選原則時，對應的惡意程式碼篩選規則不會遭到移除。

若要在 PowerShell 中移除惡意程式碼篩選原則，請使用下列語法：

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

此範例會移除名稱為 Marketing Department 的惡意程式碼篩選原則。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

如需詳細的語法及參數資訊，請參閱 [Remove-MalwareFilterPolicy](/powershell/module/exchange/remove-malwarefilterpolicy)。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>使用 PowerShell 移除惡意程式碼篩選規則

當您使用 PowerShell 移除惡意程式碼篩選規則時，並不會移除對應的惡意程式碼篩選原則。

若要在 PowerShell 中移除惡意程式碼篩選規則，請使用下列語法：

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

此範例會移除名為 Marketing 部門的惡意軟體篩選規則。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

如需詳細的語法及參數資訊，請參閱 [Remove-MalwareFilterRule](/powershell/module/exchange/remove-malwarefilterrule)。

## <a name="how-do-you-know-these-procedures-worked"></a>如何知道這些程序是否正常運作？

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>使用 EICAR.TXT 檔案來驗證您的反惡意程式碼原則設定

> [!IMPORTANT]
> EICAR.TXT 檔案不是病毒。 《電腦防病毒研究的歐洲研究院 (EICAR.TXT) 開發此檔案，以安全地測試防病毒安裝和設定。

1. 開啟記事本，並將下列文字貼至空白檔案：

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   請確定這些是檔中唯一的文字字元。 檔案大小應為68位元組。

2. 將檔案儲存為 EICAR.TXT

   在您的桌上型電腦防毒程式中，請務必從掃描中排除 EICAR.TXT (否則，將會) 隔離該檔案。

3. 使用不會自動封鎖檔的電子郵件客戶程式，傳送包含 EICAR.TXT 檔案的電子郵件。 使用您的反惡意程式碼原則設定來決定要測試的下列案例：
   - 從內部信箱到內部收件者的電子郵件。
   - 從內部信箱到外部收件者的電子郵件。
   - 從外部信箱到內部收件者的電子郵件。

4. 請確認已隔離郵件，並根據您的反惡意程式碼原則設定驗證收件者和寄件者的通知結果。 例如：

   - 收件者不會收到通知，或收件者會收到包含預設或自訂文字的 EICAR.TXT 附件（由 **惡意程式碼警示 Text.txt** 所取代）。
   - 會以預設或自訂的通知訊息通知內部或外部寄件者。
   - 您指定的系統管理員電子郵件地址會以預設或自訂的通知訊息通知內部或外部的郵件寄件者。

5. 完成測試之後刪除 EICAR.TXT 檔案 (讓其他使用者不會因) 而不必要地發出警報。
