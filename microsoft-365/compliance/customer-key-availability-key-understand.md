---
title: 了解可用性金鑰的 Office 365 客戶金鑰
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: 了解用來復原遺失的 Office 365 客戶金鑰的可用性金鑰。
ms.openlocfilehash: b363d3b90c6ea783bd051bea6c44a94689b87ac1
ms.sourcegitcommit: 5ff1dc62e8855be155cb2de45cf4ee5a02c321fd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/06/2020
ms.locfileid: "41804769"
---
# <a name="learn-about-the-availability-key-for-office-365-customer-key"></a><span data-ttu-id="a80a8-103">了解可用性金鑰的 Office 365 客戶金鑰</span><span class="sxs-lookup"><span data-stu-id="a80a8-103">Learn about the availability key for Office 365 Customer Key</span></span>

<span data-ttu-id="a80a8-104">可用性機碼是根機碼會自動產生並佈建當您建立的資料加密原則。</span><span class="sxs-lookup"><span data-stu-id="a80a8-104">The availability key is a root key automatically generated and provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="a80a8-105">Office 365 會儲存並保護可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-105">Office 365 stores and protects the availability key.</span></span> <span data-ttu-id="a80a8-106">可用性機碼是具有相同的作用類似於使用客戶金鑰服務加密您提供兩個根機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-106">The availability key is functionally similar to the two root keys that you supply for service encryption with Customer Key.</span></span> <span data-ttu-id="a80a8-107">可用性機碼中自動換列的較低的機碼一層的金鑰階層。</span><span class="sxs-lookup"><span data-stu-id="a80a8-107">The availability key wraps the keys one tier lower in the key hierarchy.</span></span> <span data-ttu-id="a80a8-108">不同於您提供並管理 Azure 金鑰保存庫中的機碼，您無法直接存取可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-108">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="a80a8-109">自動化 office 365 服務管理的可用性金鑰使用 PowerShell cmdlet。</span><span class="sxs-lookup"><span data-stu-id="a80a8-109">Office 365 automated services manage the availability key using PowerShell cmdlets.</span></span> <span data-ttu-id="a80a8-110">這些指令程式起始的永遠不相關的直接存取權的可用性機碼自動化的作業。</span><span class="sxs-lookup"><span data-stu-id="a80a8-110">These cmdlets initiate automated operations that never involve direct access to the availability key.</span></span>

<span data-ttu-id="a80a8-111">可用性按鍵的主要用途是提供從您管理的根機碼未預期遺失的復原能力。</span><span class="sxs-lookup"><span data-stu-id="a80a8-111">The primary purpose of the availability key is to provide recovery capability from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="a80a8-112">遺失可能引發爭議性或惡意巨集指令的結果。</span><span class="sxs-lookup"><span data-stu-id="a80a8-112">Loss could be a result of mismanagement or malicious action.</span></span> <span data-ttu-id="a80a8-113">如果您遺失根機碼的控制，連絡 Microsoft 支援服務與 Microsoft 將協助您透過使用可用性金鑰復原的程序。</span><span class="sxs-lookup"><span data-stu-id="a80a8-113">If you lose control of your root keys, contact Microsoft Support and Microsoft will assist you through the process of recovery using the availability key.</span></span> <span data-ttu-id="a80a8-114">您將使用的可用性機碼移轉至新的資料加密原則與您佈建的新根機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-114">You'll use the availability key to migrate to a new Data Encryption Policy with new root keys you provision.</span></span>

<span data-ttu-id="a80a8-115">儲存區和可用性機碼的控制是刻意不同的三個原因的 Azure Key Vault 機碼：</span><span class="sxs-lookup"><span data-stu-id="a80a8-115">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons:</span></span>

- <span data-ttu-id="a80a8-116">可用性機碼會提供復原、 」 符號玻璃 」 功能，如果這兩個 Azure Key Vault 機碼控制會遺失。</span><span class="sxs-lookup"><span data-stu-id="a80a8-116">The availability key provides a recovery, "break-glass" capability if control over both Azure Key Vault keys is lost.</span></span>
- <span data-ttu-id="a80a8-117">邏輯控制項及安全存放裝置位置的區隔提供深度防禦，並提供保護，避免遺失所有索引鍵和您的資料，從單一攻擊或失敗點。</span><span class="sxs-lookup"><span data-stu-id="a80a8-117">The separation of logical controls and secure storage locations provides defense-in-depth and protects against the loss of all keys, and your data, from a single attack or point of failure.</span></span>
- <span data-ttu-id="a80a8-118">如果 Office 365 服務無法到達因暫時性錯誤而裝載於 Azure 金鑰保存庫中的機碼，可用性機碼會提供高可用性功能。</span><span class="sxs-lookup"><span data-stu-id="a80a8-118">The availability key provides a high-availability capability if Office 365 services are unable to reach keys hosted in Azure Key Vault due to transient errors.</span></span> <span data-ttu-id="a80a8-119">此規則僅適用於 Exchange Online 與 Skype for Business 服務加密。</span><span class="sxs-lookup"><span data-stu-id="a80a8-119">This rule only applies to Exchange Online and Skype for Business service encryption.</span></span> <span data-ttu-id="a80a8-120">SharePoint Online、 商務用 OneDrive，以及小組檔案永遠不會使用可用性金鑰] 除非您明確指示 Microsoft，以啟動復原程序。</span><span class="sxs-lookup"><span data-stu-id="a80a8-120">SharePoint Online, OneDrive for Business, and Teams files never use the availability key unless you explicitly instruct Microsoft to initiate the recovery process.</span></span>

<span data-ttu-id="a80a8-121">共用來保護您的資料，使用不同的保護和處理程序的金鑰管理責任最終可降低風險，所有金鑰 （，因此您的資料） 將會永久遺失或損毀。</span><span class="sxs-lookup"><span data-stu-id="a80a8-121">Sharing the responsibility to protect your data, using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be permanently lost or destroyed.</span></span> <span data-ttu-id="a80a8-122">Microsoft 為您提供權力透過停用或損毀的可用性索引鍵時保留該服務。</span><span class="sxs-lookup"><span data-stu-id="a80a8-122">Microsoft provides you with sole authority over the disablement or destruction of the availability key when you leave the service.</span></span> <span data-ttu-id="a80a8-123">根據設計，在 Microsoft 沒有其他有可用性機碼權限： 這不是藉由 Office 365 服務的程式碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-123">By design, no one at Microsoft has access to the availability key: it is only accessible by Office 365 service code.</span></span>

<span data-ttu-id="a80a8-124">請參閱[Microsoft 信任中心](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data)的我們如何保護機碼的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="a80a8-124">See the [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) for more information about how we secure keys.</span></span>
  
## <a name="availability-key-uses"></a><span data-ttu-id="a80a8-125">可用性機碼使用</span><span class="sxs-lookup"><span data-stu-id="a80a8-125">Availability key uses</span></span>

<span data-ttu-id="a80a8-126">可用性金鑰提供在此案例的復原功能外部因此或惡意的測試人員竊取您金鑰保存庫，或是當不慎引發爭議性會導致遺失根機碼的控制項。</span><span class="sxs-lookup"><span data-stu-id="a80a8-126">The availability key provides recovery capability for scenarios in which an external malefactor or malicious insider steals control of your key vault, or when inadvertent mismanagement results in loss of root keys.</span></span> <span data-ttu-id="a80a8-127">所有 Office 365 服務使用客戶金鑰相容適都用於此復原功能。</span><span class="sxs-lookup"><span data-stu-id="a80a8-127">This recovery capability applies to all Office 365 services compatible with Customer Key.</span></span> <span data-ttu-id="a80a8-128">個別服務以不同方式使用可用性鍵。</span><span class="sxs-lookup"><span data-stu-id="a80a8-128">Individual services use the availability key differently.</span></span> <span data-ttu-id="a80a8-129">Office 365 只會使用可用性機碼如下所述的方式。</span><span class="sxs-lookup"><span data-stu-id="a80a8-129">Office 365 only uses the availability key in the ways described below.</span></span>

### <a name="exchange-online-and-skype-for-business-uses"></a><span data-ttu-id="a80a8-130">Exchange Online 和商務用 Skype</span><span class="sxs-lookup"><span data-stu-id="a80a8-130">Exchange Online and Skype for Business uses</span></span>

<span data-ttu-id="a80a8-131">除了復原功能，Exchange Online 和商務用 Skype 會使用可用性鍵以確保資料可用性期間暫時性或斷斷續續作業相關的問題，存取根機碼的服務。</span><span class="sxs-lookup"><span data-stu-id="a80a8-131">In addition to the recovery capability, Exchange Online and Skype for Business use the availability key to ensure data availability during transient, or intermittent operational issues, related to the service accessing root keys.</span></span> <span data-ttu-id="a80a8-132">當服務無法達到您在 Azure 金鑰保存庫中的客戶金鑰任一因為暫時性錯誤時，服務會自動使用可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-132">When the service cannot reach either of your Customer Keys in Azure Key Vault due to transient errors, the service automatically uses the availability key.</span></span> <span data-ttu-id="a80a8-133">服務永遠不會直接移至可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-133">The service NEVER goes directly to the availability key.</span></span>

<span data-ttu-id="a80a8-134">在 Exchange Online 組織和 Skype 的公司可能使用期間暫時性錯誤可用性金鑰來支援自動化後端服務，例如防毒、 e-探索、 資料外洩防護，信箱移動，自動化的系統和編製索引的資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-134">Automated systems in Exchange Online and Skype for Business may use the availability key during transient errors to support automated back-end services such as anti-virus, e-discovery, data loss prevention, mailbox moves, and data indexing.</span></span>

### <a name="sharepointonlineonedriveforbusinessandteamsfiles-uses"></a><span data-ttu-id="a80a8-135">SharePoint Online、 商務用 OneDrive，以及小組檔案使用</span><span class="sxs-lookup"><span data-stu-id="a80a8-135">SharePoint Online, OneDrive for Business, and Teams files uses</span></span>

<span data-ttu-id="a80a8-136">SharePoint online、 商務用 OneDrive 和小組檔案，可用性的重點是永不使用復原功能之外，和客戶必須明確地指示 Microsoft，以啟動期間復原案例中使用可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-136">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="a80a8-137">自動化作業完全依賴您 Azure 金鑰保存庫中的客戶金鑰的服務。</span><span class="sxs-lookup"><span data-stu-id="a80a8-137">Automated service operations solely rely on your Customer Keys in Azure Key vault.</span></span> <span data-ttu-id="a80a8-138">深入的金鑰階層的這些服務的運作方式的詳細資訊，請參閱[如何 SharePoint Online、 商務用 OneDrive 和小組檔案所使用的可用性金鑰](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)。</span><span class="sxs-lookup"><span data-stu-id="a80a8-138">For in-depth information about how the key hierarchy works for these services, see [How SharePoint Online, OneDrive for Business, and Teams files use the availability key](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key).</span></span>

## <a name="availability-key-security"></a><span data-ttu-id="a80a8-139">可用性主要的安全性</span><span class="sxs-lookup"><span data-stu-id="a80a8-139">Availability key security</span></span>

<span data-ttu-id="a80a8-140">Microsoft 與您共用資料保護的責任，以執行個體化的可用性機碼和廣泛的措施，以保護它。</span><span class="sxs-lookup"><span data-stu-id="a80a8-140">Microsoft shares the responsibility of data protection with you by instantiating the availability key and taking extensive measures to protect it.</span></span> <span data-ttu-id="a80a8-141">Microsoft 不會公開給客戶的可用性金鑰直接控制。</span><span class="sxs-lookup"><span data-stu-id="a80a8-141">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="a80a8-142">例如，您可以只復原 （旋轉） 您所擁有的機碼 Azure 金鑰保存庫中。</span><span class="sxs-lookup"><span data-stu-id="a80a8-142">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="a80a8-143">如需詳細資訊，請參閱[復原或旋轉客戶金鑰或可用性機碼](customer-key-availability-key-roll.md)。</span><span class="sxs-lookup"><span data-stu-id="a80a8-143">For more information, see [Roll or rotate a customer key or an availability key](customer-key-availability-key-roll.md).</span></span>

### <a name="availability-key-secret-stores"></a><span data-ttu-id="a80a8-144">可用性金鑰秘密存放區</span><span class="sxs-lookup"><span data-stu-id="a80a8-144">Availability key secret stores</span></span>

<span data-ttu-id="a80a8-145">Microsoft 會保護存取控制 」、 「 內部秘密存放區類似於客戶使用 Azure 金鑰保存庫中的可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-145">Microsoft protects availability keys in access-controlled, internal secret stores similar to the customer-facing Azure Key Vault.</span></span> <span data-ttu-id="a80a8-146">我們實作存取控制，以防止 Microsoft 系統管理員無法直接存取中包含機密資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-146">We implement access controls to prevent Microsoft administrators from directly accessing the secrets contained within.</span></span> <span data-ttu-id="a80a8-147">密碼儲存作業，包括關鍵旋轉、 刪除及擷取發生透過自動化永遠不會牽涉到的直接存取權的可用性機碼的命令。</span><span class="sxs-lookup"><span data-stu-id="a80a8-147">Secret Store operations, including key rotation, deletion, and retrieval occur through automated commands that never involve direct access to the availability key.</span></span> <span data-ttu-id="a80a8-148">調整這些命令的存取限制在特定工程師，且需要透過內部的工具，加密箱的權限提升。</span><span class="sxs-lookup"><span data-stu-id="a80a8-148">Access to adjust these commands is limited to specific engineers and requires privilege escalation through an internal tool, Lockbox.</span></span> <span data-ttu-id="a80a8-149">權限提升需要管理員核准及之前要授與的正當理由。</span><span class="sxs-lookup"><span data-stu-id="a80a8-149">Privilege escalation requires manager approval and justification prior to being granted.</span></span> <span data-ttu-id="a80a8-150">Lockbox 可確保存取繫結與自動存取撤銷時的時間到期或工程師登出的時間。</span><span class="sxs-lookup"><span data-stu-id="a80a8-150">Lockbox ensures access is time bound with automatic access revocation upon time expiration or engineer log out.</span></span>

<span data-ttu-id="a80a8-151">**Exchange Online 和商務用 Skype**可用性機碼會儲存在 Active Directory 密碼存放區。</span><span class="sxs-lookup"><span data-stu-id="a80a8-151">**Exchange Online and Skype for Business** availability keys are stored in an Active Directory secret store.</span></span> <span data-ttu-id="a80a8-152">Exchange Online 的 Active Directory 是由將流量路由傳送的管理樹系並內含的物件、 身分識別和資料容量樹系所組成。</span><span class="sxs-lookup"><span data-stu-id="a80a8-152">Exchange Online Active Directory is comprised of Management forests that route traffic and Capacity forests that contain objects, identities, and data.</span></span> <span data-ttu-id="a80a8-153">容量的樹系是由帳戶樹系和資源樹系所組成。</span><span class="sxs-lookup"><span data-stu-id="a80a8-153">Capacity forests consist of Account forests and Resource forests.</span></span> <span data-ttu-id="a80a8-154">帳戶樹系具有多個容量網域控制站與另一個同步處理的。</span><span class="sxs-lookup"><span data-stu-id="a80a8-154">Account forests have multiple Capacity domain controllers that are synced with one another.</span></span> <span data-ttu-id="a80a8-155">可用性機碼是安全地儲存於這些容量網域控制站。</span><span class="sxs-lookup"><span data-stu-id="a80a8-155">Availability keys are securely stored within these Capacity domain controllers.</span></span> <span data-ttu-id="a80a8-156">此安全存放裝置位置是個別而獨立的 SharePoint Online、 商務用 OneDrive，以及小組檔案秘密存放區。</span><span class="sxs-lookup"><span data-stu-id="a80a8-156">This secure storage location is separate and isolated from the SharePoint Online, OneDrive for Business, and Teams files secret store.</span></span>

<span data-ttu-id="a80a8-157">**SharePoint Online、 商務用 OneDrive 和小組檔案**可用性機碼儲存在由服務小組內部秘密存放區。</span><span class="sxs-lookup"><span data-stu-id="a80a8-157">**SharePoint Online, OneDrive for Business, and Teams files** availability keys are stored in an internal secret store managed by the service team.</span></span> <span data-ttu-id="a80a8-158">這安全，機密資料儲存服務應用程式端點與 SQL 資料庫後端作為前端伺服器。</span><span class="sxs-lookup"><span data-stu-id="a80a8-158">This secured, secrets storage service has front-end servers with application endpoints and a SQL database as the back-end.</span></span> <span data-ttu-id="a80a8-159">可用性機碼會儲存在 SQL 資料庫，並會進行三重包裝 （加密） 所用的 AES 256 和 HMAC 組合來加密靜態的可用性索引鍵的秘密 store 加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-159">Availability keys are stored in the SQL database and are wrapped (encrypted) by secret store encryption keys that use a combination of AES-256 and HMAC to encrypt the availability key at rest.</span></span> <span data-ttu-id="a80a8-160">秘密 store 加密金鑰會儲存在相同的 SQL 資料庫的邏輯隔離元件，並進一步加密具有內含受管理的 Microsoft 憑證授權單位 (CA) 的憑證中的 RSA 2048 索引鍵。</span><span class="sxs-lookup"><span data-stu-id="a80a8-160">The secret store encryption keys are stored in a logically isolated component of the same SQL database and are further encrypted with RSA-2048 keys contained in certificates managed by the Microsoft certificate authority (CA).</span></span> <span data-ttu-id="a80a8-161">這些憑證會儲存在資料庫執行作業的秘密存放區前端伺服器。</span><span class="sxs-lookup"><span data-stu-id="a80a8-161">These certificates are stored in the secret store front-end servers that perform operations against the database.</span></span>

### <a name="defense-in-depth"></a><span data-ttu-id="a80a8-162">深度防禦</span><span class="sxs-lookup"><span data-stu-id="a80a8-162">Defense-in-depth</span></span>

<span data-ttu-id="a80a8-163">Microsoft 會採用防禦縱深策略以防止惡意的動作項目影響的機密性、 完整性或儲存在 Microsoft Cloud 中的客戶資料的可用性。</span><span class="sxs-lookup"><span data-stu-id="a80a8-163">Microsoft employs a defense-in-depth strategy to prevent malicious actors from impacting the confidentiality, integrity, or availability of customer data stored in the Microsoft Cloud.</span></span> <span data-ttu-id="a80a8-164">特定的預防性和偵查控制項所實作，以保護可用性金鑰做些安全性策略的一部分。</span><span class="sxs-lookup"><span data-stu-id="a80a8-164">Specific preventive and detective controls are implemented to protect the availability key as part of the overarching security strategy.</span></span>

<span data-ttu-id="a80a8-165">Office 365 內建以預防不當使用可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-165">Office 365 is built to prevent misuse of the availability key.</span></span> <span data-ttu-id="a80a8-166">應用程式層級是透過此機碼，包括可用性機碼，可以用來加密及解密資料的唯一方法。</span><span class="sxs-lookup"><span data-stu-id="a80a8-166">The application layer is the only method through which keys, including the availability key, can be used to encrypt and decrypt data.</span></span> <span data-ttu-id="a80a8-167">只有 Office 365 服務的程式碼有解譯及周遊加密和解密活動的金鑰階層的能力。</span><span class="sxs-lookup"><span data-stu-id="a80a8-167">Only Office 365 service code has the ability to interpret and traverse the key hierarchy for encryption and decryption activities.</span></span> <span data-ttu-id="a80a8-168">如果是惡意的 Microsoft 系統管理員來防止從秘密存放區擷取可用性機碼的控制項，機碼都無法使用存取客戶資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-168">If a malicious Microsoft administrator were to circumvent controls to extract an availability key from the secret store, the key would be unusable to access customer data.</span></span> <span data-ttu-id="a80a8-169">客戶金鑰的儲存位置、 可用性機碼，其他階層式金鑰和客戶資料，減少資料的風險的風險，萬一遭到洩漏一或多個位置之間存在邏輯隔離。</span><span class="sxs-lookup"><span data-stu-id="a80a8-169">Logical isolation exists between the storage locations of Customer Keys, availability keys, other hierarchical keys, and customer data, which mitigates the risk of data exposure in the event one or more locations are compromised.</span></span>

<span data-ttu-id="a80a8-170">若要避免未經授權的存取包括可用性金鑰秘密存放區的內部系統實作存取控制。</span><span class="sxs-lookup"><span data-stu-id="a80a8-170">Access controls are implemented to prevent unauthorized access to internal systems, including availability key secret stores.</span></span> <span data-ttu-id="a80a8-171">Microsoft 工程師不需要的可用性金鑰秘密存放區的直接存取。</span><span class="sxs-lookup"><span data-stu-id="a80a8-171">Microsoft engineers don't have direct access to the availability key secret stores.</span></span> <span data-ttu-id="a80a8-172">存取控制項上的其他詳細資訊，請先檢閱[Office 365 中的系統管理存取控制](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview)。</span><span class="sxs-lookup"><span data-stu-id="a80a8-172">For additional detail on access controls, review [Administrative Access Controls in Office 365](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview).</span></span>

<span data-ttu-id="a80a8-173">技術控制項登入高度為最低權限服務帳戶，可能用攻擊者模擬 Office 365 服務，以防止 Microsoft 人員。</span><span class="sxs-lookup"><span data-stu-id="a80a8-173">Technical controls prevent Microsoft personnel from logging into highly-privileged service accounts, which might otherwise be used by attackers to impersonate Office 365 services.</span></span> <span data-ttu-id="a80a8-174">例如，這些控制項防止互動式登入。</span><span class="sxs-lookup"><span data-stu-id="a80a8-174">For example, these controls prevent interactive logon.</span></span>

<span data-ttu-id="a80a8-175">安全性記錄及監視功能控制項是另一位深度防禦實作可保護減輕 Microsoft 服務和資料的風險。</span><span class="sxs-lookup"><span data-stu-id="a80a8-175">Security logging and monitoring controls are another defense-in-depth safeguard implemented that mitigate risk to Microsoft services and your data.</span></span> <span data-ttu-id="a80a8-176">Microsoft 服務小組已部署作用中的監視解決方案所產生的警示和稽核記錄。</span><span class="sxs-lookup"><span data-stu-id="a80a8-176">Microsoft service teams have deployed active monitoring solutions that generate alerts and audit logs.</span></span> <span data-ttu-id="a80a8-177">所有服務小組會將其記錄檔都上載至集中存放庫的記錄檔彙總，而處理。</span><span class="sxs-lookup"><span data-stu-id="a80a8-177">All service teams upload their logs to a central repository where the logs are aggregated and processed.</span></span> <span data-ttu-id="a80a8-178">內部工具會自動檢查記錄，以確認服務運作正常最佳、 彈性，且安全的狀態。</span><span class="sxs-lookup"><span data-stu-id="a80a8-178">Internal tools automatically examine records to confirm that services are functioning in an optimal, resilient, and secure state.</span></span> <span data-ttu-id="a80a8-179">不尋常的活動會標示為進一步檢閱。</span><span class="sxs-lookup"><span data-stu-id="a80a8-179">Unusual activity is flagged for further review.</span></span>

<span data-ttu-id="a80a8-180">任何記錄事件，表示潛在的 Microsoft 安全性原則違規情形會立即被帶到注意的 Microsoft 安全性小組。</span><span class="sxs-lookup"><span data-stu-id="a80a8-180">Any log event that indicates a potential violation of the Microsoft Security Policy is immediately brought to the attention of Microsoft security teams.</span></span> <span data-ttu-id="a80a8-181">Office 365 安全性已設定的警示，以偵測嘗試的存取可用性金鑰秘密存放區。</span><span class="sxs-lookup"><span data-stu-id="a80a8-181">Office 365 security has configured alerts to detect attempted access to availability key secret stores.</span></span> <span data-ttu-id="a80a8-182">如果 Microsoft 人員嘗試互動式登入服務帳戶，也就是禁止受保護的存取控制，也會產生警示。</span><span class="sxs-lookup"><span data-stu-id="a80a8-182">Alerts are also generated if Microsoft personnel attempt interactive logon to service accounts, which is prohibited and protected by access controls.</span></span> <span data-ttu-id="a80a8-183">Office 365 安全性也會偵測並在偏差從標準基準線上操作的 Office 365 服務時，系統會通知。</span><span class="sxs-lookup"><span data-stu-id="a80a8-183">Office 365 security also detects and alerts upon deviations of the Office 365 service from normal baseline operations.</span></span> <span data-ttu-id="a80a8-184">Malefactors 嘗試誤用 Office 365 服務會觸發警示產生冒犯者的收回 Microsoft 雲端環境中。</span><span class="sxs-lookup"><span data-stu-id="a80a8-184">Malefactors attempting to misuse Office 365 services would trigger alerts resulting in the offender's eviction from the Microsoft cloud environment.</span></span>

## <a name="use-the-availability-key-to-recover-from-key-loss"></a><span data-ttu-id="a80a8-185">使用復原金鑰遺失的可用性索引鍵</span><span class="sxs-lookup"><span data-stu-id="a80a8-185">Use the availability key to recover from key loss</span></span>

<span data-ttu-id="a80a8-186">如果您遺失的客戶金鑰控制，可用性機碼會提供您復原，並重新加密資料的能力。</span><span class="sxs-lookup"><span data-stu-id="a80a8-186">If you lose control of your Customer Keys, the availability key provides you the ability to recover and re-encrypt your data.</span></span>

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="a80a8-187">Exchange Online 和商務用 Skype 的復原程序</span><span class="sxs-lookup"><span data-stu-id="a80a8-187">Recovery procedure for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="a80a8-188">如果您遺失的客戶金鑰控制，可用性索引鍵仍會提供您復原時，您存取您的資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-188">If you lose control of your Customer Keys, the availability key will still provide you access to your data while you recover.</span></span> <span data-ttu-id="a80a8-189">若要使用新的客戶金鑰加密您的資料，在 Azure 金鑰保存庫中建立新的機碼，建立新的 DEP、 關聯至新的客戶金鑰，新 DEP 然後指示來加密目前加密與前一個 DEP 機碼已遺失或壓縮機信箱 DEPomised。</span><span class="sxs-lookup"><span data-stu-id="a80a8-189">To encrypt your data with new Customer Keys, create new keys in Azure Key Vault, create a new DEP, associate the new DEP to your new Customer Keys, then instruct the DEP to encrypt the mailboxes currently encrypted with the previous DEP for which the keys were lost or compromised.</span></span> <span data-ttu-id="a80a8-190">執行時，可用性機碼會解密可再進行加密與新原則的信箱。</span><span class="sxs-lookup"><span data-stu-id="a80a8-190">When performed, the availability key will decrypt the mailboxes which will then be encrypted with the new policy.</span></span>

<span data-ttu-id="a80a8-191">此程序可能需要多達 72 小時，也就是當您變更相依性的標準持續時間</span><span class="sxs-lookup"><span data-stu-id="a80a8-191">This process can take up to 72 hours, which is the standard duration when you change a DEP.</span></span>
  
### <a name="recovery-procedure-for-sharepointonlineonedriveforbusinessandteamsfiles"></a><span data-ttu-id="a80a8-192">復原程序的 SharePoint Online、 商務用 OneDrive 和小組檔案</span><span class="sxs-lookup"><span data-stu-id="a80a8-192">Recovery procedure for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="a80a8-193">SharePoint online、 商務用 OneDrive 和小組檔案可用性機碼是永不使用復原功能之外。</span><span class="sxs-lookup"><span data-stu-id="a80a8-193">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability.</span></span> <span data-ttu-id="a80a8-194">您必須明確地指示 Microsoft，以啟動期間復原案例中使用可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-194">You must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="a80a8-195">若要啟動的復原程序，請連絡 Microsoft，以啟用可用性金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-195">To initiate the recovery process, contact Microsoft to activate the availability key.</span></span> <span data-ttu-id="a80a8-196">一旦啟動，可用性索引鍵是自動用來解密您讓您可使用新建立的 DEP 關聯至新的客戶金鑰來加密資料的資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-196">Once activated, the availability key is automatically used to decrypt your data allowing you to encrypt the data with a newly-created DEP associated to new Customer Keys.</span></span>  

<span data-ttu-id="a80a8-197">這項作業是在您的組織中的網站數目成正比。</span><span class="sxs-lookup"><span data-stu-id="a80a8-197">This operation is proportional to the number of sites in your organization.</span></span> <span data-ttu-id="a80a8-198">一旦您呼叫 Microsoft，以使用可用性機碼，您應該會完全在線上約四個小時內。</span><span class="sxs-lookup"><span data-stu-id="a80a8-198">Once you call Microsoft to use the availability key, you should be fully online within about four hours.</span></span>

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a><span data-ttu-id="a80a8-199">Exchange Online 和商務用 Skype 如何使用可用性機碼</span><span class="sxs-lookup"><span data-stu-id="a80a8-199">How Exchange Online and Skype for Business use the availability key</span></span>

<span data-ttu-id="a80a8-200">當您建立 DEP 使用客戶金鑰時，Office 365 會產生該 DEP 相關聯的資料加密原則金鑰 （DEP 索引鍵）</span><span class="sxs-lookup"><span data-stu-id="a80a8-200">When you create a DEP with Customer Key, Office 365 generates a Data Encryption Policy Key (DEP Key) associated with that DEP.</span></span> <span data-ttu-id="a80a8-201">此服務會將 DEP 金鑰加密三次： 一次每個客戶金鑰與一次對可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-201">The service encrypts the DEP Key three times: once with each of the customer keys and once with the availability key.</span></span> <span data-ttu-id="a80a8-202">儲存僅限 DEP 金鑰加密的版本，並只可以使用客戶金鑰或可用性金鑰解密 DEP 金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-202">Only the encrypted versions of the DEP Key are stored, and a DEP Key can only be decrypted with the customer keys or the availability key.</span></span> <span data-ttu-id="a80a8-203">DEP 鍵然後用來加密信箱金鑰，然後用來加密個別的信箱。</span><span class="sxs-lookup"><span data-stu-id="a80a8-203">The DEP Key is then used to encrypt Mailbox Keys, which are then used to encrypt individual mailboxes.</span></span> 
  
<span data-ttu-id="a80a8-204">Office 365 會遵循此程序來解密，客戶會使用服務時提供資料：</span><span class="sxs-lookup"><span data-stu-id="a80a8-204">Office 365 follows this process to decrypt and provide data when customers are using the service:</span></span>
  
1. <span data-ttu-id="a80a8-205">使用客戶金鑰 DEP 金鑰解密。</span><span class="sxs-lookup"><span data-stu-id="a80a8-205">Decrypt the DEP Key using the Customer Key.</span></span>

2. <span data-ttu-id="a80a8-206">使用解密的 DEP 金鑰來解密信箱金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-206">Use the decrypted DEP Key to decrypt a Mailbox Key.</span></span>

3. <span data-ttu-id="a80a8-207">使用已解密的信箱金鑰來解密信箱本身，讓您存取信箱內的資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-207">Use the decrypted Mailbox Key to decrypt the mailbox itself, allowing you to access the data within the mailbox.</span></span>

<span data-ttu-id="a80a8-208">Office 365 會發出兩個解密要求至 Azure Key Vault，稍微偏移解密 DEP 機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-208">Office 365 decrypts a DEP Key by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="a80a8-209">若要完成的第一個提供結果，取消其他要求。</span><span class="sxs-lookup"><span data-stu-id="a80a8-209">The first one to finish furnishes the result, canceling the other request.</span></span>

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a><span data-ttu-id="a80a8-210">如何在 SharePoint Online、 商務用 OneDrive，以及小組檔案使用的可用性機碼</span><span class="sxs-lookup"><span data-stu-id="a80a8-210">How SharePoint Online, OneDrive for Business, and Teams files use the availability key</span></span>

<span data-ttu-id="a80a8-211">SharePoint Online 和 OneDrive for Business 架構、 實作客戶金鑰及可用性的機碼是不同於 Exchange Online 和商務用 Skype。</span><span class="sxs-lookup"><span data-stu-id="a80a8-211">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="a80a8-212">當組織移至客戶管理機碼時，Office 365 會建立租用戶特定中繼機碼 (TIK)。</span><span class="sxs-lookup"><span data-stu-id="a80a8-212">When an organization moves to customer-managed keys, Office 365 creates a tenant-specific intermediate key (TIK).</span></span> <span data-ttu-id="a80a8-213">Office 365 加密 TIK 兩次，一次使用每個客戶金鑰，並將儲存兩個 TIK 加密的版本。</span><span class="sxs-lookup"><span data-stu-id="a80a8-213">Office 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="a80a8-214">儲存 TIK 的加密的版本，以及 TIK 只能使用客戶金鑰解密。</span><span class="sxs-lookup"><span data-stu-id="a80a8-214">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="a80a8-215">TIK 然後用來加密網站金鑰，然後用來加密 blob 機碼 （也稱為檔案區塊機碼）。</span><span class="sxs-lookup"><span data-stu-id="a80a8-215">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys (also called file chunk keys).</span></span> <span data-ttu-id="a80a8-216">根據檔案大小，該服務可能檔案分割成多個檔案的區塊每個具有唯一索引鍵。</span><span class="sxs-lookup"><span data-stu-id="a80a8-216">Depending on file size, the service may split a file into multiple file chunks each with a unique key.</span></span> <span data-ttu-id="a80a8-217">Blob （檔案的區塊） 本身的 blob 機碼會使用加密且儲存在 Microsoft Azure Blob 儲存體服務。</span><span class="sxs-lookup"><span data-stu-id="a80a8-217">The blobs (file chunks) themselves are encrypted with the blob keys and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="a80a8-218">Office 365 會遵循此程序來解密，客戶會使用服務時提供客戶檔案：</span><span class="sxs-lookup"><span data-stu-id="a80a8-218">Office 365 follows this process to decrypt and provide customer files when customers are using the service:</span></span>

1. <span data-ttu-id="a80a8-219">解密使用客戶金鑰 TIK。</span><span class="sxs-lookup"><span data-stu-id="a80a8-219">Decrypt the TIK using the Customer Key.</span></span>

2. <span data-ttu-id="a80a8-220">使用解密的 TIK 網站金鑰解密。</span><span class="sxs-lookup"><span data-stu-id="a80a8-220">Use the decrypted TIK to decrypt a site key.</span></span>

3. <span data-ttu-id="a80a8-221">使用解密的網站金鑰來解密 blob 金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-221">Use the decrypted site key to decrypt a blob key.</span></span>

4. <span data-ttu-id="a80a8-222">使用解密的 blob 金鑰來解密 blob。</span><span class="sxs-lookup"><span data-stu-id="a80a8-222">Use the decrypted blob key to decrypt the blob.</span></span>

<span data-ttu-id="a80a8-223">Office 365 解密 TIK 發出兩個解密要求至 Azure Key Vault，稍微偏移。</span><span class="sxs-lookup"><span data-stu-id="a80a8-223">Office 365 decrypts a TIK by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="a80a8-224">若要完成的第一個提供結果，取消其他要求。</span><span class="sxs-lookup"><span data-stu-id="a80a8-224">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="a80a8-225">以防您會失去存取至您的客戶金鑰，Office 365 也使用可用性金鑰加密 TIK，並將此儲存以及與每個客戶金鑰加密 TIKs。</span><span class="sxs-lookup"><span data-stu-id="a80a8-225">In case you lose access to your customer keys, Office 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="a80a8-226">使用可用性金鑰加密 TIK 只適用於客戶會呼叫 Microsoft 編列復原路徑時遭到惡意或不小心，它們有其機碼，遺失存取。</span><span class="sxs-lookup"><span data-stu-id="a80a8-226">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="a80a8-227">對於可用性和規模原因，已解密的 TIKs 快取時間限制記憶體快取中。</span><span class="sxs-lookup"><span data-stu-id="a80a8-227">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="a80a8-228">兩個小時才能 TIK 快取設為過期，Office 365 會嘗試解密每個 TIK。</span><span class="sxs-lookup"><span data-stu-id="a80a8-228">Two hours before a TIK cache is set to expire, Office 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="a80a8-229">解密 TIKs 延伸的快取的存留期。</span><span class="sxs-lookup"><span data-stu-id="a80a8-229">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="a80a8-230">如果 TIK 解密失敗相當長的時間，Office 365 就會產生通知的快取到期時間之前工程警示。</span><span class="sxs-lookup"><span data-stu-id="a80a8-230">If TIK decryption fails for a significant amount of time, Office 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="a80a8-231">只有當客戶會呼叫 Microsoft Office 365 會起始復原作業，其中包括解密 TIK 和一組新的 Microsoft 秘密存放區和上架再次使用 [解密租用戶中儲存與可用性機碼 TIK 嗎客戶提供 Azure Key Vault 鍵。</span><span class="sxs-lookup"><span data-stu-id="a80a8-231">Only if the customer calls Microsoft will Office 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="a80a8-232">截至今天，客戶金鑰涉及儲存在 Azure blob 存放區，但不是 SharePoint Online 的清單項目或中繼資料儲存在 SQL 資料庫中的 SharePoint Online 檔案資料的加密和解密鏈結。</span><span class="sxs-lookup"><span data-stu-id="a80a8-232">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL database.</span></span> <span data-ttu-id="a80a8-233">Office 365 不會不使用可用性鍵用於 Exchange Online、 Skype 商務、 SharePoint Online、 商務用 OneDrive 和小組以外的案例上述，為客戶起始的檔案。</span><span class="sxs-lookup"><span data-stu-id="a80a8-233">Office 365 does not use the availability key for Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business, and Teams files other than the case described above, which is customer-initiated.</span></span> <span data-ttu-id="a80a8-234">客戶資料的人性化存取受保護的客戶加密箱。</span><span class="sxs-lookup"><span data-stu-id="a80a8-234">Human access to customer data is protected by Customer Lockbox.</span></span>

## <a name="availability-key-triggers"></a><span data-ttu-id="a80a8-235">可用性金鑰觸發程序</span><span class="sxs-lookup"><span data-stu-id="a80a8-235">Availability key triggers</span></span>

<span data-ttu-id="a80a8-236">Office 365 會觸發只在特定情況下的可用性索引鍵。</span><span class="sxs-lookup"><span data-stu-id="a80a8-236">Office 365 triggers the availability key only in specific circumstances.</span></span> <span data-ttu-id="a80a8-237">這些情況下會有所不同由服務。</span><span class="sxs-lookup"><span data-stu-id="a80a8-237">These circumstances differ by service.</span></span>

### <a name="triggers-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="a80a8-238">觸發程序的 Exchange Online 和商務用 Skype</span><span class="sxs-lookup"><span data-stu-id="a80a8-238">Triggers for Exchange Online and Skype for Business</span></span>
  
1. <span data-ttu-id="a80a8-239">Office 365 會讀取信箱來判斷 Azure 金鑰保存庫中的兩個客戶機碼位置指派 DEP。</span><span class="sxs-lookup"><span data-stu-id="a80a8-239">Office 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two Customer Keys in Azure Key Vault.</span></span>

2. <span data-ttu-id="a80a8-240">Office 365 隨機選擇下列其中一個兩個客戶金鑰從 DEP，然後將要求傳送至 Azure 金鑰保存庫解除包裝使用客戶金鑰 DEP 機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-240">Office 365 randomly chooses one of the two Customer Keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the Customer Key.</span></span>

3. <span data-ttu-id="a80a8-241">若要解除包裝使用客戶金鑰 DEP 機碼的要求失敗，Office 365 第二個將要求傳送至 Azure Key Vault，此時指示 」，以使用替代 （秒） 的客戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-241">If the request to unwrap the DEP key using the Customer Key fails, Office 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) Customer Key.</span></span>

4. <span data-ttu-id="a80a8-242">若要解除包裝使用客戶金鑰 DEP 機碼的第二個要求失敗，Office 365 會檢查這兩個要求的結果。</span><span class="sxs-lookup"><span data-stu-id="a80a8-242">If the second request to unwrap the DEP key using the Customer Key fails, Office 365 examines the results of both requests.</span></span>

    - <span data-ttu-id="a80a8-243">如果檢查判斷要求失敗傳回系統錯誤：</span><span class="sxs-lookup"><span data-stu-id="a80a8-243">If the examination determines that the requests failed returning a system ERROR:</span></span>

       - <span data-ttu-id="a80a8-244">Office 365 會觸發可用性金鑰來解密 DEP 金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80a8-244">Office 365 triggers the availability key to decrypt the DEP key.</span></span>

       - <span data-ttu-id="a80a8-245">Office 365 然後使用 DEP 金鑰來解密信箱金鑰並完成使用者要求。</span><span class="sxs-lookup"><span data-stu-id="a80a8-245">Office 365 then uses the DEP key to decrypt the mailbox key and complete the user request.</span></span> 

       - <span data-ttu-id="a80a8-246">在此情況下，Azure 金鑰保存庫是無法回應或無法存取之因為暫時性錯誤。</span><span class="sxs-lookup"><span data-stu-id="a80a8-246">In this case, Azure Key Vault is either unable to respond or unreachable due to a transient ERROR.</span></span>

    - <span data-ttu-id="a80a8-247">如果檢查判斷要求失敗傳回 「 拒絕存取 」:</span><span class="sxs-lookup"><span data-stu-id="a80a8-247">If the examination determines that the requests failed returning ACCESS DENIED:</span></span>

       - <span data-ttu-id="a80a8-248">這表示故意、 不慎或惡意巨集指令已採取來轉譯客戶金鑰無法使用 （例如，在過程資料清除一部分離開服務）。</span><span class="sxs-lookup"><span data-stu-id="a80a8-248">This means deliberate, inadvertent, or malicious action has been taken to render the customer keys unavailable (for example, during the data purge process as part of leaving the service).</span></span>

       - <span data-ttu-id="a80a8-249">在此情況下，將不會使用可用性金鑰、 使用者要求失敗，及使用者會收到錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="a80a8-249">In this case, the availability key will not be used, the user request fails, and the user receives an error message.</span></span>

>[!IMPORTANT]
><span data-ttu-id="a80a8-250">Office 365 服務的程式碼一定會具有隨手的有效登入 token 優先提供的值新增雲端服務的客戶資料。</span><span class="sxs-lookup"><span data-stu-id="a80a8-250">Office 365 service code always has a valid login token for reasoning over customer data to provide value-adding cloud services.</span></span> <span data-ttu-id="a80a8-251">因此，直到可用性金鑰已遭刪除，它可用於做為後援動作，起始，或是內部、 建立或移動信箱 Exchange Online 與 Skype for Business，例如搜尋編製索引。</span><span class="sxs-lookup"><span data-stu-id="a80a8-251">Therefore, until the availability key has been deleted, it can be used as a fallback for actions initiated by, or internal to, Exchange Online and Skype for Business such as search index creation or moving mailboxes.</span></span> <span data-ttu-id="a80a8-252">這適用於這兩種暫時性錯誤，以及 Azure Key Vault 拒絕存取要求。</span><span class="sxs-lookup"><span data-stu-id="a80a8-252">This applies to both transient ERRORS and ACCESS DENIED requests to Azure Key Vault.</span></span>

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="a80a8-253">SharePoint online、 商務用 OneDrive，以及小組會觸發檔案</span><span class="sxs-lookup"><span data-stu-id="a80a8-253">Triggers for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="a80a8-254">SharePoint online、 商務用 OneDrive 和小組檔案，可用性的重點是永不使用復原功能之外，和客戶必須明確地指示 Microsoft，以啟動期間復原案例中使用可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-254">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span>

## <a name="audit-logs-and-the-availability-key"></a><span data-ttu-id="a80a8-255">稽核記錄和可用性機碼</span><span class="sxs-lookup"><span data-stu-id="a80a8-255">Audit logs and the availability key</span></span>

<span data-ttu-id="a80a8-256">自動化 Office 365 程序中的系統的所有資料在流過系統，以提供雲端服務，例如防毒、 e-探索、 資料遺失防護，資料編製索引。</span><span class="sxs-lookup"><span data-stu-id="a80a8-256">Automated systems in Office 365 process all data as it flows through the system to provide cloud services, for example, anti-virus, e-discovery, data loss prevention, and data indexing.</span></span> <span data-ttu-id="a80a8-257">Office 365 並不會產生執行活動的客戶顯示記錄檔。</span><span class="sxs-lookup"><span data-stu-id="a80a8-257">Office 365 does not generate customer-visible logs for this activity.</span></span> <span data-ttu-id="a80a8-258">此外，Microsoft 人員不存取您的資料，這些一般系統作業的一部分。</span><span class="sxs-lookup"><span data-stu-id="a80a8-258">In addition, Microsoft personnel do not access your data as part of these normal system operations.</span></span>

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a><span data-ttu-id="a80a8-259">Exchange Online 與 Skype for Business 可用性索引鍵記錄</span><span class="sxs-lookup"><span data-stu-id="a80a8-259">Exchange Online and Skype for Business availability key logging</span></span>

<span data-ttu-id="a80a8-260">Exchange Online 和商務用 Skype 會自動在暫時性錯誤期間使用的可用性機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-260">Exchange Online and Skype for Business automatically use the availability key during transient errors.</span></span> <span data-ttu-id="a80a8-261">這個後援發生時，Office 365 會發佈客戶顯示記錄檔可存取的安全性與合規性中心。</span><span class="sxs-lookup"><span data-stu-id="a80a8-261">When this fallback occurs, Office 365 publishes customer-visible logs accessible from the Security and Compliance Center.</span></span> <span data-ttu-id="a80a8-262">可用性金鑰作業的稽核記錄檔記錄就會產生這些服務切換到使用可用性金鑰每次。</span><span class="sxs-lookup"><span data-stu-id="a80a8-262">An audit log record for the availability key operation is generated each time these services switch to using the availability key.</span></span> <span data-ttu-id="a80a8-263">新的記錄類型，呼叫活動類型 「 後援到可用性的金鑰 」 與 「 客戶金鑰服務加密 」 可讓系統管理員來篩選[整合的稽核記錄](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance)搜尋結果，以檢視可用性索引鍵記錄。</span><span class="sxs-lookup"><span data-stu-id="a80a8-263">A new record type called “Customer Key Service Encryption” with activity type "Fallback to Availability Key" allows admins to filter [Unified Audit Log](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance) search results to view availability key records.</span></span> <span data-ttu-id="a80a8-264">可用性索引鍵記錄取得產生只有當客戶金鑰可用來存取資料時，不能用於 Microsoft 服務受管理的機碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-264">The availability key record gets generated only when Customer Key is used to access the data and not for Microsoft service-managed keys.</span></span>

<span data-ttu-id="a80a8-265">記錄包含屬性，例如日期、 時間、 活動、 組織識別碼，以及資料加密原則識別碼。</span><span class="sxs-lookup"><span data-stu-id="a80a8-265">Log records include attributes such as date, time, activity, organization ID, and data encryption policy ID.</span></span> <span data-ttu-id="a80a8-266">記錄會提供 Office 365 整合的稽核記錄的一部分且可存取 [Office 365 安全性與合規性中心的稽核記錄搜尋] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="a80a8-266">The record is available as part of Office 365 Unified Audit Logs and is accessible from the Office 365 Security and Compliance Center Audit Log Search tab.</span></span>

![稽核記錄搜尋可用性重要事件](media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

<span data-ttu-id="a80a8-268">Exchange Online 與 Skype 商務可用性索引鍵記錄使用與 Office 365 管理活動[常見的結構描述](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema)新增自訂的參數： 原則識別碼、 範圍金鑰版本 Id 及要求 id。</span><span class="sxs-lookup"><span data-stu-id="a80a8-268">Exchange Online and Skype for Business availability key records use the Office 365 Management Activity [common schema](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) with added custom parameters: Policy Id, Scope Key Version Id, and Request Id.</span></span>

![可用性金鑰的自訂參數](media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a><span data-ttu-id="a80a8-270">SharePoint Online、 商務用 OneDrive，以及小組檔案可用性索引鍵記錄</span><span class="sxs-lookup"><span data-stu-id="a80a8-270">SharePoint Online, OneDrive for Business, and Teams files availability key logging</span></span>

<span data-ttu-id="a80a8-271">可用性索引鍵記錄並未提供這些服務的尚未。</span><span class="sxs-lookup"><span data-stu-id="a80a8-271">Availability key logging isn't available yet for these services.</span></span> <span data-ttu-id="a80a8-272">SharePoint Online、 商務用 OneDrive 和小組檔案，可用性時，用於復原用途另外指示機碼僅 Microsoft，以啟動。</span><span class="sxs-lookup"><span data-stu-id="a80a8-272">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is only activated by Microsoft, when instructed by you, for recovery purposes.</span></span> <span data-ttu-id="a80a8-273">因此，您已知道每個可用性機碼用於這些服務的事件。</span><span class="sxs-lookup"><span data-stu-id="a80a8-273">As a result, you already know every event in which the availability key is used for these services.</span></span>

## <a name="availability-key-in-the-customer-key-hierarchy"></a><span data-ttu-id="a80a8-274">客戶金鑰階層中的可用性機碼</span><span class="sxs-lookup"><span data-stu-id="a80a8-274">Availability key in the Customer Key hierarchy</span></span>
  
<span data-ttu-id="a80a8-275">Office 365 會使用可用性金鑰來為客戶金鑰服務加密所建立的金鑰階層中包裝的機碼較低層。</span><span class="sxs-lookup"><span data-stu-id="a80a8-275">Office 365 uses the availability key to wrap the tier of keys lower in the key hierarchy established for Customer Key service encryption.</span></span> <span data-ttu-id="a80a8-276">服務之間有不同的金鑰階層。</span><span class="sxs-lookup"><span data-stu-id="a80a8-276">Different key hierarchies exist between services.</span></span> <span data-ttu-id="a80a8-277">可用性機碼和其他金鑰階層中的每個適用的服務之間的演算法也不同。</span><span class="sxs-lookup"><span data-stu-id="a80a8-277">Key algorithms also differ between availability keys and other keys in the hierarchy of each applicable service.</span></span> <span data-ttu-id="a80a8-278">不同服務所使用的可用性演算法如下所示：</span><span class="sxs-lookup"><span data-stu-id="a80a8-278">The availability key algorithms used by the different services are as follows:</span></span>

- <span data-ttu-id="a80a8-279">Exchange Online 與 Skype for Business 可用性機碼使用 AES 256。</span><span class="sxs-lookup"><span data-stu-id="a80a8-279">The Exchange Online and Skype for Business availability keys use AES-256.</span></span>

- <span data-ttu-id="a80a8-280">SharePoint Online、 商務用 OneDrive，以及小組檔案可用性機碼使用 RSA 2048。</span><span class="sxs-lookup"><span data-stu-id="a80a8-280">The SharePoint Online, OneDrive for Business, and Teams files availability keys use RSA-2048.</span></span>

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="a80a8-281">加密 cipher 用來加密金鑰，Exchange Online 和商務用 Skype</span><span class="sxs-lookup"><span data-stu-id="a80a8-281">Encryption ciphers used to encrypt keys for Exchange Online and Skype for Business</span></span>

![Exchange Online 客戶金鑰加密 cipher](media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="a80a8-283">用來加密金鑰，SharePoint Online 和商務用 OneDrive 加密 cipher</span><span class="sxs-lookup"><span data-stu-id="a80a8-283">Encryption ciphers used to encrypt keys for SharePoint Online and OneDrive for Business</span></span>

![SharePoint Online 客戶金鑰加密 cipher](media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a><span data-ttu-id="a80a8-285">相關文章</span><span class="sxs-lookup"><span data-stu-id="a80a8-285">Related articles</span></span>

- [<span data-ttu-id="a80a8-286">Office 365 使用客戶金鑰服務加密</span><span class="sxs-lookup"><span data-stu-id="a80a8-286">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="a80a8-287">設定 Office 365 客戶金鑰</span><span class="sxs-lookup"><span data-stu-id="a80a8-287">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="a80a8-288">管理 office 365 的客戶金鑰</span><span class="sxs-lookup"><span data-stu-id="a80a8-288">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="a80a8-289">展開或旋轉客戶金鑰或可用性機碼</span><span class="sxs-lookup"><span data-stu-id="a80a8-289">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)
