---
title: Office 365 中使用客戶金鑰的服務加密常見問題集
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 7/31/2018
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 41ae293a-bd5c-4083-acd8-e1a2b4329da6
description: 除了通过 BitLocker 和分布式密钥管理器 （DKM） 启用的基准卷级加密外，Office 365 还为 Office 365 中的客户内容（包括来自 Exchange 的数据）在应用程序级别提供了额外的加密层联机、Skype 业务、共享点联机和一个业务驱动器。 这称为服务加密。
ms.openlocfilehash: 8b15369571e3a6c021ae0c7337782a0d64436297
ms.sourcegitcommit: 1162d676b036449ea4220de8a6642165190e3398
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2019
ms.locfileid: "37077408"
---
# <a name="service-encryption-with-customer-key-for-office-365-faq"></a><span data-ttu-id="92e01-104">Office 365 中使用客戶金鑰的服務加密常見問題集</span><span class="sxs-lookup"><span data-stu-id="92e01-104">Service encryption with Customer Key for Office 365 FAQ</span></span>

<span data-ttu-id="92e01-105">除了通过 BitLocker 和分布式密钥管理器 （DKM） 启用的基准卷级加密外，Office 365 还为 Office 365 中的客户内容（包括来自 Exchange 的数据）在应用程序级别提供了额外的加密层联机、Skype 业务、共享点联机和一个业务驱动器。</span><span class="sxs-lookup"><span data-stu-id="92e01-105">In addition to the baseline, volume-level encryption that's enabled through BitLocker and Distributed Key Manager (DKM), Office 365 offers an added layer of encryption at the application level for customer content in Office 365, including data from Exchange Online, Skype for Business, SharePoint Online, and OneDrive for Business.</span></span> <span data-ttu-id="92e01-106">这称为服务加密。</span><span class="sxs-lookup"><span data-stu-id="92e01-106">This is called service encryption.</span></span>
  
<span data-ttu-id="92e01-107">客户密钥基于服务加密构建，使您能够提供和控制用于在 Office 365 中加密静态数据的[密钥，如在线服务条款 （OST）](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中所述。</span><span class="sxs-lookup"><span data-stu-id="92e01-107">Customer Key is built on service encryption and enables you to provide and control keys that are used to encrypt your data at rest in Office 365 as described in the [Online Services Terms (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx).</span></span> <span data-ttu-id="92e01-108">客戶金鑰可協助您符合規範，因為您可以控制加密金鑰，Office 365 會使用該金鑰來解密資料。</span><span class="sxs-lookup"><span data-stu-id="92e01-108">Customer Key helps you meet compliance obligations because you control the encryption keys that Office 365 uses to decrypt data.</span></span>
  
<span data-ttu-id="92e01-109">要提供有关客户密钥（包括文档）的反馈，请将您的想法、建议和观点发送给customerkeyfeedback@microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="92e01-109">To provide feedback on Customer Key, including the documentation, send your ideas, suggestions, and perspectives to customerkeyfeedback@microsoft.com.</span></span>
  
## <a name="what-is-service-encryption-with-customer-key"></a><span data-ttu-id="92e01-110">什么是使用客户密钥的服务加密？</span><span class="sxs-lookup"><span data-stu-id="92e01-110">What is service encryption with Customer Key?</span></span>

<span data-ttu-id="92e01-111">客户密钥增强了您的组织满足法规遵从性要求的能力，这些要求指定与云服务提供商的关键安排。</span><span class="sxs-lookup"><span data-stu-id="92e01-111">Customer Key enhances the ability of your organization to meet the demands of compliance requirements that specify key arrangements with the cloud service provider.</span></span> <span data-ttu-id="92e01-112">使用客户密钥，您可以在应用程序级别提供和控制 Office 365 静态数据的加密密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-112">With Customer Key, you provide and control the encryption keys for your Office 365 data at-rest at the application level.</span></span> <span data-ttu-id="92e01-113">因此，如果您决定退出服务，您可以行使控制权并撤销组织的密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-113">As a result, you may exercise control and revoke your organization's keys, should you decide to exit the service.</span></span> <span data-ttu-id="92e01-114">通过吊销密钥，服务无法读取数据。</span><span class="sxs-lookup"><span data-stu-id="92e01-114">By revoking the keys, the data is unreadable to the service.</span></span> <span data-ttu-id="92e01-115">密钥吊销是数据删除路径上的第一步。</span><span class="sxs-lookup"><span data-stu-id="92e01-115">Key revocation is the first step on the path towards data deletion.</span></span>

## <a name="what-office-365-data-at-rest-is-covered-by-customer-key"></a><span data-ttu-id="92e01-116">客户密钥涵盖哪些 Office 365 静止数据？</span><span class="sxs-lookup"><span data-stu-id="92e01-116">What Office 365 data at rest is covered by Customer Key?</span></span>
<span data-ttu-id="92e01-117"><a name="WhatDataIsCoveredbyCustomerKey"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-117"></span></span>

<span data-ttu-id="92e01-118">涵盖 SharePoint 在线网站内容以及存储在该网站上的文件以及上传到 OneDrive 商业版的文件。</span><span class="sxs-lookup"><span data-stu-id="92e01-118">SharePoint Online site content and the files stored on that site and files uploaded to OneDrive for Business are covered.</span></span> <span data-ttu-id="92e01-119">涵盖 Exchange 联机邮箱内容（电子邮件正文、日历条目和电子邮件附件的内容）。</span><span class="sxs-lookup"><span data-stu-id="92e01-119">Exchange Online mailbox content (e-mail body, calendar entries, and content of email attachments) is covered.</span></span> <span data-ttu-id="92e01-120">涵盖来自 Skype 商务的文字对话，但不涵盖 Skype 会议广播录制和 Skype 会议内容上载。</span><span class="sxs-lookup"><span data-stu-id="92e01-120">Text conversations from Skype for Business are covered, but Skype Meeting Broadcast recordings and Skype Meeting content uploads are not covered.</span></span> <span data-ttu-id="92e01-121">Skype 会议广播和 Skype 会议内容上载与 Office 365 中的所有其他内容一起加密，但我们目前不提供客户对加密密钥的控制。</span><span class="sxs-lookup"><span data-stu-id="92e01-121">Skype Meeting Broadcast and Skype Meeting content uploads are encrypted along with all other content in Office 365, but we currently don't offer customer control of the encryption keys.</span></span>
  
## <a name="what-is-the-difference-between-customer-key-and-bring-your-own-key-byok-with-azure-information-protection-for-exchange-online"></a><span data-ttu-id="92e01-122">使用 Azure 信息保护进行联机交换，客户密钥和自带密钥 （BYOK） 之间的区别是什么？</span><span class="sxs-lookup"><span data-stu-id="92e01-122">What is the difference between Customer Key and Bring Your Own Key (BYOK) with Azure Information Protection for Exchange Online?</span></span>
<span data-ttu-id="92e01-123"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-123"></span></span>

<span data-ttu-id="92e01-124">这两个选项都使您能够提供和控制自己的加密密钥;但是，使用客户密钥的服务加密在静态时加密您的数据，驻留在 Office 365 服务器中，而具有 Azure 联机交换信息保护的 BYOK 加密传输中的数据并提供持续的联机和脱机Office 365 的电子邮件和附件的保护。</span><span class="sxs-lookup"><span data-stu-id="92e01-124">Both options enable you to provide and control your own encryption keys; however, service encryption with Customer Key encrypts your data at rest, residing in Office 365 servers at-rest, while BYOK with Azure Information Protection for Exchange Online encrypts your data-in-transit and provides persistent online and offline protection for email messages and attachments for Office 365.</span></span> <span data-ttu-id="92e01-125">具有 Azure 在线交换信息保护的客户密钥和 BYOK 是互补的，无论您选择使用 Microsoft 的服务托管密钥还是您自己的密钥，加密静态和传输中的数据都可以提供额外的保护。恶意攻击。</span><span class="sxs-lookup"><span data-stu-id="92e01-125">Customer Key and BYOK with Azure Information Protection for Exchange Online are complementary, and whether you choose to use Microsoft's service-managed keys or your own keys, encrypting your data-at-rest and in-transit can provide added protection from malicious attacks.</span></span>
  
<span data-ttu-id="92e01-126">Office 365 消息加密功能提供了具有 Azure 联机交换信息保护的 BYOK。</span><span class="sxs-lookup"><span data-stu-id="92e01-126">BYOK with Azure Information Protection for Exchange Online is offered in the Office 365 Message Encryption capabilities.</span></span>
  
## <a name="does-office-365-message-encryption-and-bring-your-own-key-with-azure-information-protection-change-microsofts-approach-to-third-party-data-requests-such-as-subpoenas"></a><span data-ttu-id="92e01-127">Office 365 消息加密和自带密钥的 Azure 信息保护是否改变了 Microsoft 处理第三方数据请求（如传票）的方法？</span><span class="sxs-lookup"><span data-stu-id="92e01-127">Does Office 365 Message Encryption and Bring Your Own Key with Azure Information Protection change Microsoft's approach to third-party data requests such as subpoenas?</span></span>
<span data-ttu-id="92e01-128"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-128"></span></span>

<span data-ttu-id="92e01-129">否。</span><span class="sxs-lookup"><span data-stu-id="92e01-129">No.</span></span> <span data-ttu-id="92e01-130">Office 365 消息加密以及使用自带密钥 （BYOK） 提供和控制自己的加密密钥的选项不是针对执法传票而设计的。</span><span class="sxs-lookup"><span data-stu-id="92e01-130">Office 365 Message Encryption and the option to provide and control your own encryption keys with Bring Your Own Key (BYOK) for Azure Information Protection was not designed to respond to law enforcement subpoenas.</span></span> <span data-ttu-id="92e01-131">Office 365 消息加密与 BYOK AIP 专为需要履行其内部或外部合规性义务的以合规性为中心的客户而设计。</span><span class="sxs-lookup"><span data-stu-id="92e01-131">Office 365 Message Encryption with BYOK for AIP was designed for compliance focused customers that need to meet their internal or external compliance obligations.</span></span> <span data-ttu-id="92e01-132">微软非常重视第三方对客户数据的请求。</span><span class="sxs-lookup"><span data-stu-id="92e01-132">Microsoft takes third-party requests for customer data very seriously.</span></span> <span data-ttu-id="92e01-133">作为云服务提供商，我们始终倡导客户数据的隐私。</span><span class="sxs-lookup"><span data-stu-id="92e01-133">As a cloud service provider, we always advocate for the privacy of customer data.</span></span> <span data-ttu-id="92e01-134">如果我们收到传票，我们总是试图将第三方重定向到客户以获取信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-134">In the event we get a subpoena, we always attempt to redirect the third party to the customer to obtain the information.</span></span> <span data-ttu-id="92e01-135">（请阅读布拉德·史密斯的博客：[保护客户数据免受政府窥探）。](https://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)</span><span class="sxs-lookup"><span data-stu-id="92e01-135">(Please read Brad Smith's blog: [Protecting customer data from government snooping](https://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)).</span></span> <span data-ttu-id="92e01-136">我们定期公布[我们在这里](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)收到的请求的详细信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-136">We periodically publish detailed information of the request we receive [here](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data).</span></span>
  
<span data-ttu-id="92e01-137">有关详细信息，请参阅[Microsoft 信任中心，](https://www.microsoft.com/en-us/trustcenter/default.aspx)了解第三方数据请求和[在线服务条款 （OST）](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中的"客户数据泄露"。</span><span class="sxs-lookup"><span data-stu-id="92e01-137">See the [Microsoft Trust Center](https://www.microsoft.com/en-us/trustcenter/default.aspx) regarding third-party data requests and "Disclosure of Customer Data" in the [Online Services Terms (OST) ](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)for more information.</span></span>
  
## <a name="does-service-encryption-with-customer-key-change-microsofts-approach-to-third-party-data-requests-such-as-subpoenas"></a><span data-ttu-id="92e01-138">使用客户密钥的服务加密是否改变了 Microsoft 处理第三方数据请求（如传票）的方法？</span><span class="sxs-lookup"><span data-stu-id="92e01-138">Does service encryption with Customer Key change Microsoft's approach to third-party data requests such as subpoenas?</span></span>
<span data-ttu-id="92e01-139"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-139"></span></span>

<span data-ttu-id="92e01-140">否。</span><span class="sxs-lookup"><span data-stu-id="92e01-140">No.</span></span> <span data-ttu-id="92e01-141">客户密钥并非旨在响应执法传票。</span><span class="sxs-lookup"><span data-stu-id="92e01-141">Customer Key was not designed to respond to law enforcement subpoenas.</span></span> <span data-ttu-id="92e01-142">它专为受监管客户设计，以履行其内部或外部合规义务。</span><span class="sxs-lookup"><span data-stu-id="92e01-142">It was designed for regulated customers to meet their internal or external compliance obligations.</span></span> <span data-ttu-id="92e01-143">微软非常重视第三方对客户数据的请求。</span><span class="sxs-lookup"><span data-stu-id="92e01-143">Microsoft takes third-party requests for customer data very seriously.</span></span> <span data-ttu-id="92e01-144">作为云服务提供商，我们始终倡导客户数据的隐私。</span><span class="sxs-lookup"><span data-stu-id="92e01-144">As a cloud service provider, we always advocate for the privacy of customer data.</span></span> <span data-ttu-id="92e01-145">如果我们收到传票，我们总是试图将第三方重定向到客户以获取信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-145">In the event we get a subpoena, we always attempt to redirect the third party to the customer to obtain the information.</span></span> <span data-ttu-id="92e01-146">（请阅读布拉德·史密斯的博客：[保护客户数据免受政府窥探）。](http://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)</span><span class="sxs-lookup"><span data-stu-id="92e01-146">(Please read Brad Smith's blog: [Protecting customer data from government snooping](http://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)).</span></span> <span data-ttu-id="92e01-147">我们定期公布[我们在这里](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)收到的请求的详细信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-147">We periodically publish detailed information of the request we receive [here](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data).</span></span>
  
<span data-ttu-id="92e01-148">有关详细信息，请参阅[Microsoft 信任中心，](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)了解第三方数据请求和[在线服务条款 （OST）](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中的"客户数据泄露"。</span><span class="sxs-lookup"><span data-stu-id="92e01-148">See the [Microsoft Trust Center](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data) regarding third-party data requests and "Disclosure of Customer Data" in the [Online Services Terms (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx) for more information.</span></span> 
  
## <a name="is-fasttrack-support-available-for-implementing-customer-key"></a><span data-ttu-id="92e01-149">FastTrack 支持是否可用于实施客户密钥？</span><span class="sxs-lookup"><span data-stu-id="92e01-149">Is FastTrack support available for implementing Customer Key?</span></span>
<span data-ttu-id="92e01-150"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-150"></span></span>

<span data-ttu-id="92e01-151">否。</span><span class="sxs-lookup"><span data-stu-id="92e01-151">No.</span></span> <span data-ttu-id="92e01-152">FastTrack 仅用于收集注册客户密钥所需的租户和服务配置信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-152">FastTrack is only used to collect tenant and service configuration information that is required to register for Customer Key.</span></span> <span data-ttu-id="92e01-153">客户密钥产品/服务通过 FastTrack 发布，以便客户和合作伙伴能够使用相同的方法提交所需信息，并便于存档客户在产品/服务中提供的数据。</span><span class="sxs-lookup"><span data-stu-id="92e01-153">The Customer Key Offers are published via FastTrack so that it is convenient for customers and partners to submit this required information using the same method and for ease of archiving the data that customers provide in the Offer.</span></span>
  
<span data-ttu-id="92e01-154">如果您需要文档之外的其他支持，请与 Microsoft 咨询服务 （MCS）、卓越现场工程 （PFE） 或 Microsoft 合作伙伴联系以获得帮助。</span><span class="sxs-lookup"><span data-stu-id="92e01-154">If you need additional support beyond the documentation, contact Microsoft Consulting Services (MCS), Premier Field Engineering (PFE), or a Microsoft partner for assistance.</span></span>
  
## <a name="if-my-keys-are-destroyed-how-can-i-recover"></a><span data-ttu-id="92e01-155">如果我的钥匙已销毁，如何恢复？</span><span class="sxs-lookup"><span data-stu-id="92e01-155">If my keys are destroyed, how can I recover?</span></span>
<span data-ttu-id="92e01-156"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-156"></span></span>

<span data-ttu-id="92e01-157">可用性密钥使您能够从您管理的根密钥的意外丢失中恢复。</span><span class="sxs-lookup"><span data-stu-id="92e01-157">The availability key provides you with the capability to recover from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="92e01-158">如果丢失根密钥，请与 Microsoft 支持部门联系，Microsoft 将协助您完成启用可用性密钥的过程。</span><span class="sxs-lookup"><span data-stu-id="92e01-158">If you lose your root keys, contact Microsoft Support and Microsoft will assist you through the process of enabling the availability key.</span></span> <span data-ttu-id="92e01-159">您将使用可用性密钥迁移到新的数据加密策略，并预配新密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-159">You'll use the availability key to migrate to a new Data Encryption Policy with new keys provisioned by you.</span></span> 
  
## <a name="what-is-the-availability-key"></a><span data-ttu-id="92e01-160">可用性密钥是什么？</span><span class="sxs-lookup"><span data-stu-id="92e01-160">What is the availability key?</span></span>
<span data-ttu-id="92e01-161"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-161"></span></span>

<span data-ttu-id="92e01-162">可用性密钥是在创建数据加密策略时预配的根密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-162">The availability key is a root key that is provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="92e01-163">可用性密钥在 Office 365 中存储和保护，在功能上类似于您提供的两个根密钥，用于与客户密钥一起使用的服务加密。</span><span class="sxs-lookup"><span data-stu-id="92e01-163">The availability key is stored and protected within Office 365 and is functionally similar to the two root keys that are supplied by you for use with service encryption with Customer Key.</span></span> <span data-ttu-id="92e01-164">与在 Azure 密钥保管库中提供和管理的密钥不同，您无法直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-164">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="92e01-165">可用性密钥的存储和控制与 Azure 密钥保管库密钥的存储和控制故意不同，原因有三：首先，在 Office 365 服务无法访问 Azure 密钥中托管的密钥时，可用性密钥提供了高可用性功能保险柜;其次，在 Azure 密钥保管库密钥都丢失的情况下，可用性密钥提供"碎玻璃"功能;第三，逻辑控件的分离提供纵深防御，防止单个攻击或故障点丢失所有键。</span><span class="sxs-lookup"><span data-stu-id="92e01-165">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons: first, the availability key provides a high-availability capability in the event that Office 365 services are unable to reach keys hosted in Azure Key Vault; second, the availability key provides a "break glass" capability in the event that both Azure Key Vault keys are lost; and third, the separation of logical controls provides defense-in-depth and protects against the loss of all keys from a single attack or point of failure.</span></span> <span data-ttu-id="92e01-166">分担保护密钥的责任，同时使用各种保护和流程进行密钥管理，最终降低了所有密钥（以及您的数据）丢失或销毁的风险。</span><span class="sxs-lookup"><span data-stu-id="92e01-166">Sharing the responsibility to protect the keys, while using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be lost or destroyed.</span></span> <span data-ttu-id="92e01-167">Microsoft 为您提供了销毁可用性密钥的唯一权限。</span><span class="sxs-lookup"><span data-stu-id="92e01-167">Microsoft provides you with sole authority over the destruction of the availability key.</span></span> <span data-ttu-id="92e01-168">根据设计，Microsoft 中没有人能够访问可用性密钥 - 它只能由 Office 365 服务代码访问。</span><span class="sxs-lookup"><span data-stu-id="92e01-168">By design, no one at Microsoft has access to the availability key - it is only accessible by Office 365 service code.</span></span>
  
## <a name="how-many-data-encryption-policies-deps-can-i-create"></a><span data-ttu-id="92e01-169">我可以创建多少个数据加密策略 （DEP）？</span><span class="sxs-lookup"><span data-stu-id="92e01-169">How many data encryption policies (DEPs) can I create?</span></span>
<span data-ttu-id="92e01-170"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-170"></span></span>

 <span data-ttu-id="92e01-171">**交换在线和 Skype 业务：** 您最多只能创建 50 个 DEP。</span><span class="sxs-lookup"><span data-stu-id="92e01-171">**Exchange Online and Skype for Business:** You can create up to 50 DEPs.</span></span> 
  
 <span data-ttu-id="92e01-172">**共享点在线和一个驱动器的业务：** DEP 适用于一个地理位置（也称为地理）中的数据。</span><span class="sxs-lookup"><span data-stu-id="92e01-172">**SharePoint Online and OneDrive for Business:** A DEP applies to data in one geographic location, also called a geo.</span></span> <span data-ttu-id="92e01-173">如果使用 Office 365 的多地理位置功能，则可以每个地理位置创建一个 DEP。</span><span class="sxs-lookup"><span data-stu-id="92e01-173">If you use the multi-geo feature of Office 365, you can create one DEP per geo.</span></span> <span data-ttu-id="92e01-174">如果不使用多地理位置，可以创建一个 DEP。</span><span class="sxs-lookup"><span data-stu-id="92e01-174">If you are not using multi-geo, you can create one DEP.</span></span>
  
## <a name="can-i-assign-a-data-encryption-policy-before-migrating-a-mailbox-to-the-cloud"></a><span data-ttu-id="92e01-175">在将邮箱迁移到云之前，是否可以分配数据加密策略？</span><span class="sxs-lookup"><span data-stu-id="92e01-175">Can I assign a data encryption policy before migrating a mailbox to the cloud?</span></span>
<span data-ttu-id="92e01-176"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-176"></span></span>

<span data-ttu-id="92e01-177">可以。</span><span class="sxs-lookup"><span data-stu-id="92e01-177">Yes.</span></span> <span data-ttu-id="92e01-178">在将邮箱迁移到 Office 365 之前，可以使用 Windows PowerShell cmdlet Set-Mail 用户向用户分配数据加密策略 （DEP）。</span><span class="sxs-lookup"><span data-stu-id="92e01-178">You can use the Windows PowerShell cmdlet Set-MailUser to assign a data encryption policy (DEP) to the user prior to migrating the mailbox to Office 365.</span></span> <span data-ttu-id="92e01-179">执行此操作时，在迁移内容时将使用分配的 DEP 对邮箱内容进行加密。</span><span class="sxs-lookup"><span data-stu-id="92e01-179">When you do this, the contents of the mailbox will be encrypted using the assigned DEP as the content is migrated.</span></span> <span data-ttu-id="92e01-180">这比在邮箱迁移后分配 DEP 然后等待加密进行更有效，这可能需要数小时甚至数天。</span><span class="sxs-lookup"><span data-stu-id="92e01-180">This can be more efficient than assigning a DEP after the mailbox has already been migrated and then waiting for encryption to take place, which can take hours or possibly days.</span></span> 
  
## <a name="how-do-i-verify-that-encryption-with-customer-key-is-activated-and-office-365-has-finished-encrypting-with-customer-key"></a><span data-ttu-id="92e01-181">如何验证使用客户密钥加密已激活，Office 365 已完成使用客户密钥加密？</span><span class="sxs-lookup"><span data-stu-id="92e01-181">How do I verify that encryption with Customer Key is activated and Office 365 has finished encrypting with Customer Key?</span></span>
<span data-ttu-id="92e01-182"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-182"></span></span>

 <span data-ttu-id="92e01-183">**交换在线和 Skype 业务：** 您可以使用[远程 PowerShell 连接到 Exchange 在线，](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx)然后对要检查的每个邮箱使用 **[获取邮箱统计信息]** cmdlet。</span><span class="sxs-lookup"><span data-stu-id="92e01-183">**Exchange Online and Skype for Business:** You can [connect to Exchange Online using remote PowerShell](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) and then use the **[Get-MailboxStatistics]** cmdlet for each mailbox that you want to check.</span></span> <span data-ttu-id="92e01-184">在 Get-邮箱统计信息 cmdlet 的输出中，如果邮箱已加密，_则 IsEncrypted_属性返回**的值为 true;** 如果邮箱未加密，则返回**false**值。</span><span class="sxs-lookup"><span data-stu-id="92e01-184">In the output from the Get-MailboxStatistics cmdlet, the  _IsEncrypted_ property returns a value of **true** if the mailbox is encrypted and a value of **false** if it's not.</span></span> <span data-ttu-id="92e01-185">如果邮箱已加密，则 Data_加密策略 ID_属性返回的值是加密邮箱的 DEP 的 GUID。</span><span class="sxs-lookup"><span data-stu-id="92e01-185">If the mailbox is encrypted, the value returned for the  _DataEncryptionPolicyID_ property is the GUID of the DEP with which the mailbox is encrypted.</span></span> <span data-ttu-id="92e01-186">有关运行此 cmdlet 的详细信息，请参阅[获取邮箱统计信息](https://technet.microsoft.com/en-us/library/bb124612%28v=exchg.160%29.aspx)以及使用 PowerShell 与联机交换。</span><span class="sxs-lookup"><span data-stu-id="92e01-186">For more information on running this cmdlet, see [Get-MailboxStatistics](https://technet.microsoft.com/en-us/library/bb124612%28v=exchg.160%29.aspx) and using PowerShell with Exchange Online.</span></span> 
  
<span data-ttu-id="92e01-187">如果邮箱在分配 DEP 后等待 72 小时后未加密，则启动邮箱移动。</span><span class="sxs-lookup"><span data-stu-id="92e01-187">If the mailboxes aren't encrypted after waiting 72 hours from the time you assigned the DEP, initiate a mailbox move.</span></span> <span data-ttu-id="92e01-188">为此，[请使用远程 PowerShell 连接到 Exchange 在线，](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx)然后使用 New-MoveRequest cmdlet 并提供邮箱的别名，如下所示：</span><span class="sxs-lookup"><span data-stu-id="92e01-188">To do this, [connect to Exchange Online using remote PowerShell](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) and then use the New-MoveRequest cmdlet and provide the alias of the mailbox as follows:</span></span> 
  
```
New-MoveRequest <alias>
```

 <span data-ttu-id="92e01-189">**共享点在线和一个驱动器的业务：** 您可以[连接到 SharePoint 在线 PowerShell，](https://technet.microsoft.com/en-us/library/fp161372.aspx)然后使用 **[获取-SPO数据加密策略]** cmdlet 来检查租户的状态。</span><span class="sxs-lookup"><span data-stu-id="92e01-189">**SharePoint Online and OneDrive for Business:** You can [connect to SharePoint Online PowerShell](https://technet.microsoft.com/en-us/library/fp161372.aspx), and then use the **[Get-SPODataEncryptionPolicy]** cmdlet to check the status of your tenant.</span></span> <span data-ttu-id="92e01-190">如果启用了客户密钥加密，并且所有站点中的所有文件都已加密，则 _[State]_ 属性将返回**已注册**的值。</span><span class="sxs-lookup"><span data-stu-id="92e01-190">The \*\* _State_\*\* property returns a value of **registered** if Customer Key encryption is enabled and all files in all sites have been encrypted.</span></span> <span data-ttu-id="92e01-191">如果加密仍在进行中，此 cmdlet 会提供有关站点完成百分比的信息。</span><span class="sxs-lookup"><span data-stu-id="92e01-191">If encryption is still in progress, this cmdlet provides information on what percentage of sites is complete.</span></span> 
  
## <a name="if-i-want-to-switch-to-a-different-set-of-keys-how-long-does-it-take-for-the-new-set-of-keys-to-protect-my-data"></a><span data-ttu-id="92e01-192">如果我想切换到另一组密钥，则新密钥集需要多长时间才能保护数据？</span><span class="sxs-lookup"><span data-stu-id="92e01-192">If I want to switch to a different set of keys, how long does it take for the new set of keys to protect my data?</span></span>
<span data-ttu-id="92e01-193"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-193"></span></span>

 <span data-ttu-id="92e01-194">**交换在线和 Skype 业务：** 根据新的数据加密策略 （DEP），从将新 DEP 分配给邮箱时，最多可能需要 72 小时来保护邮箱。</span><span class="sxs-lookup"><span data-stu-id="92e01-194">**Exchange Online and Skype for Business:** It can take up to 72 hours to protect a mailbox according to a new Data Encryption Policy (DEP) from the time the new DEP is assigned to the mailbox.</span></span> 
  
 <span data-ttu-id="92e01-195">**共享点在线和一个驱动器的业务：** 分配新密钥后，最多可能需要四个小时才能重新加密整个租户。</span><span class="sxs-lookup"><span data-stu-id="92e01-195">**SharePoint Online and OneDrive for Business:** It can take up to four hours to re-encrypt your entire tenant once a new key has been assigned.</span></span> 
  
## <a name="is-my-existing-data-stored-without-encryption-at-any-time-while-it-is-decrypted-or-encrypted-with-customer-key"></a><span data-ttu-id="92e01-196">在使用客户密钥解密或加密时，我现有的数据存储是否随时没有加密？</span><span class="sxs-lookup"><span data-stu-id="92e01-196">Is my existing data stored without encryption at any time while it is decrypted or encrypted with Customer Key?</span></span>
<span data-ttu-id="92e01-197"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-197"></span></span>

<span data-ttu-id="92e01-198">否。</span><span class="sxs-lookup"><span data-stu-id="92e01-198">No.</span></span> <span data-ttu-id="92e01-199">您的数据始终在使用 BitLocker 和 DKM 的 Office 365 服务中静态加密。</span><span class="sxs-lookup"><span data-stu-id="92e01-199">Your data is always encrypted at rest in the Office 365 service with BitLocker and DKM.</span></span> <span data-ttu-id="92e01-200">有关详细信息，请参阅 Office 365 的安全、隐私和合规性信息，以及[Exchange Online 如何保护您的电子邮件机密。](https://support.office.com/article/989BA10C-F73F-4EFB-AD1B-AF3322E5F376)</span><span class="sxs-lookup"><span data-stu-id="92e01-200">For more information, see the "Security, Privacy, and Compliance Information for Office 365", and [How Exchange Online secures your email secrets](https://support.office.com/article/989BA10C-F73F-4EFB-AD1B-AF3322E5F376).</span></span>
  
## <a name="if-i-no-longer-want-to-use-customer-managed-encryption-keys-can-i-switch-to-microsoft-managed-keys"></a><span data-ttu-id="92e01-201">如果我不想再使用客户管理的加密密钥，是否可以切换到 Microsoft 管理的密钥？</span><span class="sxs-lookup"><span data-stu-id="92e01-201">If I no longer want to use customer-managed encryption keys, can I switch to Microsoft-managed keys?</span></span>
<span data-ttu-id="92e01-202"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-202"></span></span>

 <span data-ttu-id="92e01-203">**交换在线和 Skype 业务：** 还没有。</span><span class="sxs-lookup"><span data-stu-id="92e01-203">**Exchange Online and Skype for Business:** Not yet.</span></span> <span data-ttu-id="92e01-204">一旦使用 Microsoft 托管密钥在 Office 365 中的服务加密广泛推出，将支持此功能。</span><span class="sxs-lookup"><span data-stu-id="92e01-204">This will be supported once service encryption in Office 365 with Microsoft-managed keys is rolled out broadly.</span></span> <span data-ttu-id="92e01-205">我们希望在使用客户密钥发布服务加密后在服务中推出此功能。</span><span class="sxs-lookup"><span data-stu-id="92e01-205">We expect to roll this out in the service after we release service encryption with Customer Key.</span></span> 
  
 <span data-ttu-id="92e01-206">**共享点在线和一个驱动器的业务：** 是的。</span><span class="sxs-lookup"><span data-stu-id="92e01-206">**SharePoint Online and OneDrive for Business:** Yes.</span></span> <span data-ttu-id="92e01-207">您可以选择为每个地理位置（如果使用多地理位置功能）单独使用 Microsoft 管理的密钥，或者如果数据位于单个地理位置中，则可以选择恢复使用所有数据。</span><span class="sxs-lookup"><span data-stu-id="92e01-207">You can choose to revert to using Microsoft-managed keys separately for each geo (if you use the multi-geo feature) or for all your data if it is in a single geo.</span></span> 
  
## <a name="if-i-lose-my-keys-how-long-does-it-take-to-recover-service-availability-using-the-recovery-key"></a><span data-ttu-id="92e01-208">如果我丢失了密钥，使用恢复密钥恢复服务可用性需要多长时间？</span><span class="sxs-lookup"><span data-stu-id="92e01-208">If I lose my keys, how long does it take to recover service availability using the recovery key?</span></span>
<span data-ttu-id="92e01-209"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-209"></span></span>

 <span data-ttu-id="92e01-210">**交换在线和 Skype 业务：** 调用以使用可用性密钥后，将在几分钟内访问邮箱。</span><span class="sxs-lookup"><span data-stu-id="92e01-210">**Exchange Online and Skype for Business:** Once you call in to use the availability key, mailboxes will be accessible within minutes.</span></span> 
  
 <span data-ttu-id="92e01-211">**共享点在线和一个驱动器的业务：** 此操作与您拥有的网站数成正比。</span><span class="sxs-lookup"><span data-stu-id="92e01-211">**SharePoint Online and OneDrive for Business:** This operation is proportional to the number of sites you have.</span></span> <span data-ttu-id="92e01-212">一旦您致电 Microsoft 使用可用性密钥，您将在大约四小时内完全联机。</span><span class="sxs-lookup"><span data-stu-id="92e01-212">Once you call Microsoft to use the availability key, you will be fully online within about four hours.</span></span> 
  
## <a name="how-is-the-availability-key-used-with-exchange-online"></a><span data-ttu-id="92e01-213">如何与 Exchange 在线使用可用性密钥？</span><span class="sxs-lookup"><span data-stu-id="92e01-213">How is the availability key used with Exchange Online?</span></span>
<span data-ttu-id="92e01-214"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-214"></span></span>

<span data-ttu-id="92e01-215">可用性密钥与 Exchange 联机一起使用有三种方式：</span><span class="sxs-lookup"><span data-stu-id="92e01-215">There are three ways that the availability key is used with Exchange Online:</span></span>
  
- <span data-ttu-id="92e01-216">服务可用性 - 如果 Azure 密钥保管库密钥无法访问。</span><span class="sxs-lookup"><span data-stu-id="92e01-216">Service availability - in the event that Azure Key Vault keys are unreachable.</span></span>
    
- <span data-ttu-id="92e01-217">由 Office 365 服务代码启动的操作 - 例如搜索索引创建或邮箱移动。</span><span class="sxs-lookup"><span data-stu-id="92e01-217">Actions initiated by Office 365 service code - such as search index creation or mailbox moves.</span></span>
    
- <span data-ttu-id="92e01-218">从密钥丢失中恢复 - 例如与单个 DEP 关联的 Azure 密钥保管库密钥丢失。</span><span class="sxs-lookup"><span data-stu-id="92e01-218">Recover from key loss - such as the loss of both Azure Key Vault keys associated with a single DEP.</span></span>
    
 <span data-ttu-id="92e01-219">**在无法访问 Azure 密钥保管库密钥时，使用可用性密钥来提供服务可用性。**</span><span class="sxs-lookup"><span data-stu-id="92e01-219">**Using the availability key for service availability in the event Azure Key Vault keys are unreachable.**</span></span>
  
<span data-ttu-id="92e01-220">Office 365 使用可用性密钥来提供服务可用性，并从不正常的客户密钥状态恢复 Exchange Online。</span><span class="sxs-lookup"><span data-stu-id="92e01-220">Office 365 uses the availability key both for service availability and recovery from an unhealthy Customer Key state for Exchange Online.</span></span> <span data-ttu-id="92e01-221">客户密钥使用的键层次结构。</span><span class="sxs-lookup"><span data-stu-id="92e01-221">There is a hierarchy of keys used by Customer Key.</span></span> <span data-ttu-id="92e01-222">下图说明了此层次结构。</span><span class="sxs-lookup"><span data-stu-id="92e01-222">This hierarchy is illustrated in the following figure.</span></span>
  
![](media/a760156b-737f-469a-80ab-c28b7a8b9160.png)
  
<span data-ttu-id="92e01-223">如果单个数据加密策略 （DEP） 的两个 Azure 密钥保管库密钥都不可用，Office 365 可以使用可用性密钥更改为新的 DEP。</span><span class="sxs-lookup"><span data-stu-id="92e01-223">If both Azure Key Vault keys of a single Data Encryption Policy (DEP) are unavailable, Office 365 can use the availability key to change to a new DEP.</span></span> <span data-ttu-id="92e01-224">Office 365 根据用户启动的活动（例如，当用户将电子邮件下载到 Outlook 客户端）还是系统启动的活动（如索引），确定是否对服务可用性使用不同情况密钥邮箱内容，或用于电子数据展示搜索，触发了该过程。</span><span class="sxs-lookup"><span data-stu-id="92e01-224">Office 365 determines whether to use the availability key for service availability differently depending on whether a user-initiated activity, for example, when a user downloads email to the Outlook client, or a system-initiated activity, such as indexing mailbox contents, or for eDiscovery searches, triggered the process.</span></span>
  
<span data-ttu-id="92e01-225">Office 365 遵循此过程以响应用户启动的操作，以确定是否对用户邮箱使用可用性密钥：</span><span class="sxs-lookup"><span data-stu-id="92e01-225">Office 365 follows this process in response to user-initiated actions to determine whether to use the availability key for user mailboxes:</span></span>
  
1. <span data-ttu-id="92e01-226">Office 365 读取邮箱分配到的 DEP，以确定 Azure 密钥保管库中的两个客户密钥的位置。</span><span class="sxs-lookup"><span data-stu-id="92e01-226">Office 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two customer keys in Azure Key Vault.</span></span>
    
2. <span data-ttu-id="92e01-227">Office 365 从 DEP 中随机选择两个客户密钥之一，并向 Azure 密钥保管库发送请求，以便使用客户密钥解包 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-227">Office 365 randomly chooses one of the two customer keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the customer key.</span></span>
    
3. <span data-ttu-id="92e01-228">如果使用客户密钥打开 DEP 密钥的请求失败并返回错误，Office 365 会向 Azure 密钥保管库发送第二个请求，这一次指示它使用备用（第二个）客户密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-228">If the request to unwrap the DEP key using the customer key fails and returns an error, Office 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) customer key.</span></span>
    
4. <span data-ttu-id="92e01-229">如果使用客户密钥解包 DEP 密钥的第二个请求失败并返回错误，Office 365 将检查两个请求的结果：</span><span class="sxs-lookup"><span data-stu-id="92e01-229">If the second request to unwrap the DEP key using the customer key fails and returns an error, Office 365 examines the results of both requests:</span></span>
    
  - <span data-ttu-id="92e01-230">如果检查确定错误不反映客户标识的显式操作，则 Office 365 使用可用性密钥解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-230">If the examination determines that the errors DO NOT reflect an explicit action by a customer identity, then Office 365 uses the availability key to decrypt the DEP key.</span></span> <span data-ttu-id="92e01-231">然后，使用 DEP 密钥解密邮箱密钥并完成用户请求。</span><span class="sxs-lookup"><span data-stu-id="92e01-231">The DEP key is then used to decrypt the mailbox key and complete the user request.</span></span>
    
    <span data-ttu-id="92e01-232">在这种情况下，Azure 密钥保管库无法响应，或者由于任何原因无法访问。</span><span class="sxs-lookup"><span data-stu-id="92e01-232">In this case, Azure Key Vault is either unable to respond or unreachable for whatever reason.</span></span> <span data-ttu-id="92e01-233">Office 365 无法确定客户是否有意撤销了对密钥的访问权限。</span><span class="sxs-lookup"><span data-stu-id="92e01-233">Office 365 has no way of determining if the customer has intentionally revoked access to the keys.</span></span>
    
  - <span data-ttu-id="92e01-234">如果检查指示已采取故意操作使客户密钥不可用，则可用性密钥将不会使用，用户请求失败，并且用户收到一条错误消息，如登录失败。</span><span class="sxs-lookup"><span data-stu-id="92e01-234">If the examination indicates that deliberate action has been taken to render the customer keys unavailable, then the availability key will not be used, the user request fails, and the user receives an error message, such as login failure.</span></span>
    
    <span data-ttu-id="92e01-235">发生这种情况时，客户会意识到服务受到影响，并且客户密钥的状况不正常。</span><span class="sxs-lookup"><span data-stu-id="92e01-235">When this happens, the customer is made aware that service is impacted, and the condition of Customer Key is unhealthy.</span></span> <span data-ttu-id="92e01-236">例如，如果客户对组织中的所有邮箱使用单个 DEP，则客户可能会遇到用户无法访问其邮箱的广泛故障。</span><span class="sxs-lookup"><span data-stu-id="92e01-236">For example, if a customer is using a single DEP for all mailboxes in the organization, the customer may experience a widespread failure where users can't access their mailboxes.</span></span> <span data-ttu-id="92e01-237">这可确保当两个客户密钥都不正常时，客户会意识到需要纠正这种情况并将服务恢复到正常状态。</span><span class="sxs-lookup"><span data-stu-id="92e01-237">This ensures that when both customer keys are unhealthy, the customer is made aware of the need to correct the situation and restore the service to a healthy state.</span></span>
    
 <span data-ttu-id="92e01-238">**对 Office 365 服务代码启动的操作使用可用性密钥。**</span><span class="sxs-lookup"><span data-stu-id="92e01-238">**Using the availability key for actions initiated by Office 365 service code.**</span></span>
  
<span data-ttu-id="92e01-239">Office 365 服务代码始终具有有效的登录令牌，无法阻止。</span><span class="sxs-lookup"><span data-stu-id="92e01-239">Office 365 service code always has a valid login token and can't be blocked.</span></span> <span data-ttu-id="92e01-240">因此，在删除可用性密钥之前，它可用于 Office 365 服务代码启动或内部启动的操作，如搜索索引创建或移动邮箱。</span><span class="sxs-lookup"><span data-stu-id="92e01-240">Therefore, until the availability key has been deleted, it can be used for actions initiated by, or internal to, Office 365 service code, such as search index creation or moving mailboxes.</span></span>
  
 <span data-ttu-id="92e01-241">**使用可用性密钥从密钥丢失中恢复。**</span><span class="sxs-lookup"><span data-stu-id="92e01-241">**Using the availability key to recover from key loss.**</span></span>
  
<span data-ttu-id="92e01-242">您可以使用可用性密钥从与同一 DEP 关联的两个 Azure 密钥保管库密钥的丢失中恢复，如常见问题解答条目"如果我的密钥已销毁，我如何恢复？</span><span class="sxs-lookup"><span data-stu-id="92e01-242">You can use the availability key to recover from the loss of both Azure Key Vault keys that are associated with the same DEP, as described in the answer to the FAQ entry "If my keys are destroyed, how can I recover?".</span></span>
  
## <a name="how-is-the-availability-key-used-with-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="92e01-243">如何与 SharePoint 在线和一个业务一个驱动器使用可用性密钥？</span><span class="sxs-lookup"><span data-stu-id="92e01-243">How is the availability key used with SharePoint Online and OneDrive for Business?</span></span>
<span data-ttu-id="92e01-244"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-244"></span></span>

<span data-ttu-id="92e01-245">SharePoint 在线和 OneDrive 业务体系结构和客户密钥和可用性密钥的实施不同于 Exchange 在线和 Skype 业务。</span><span class="sxs-lookup"><span data-stu-id="92e01-245">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="92e01-246">当客户移动到客户管理的密钥时，Office 365 将创建特定于租户的中间密钥 （TIK）。</span><span class="sxs-lookup"><span data-stu-id="92e01-246">When a customer moves to customer-managed keys, Office 365 creates a tenant-specific intermediate key (TIK).</span></span> <span data-ttu-id="92e01-247">Office 365 对 TIK 加密两次，一次使用每个客户密钥加密，并存储两个加密版本的 TIK。</span><span class="sxs-lookup"><span data-stu-id="92e01-247">Office 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="92e01-248">仅存储 TIK 的加密版本，并且只能使用客户密钥解密 TIK。</span><span class="sxs-lookup"><span data-stu-id="92e01-248">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="92e01-249">然后，TIK 用于加密站点密钥，然后用于加密 blob 密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-249">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys.</span></span> <span data-ttu-id="92e01-250">blob 本身已加密并存储在 Microsoft Azure Blob 存储服务中。</span><span class="sxs-lookup"><span data-stu-id="92e01-250">The blobs themselves are encrypted and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="92e01-251">Office 365 遵循此过程来访问具有客户文件数据的 Blob：</span><span class="sxs-lookup"><span data-stu-id="92e01-251">Office 365 follows this process to access a blob that has customer file data:</span></span>
  
1. <span data-ttu-id="92e01-252">使用客户密钥解密 TIK。</span><span class="sxs-lookup"><span data-stu-id="92e01-252">Decrypt the TIK using the Customer Key.</span></span>
    
2. <span data-ttu-id="92e01-253">使用解密的 TIK 解密站点密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-253">Use the decrypted TIK to decrypt a site key.</span></span>
    
3. <span data-ttu-id="92e01-254">使用解密的站点密钥解密 blob 密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-254">Use the decrypted site key to decrypt a blob key.</span></span>
    
4. <span data-ttu-id="92e01-255">使用解密的 blob 密钥解密 Blob。</span><span class="sxs-lookup"><span data-stu-id="92e01-255">Use the decrypted blob key to decrypt the blob.</span></span>
    
<span data-ttu-id="92e01-256">解密 TIK 时，Office 365 会向 Azure 密钥保管库发出两个解密请求，但略有偏移。</span><span class="sxs-lookup"><span data-stu-id="92e01-256">When decrypting a TIK, Office 365 issues two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="92e01-257">第一个完成提供的结果，取消另一个请求。</span><span class="sxs-lookup"><span data-stu-id="92e01-257">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="92e01-258">如果客户无法访问其客户密钥，Office 365 还会使用可用性密钥加密 TIK，并将其与使用每个客户密钥加密的 TIK 一起存储。</span><span class="sxs-lookup"><span data-stu-id="92e01-258">In case the customer loses access to their customer keys, Office 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="92e01-259">仅当客户呼叫 Microsoft 以在恶意或意外无法访问其密钥时，才使用使用使用可用性密钥加密的 TIK。</span><span class="sxs-lookup"><span data-stu-id="92e01-259">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="92e01-260">出于可用性和规模原因，解密的 TIK 缓存在有时间限制的内存缓存中。</span><span class="sxs-lookup"><span data-stu-id="92e01-260">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="92e01-261">在 TIK 缓存设置为过期前两小时，Office 365 尝试解密每个 TIK。</span><span class="sxs-lookup"><span data-stu-id="92e01-261">Two hours before a TIK cache is set to expire, Office 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="92e01-262">解密 TIK 可延长缓存的生存期。</span><span class="sxs-lookup"><span data-stu-id="92e01-262">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="92e01-263">如果 TIK 解密在相当长的时间内失败，Office 365 会生成警报，以便在缓存过期之前通知工程部门。</span><span class="sxs-lookup"><span data-stu-id="92e01-263">If TIK decryption fails for a significant amount of time, Office 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="92e01-264">仅当客户致电 Microsoft 时，Office 365 才会启动恢复操作，这涉及使用存储在 Microsoft 机密存储中的可用性密钥解密 TIK，并使用解密的 TIK 和一组新的客户提供的 Azure 密钥保管库密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-264">Only if the customer calls Microsoft will Office 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="92e01-265">时至今日，客户密钥涉及存储在 Azure Blob 存储中的 SharePoint 联机文件的加密和解密链，但不包括存储在 SQL 数据库中的 SharePoint 联机列表项或元数据。</span><span class="sxs-lookup"><span data-stu-id="92e01-265">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL database.</span></span> <span data-ttu-id="92e01-266">Office 365 不使用 SharePoint Online 或 OneDrive 业务的可用性密钥，而不是上述情况（客户启动）。</span><span class="sxs-lookup"><span data-stu-id="92e01-266">Office 365 does not use the availability key for SharePoint Online or OneDrive for Business other than the case described above, which is customer initiated.</span></span> <span data-ttu-id="92e01-267">人机访问客户数据受客户密码箱保护。</span><span class="sxs-lookup"><span data-stu-id="92e01-267">Human access to customer data is protected by Customer Lockbox.</span></span>
  
## <a name="how-is-customer-key-licensed"></a><span data-ttu-id="92e01-268">如何获得客户密钥的许可？</span><span class="sxs-lookup"><span data-stu-id="92e01-268">How is Customer Key licensed?</span></span>
<span data-ttu-id="92e01-269"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-269"></span></span>

<span data-ttu-id="92e01-270">Office 365 企业套件、"E5"和高级合规性 SKU 中提供了客户密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-270">Customer Key is offered in the Office 365 Enterprise Suite, "E5", and the Advanced Compliance SKU.</span></span> <span data-ttu-id="92e01-271">此外，客户还必须购买用于使用 Azure 密钥保管库的相应许可证。</span><span class="sxs-lookup"><span data-stu-id="92e01-271">Additionally, customers must also purchase the appropriate license for using Azure Key Vault.</span></span>
  
<span data-ttu-id="92e01-272">如果每个从客户密钥中受益的用户想要获得客户密钥的覆盖，则需要获得许可。</span><span class="sxs-lookup"><span data-stu-id="92e01-272">Each user benefiting from Customer Key needs to be licensed if they want to be covered by Customer Key.</span></span>
  
<span data-ttu-id="92e01-273">对于 SharePoint Online，配置客户密钥的 Office 365 管理员也需要获得许可，才能执行设置步骤。</span><span class="sxs-lookup"><span data-stu-id="92e01-273">For SharePoint Online, the Office 365 Administrator who configures Customer Key also needs to be licensed, to perform the setup steps.</span></span> <span data-ttu-id="92e01-274">此外，从该功能中受益的用户需要获得许可 - 这包括网站所有者和访问使用客户密钥加密的一个或多个网站上的文件的任何用户。</span><span class="sxs-lookup"><span data-stu-id="92e01-274">Additionally, the users that are benefiting from the feature need to be licensed - this includes the site owner and any users accessing files on one or more sites that are encrypted using Customer Key.</span></span> <span data-ttu-id="92e01-275">外部用户无需获得许可，就无需访问使用客户密钥加密的一个或多个站点上的文件。</span><span class="sxs-lookup"><span data-stu-id="92e01-275">External users do not need to be licensed to access files on one or more sites that are encrypted using Customer Key.</span></span>
  
<span data-ttu-id="92e01-276">对于联机交换，"用户"邮箱和"邮件用户"邮箱必须获得许可。</span><span class="sxs-lookup"><span data-stu-id="92e01-276">For Exchange Online, "user" mailboxes and "mail user" mailboxes must be licensed.</span></span> <span data-ttu-id="92e01-277">所有其他（如共享邮箱）都不需要拥有客户密钥许可证。</span><span class="sxs-lookup"><span data-stu-id="92e01-277">All others, such as shared mailboxes, are not required to have a license for Customer Key.</span></span> <span data-ttu-id="92e01-278">要检查您的 Exchange 在线邮箱是否获得正确许可，请运行以下 cmdlet：</span><span class="sxs-lookup"><span data-stu-id="92e01-278">To check that your Exchange Online mailbox is properly licensed, run the following cmdlet:</span></span>
  
```
(Get-Mailbox <alias >).PersistedCapabilities
```

<span data-ttu-id="92e01-279">如果字符串 BPOS_S_EquivioAnalytics 存在，则邮箱已正确授权。</span><span class="sxs-lookup"><span data-stu-id="92e01-279">If the string BPOS_S_EquivioAnalytics exists, then the mailbox is properly licensed.</span></span> <span data-ttu-id="92e01-280">如果没有，则必须应用适当的许可证才能使用此邮箱的客户密钥功能。</span><span class="sxs-lookup"><span data-stu-id="92e01-280">If not, you must apply the proper license in order to use the Customer Key feature for this mailbox.</span></span>
  
## <a name="can-i-enable-customer-key-for-a-trial-subscription"></a><span data-ttu-id="92e01-281">我可以为试用订阅启用客户密钥吗？</span><span class="sxs-lookup"><span data-stu-id="92e01-281">Can I enable Customer Key for a trial subscription?</span></span>
<span data-ttu-id="92e01-282"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-282"></span></span>

<span data-ttu-id="92e01-283">否。</span><span class="sxs-lookup"><span data-stu-id="92e01-283">No.</span></span> <span data-ttu-id="92e01-284">根据定义，试用订阅的生存期有限。</span><span class="sxs-lookup"><span data-stu-id="92e01-284">By definition, trial subscriptions have a limited lifetime.</span></span> <span data-ttu-id="92e01-285">在试用订阅中托管的加密密钥可能会在试用生存期结束时丢失。</span><span class="sxs-lookup"><span data-stu-id="92e01-285">Encryption keys that are hosted in trial subscriptions can be lost at the end of the trial lifetime.</span></span> <span data-ttu-id="92e01-286">由于 Microsoft 不能也不妨碍客户将重要的客户数据放入试用订阅中，因此禁止在试用订阅中使用客户密钥。</span><span class="sxs-lookup"><span data-stu-id="92e01-286">Because Microsoft cannot and does not prevent customers from putting important customer data in trial subscriptions, the use of Customer Key with trial subscriptions is prohibited.</span></span>
  
## <a name="how-much-will-using-customer-key-cost"></a><span data-ttu-id="92e01-287">使用客户密钥的成本是多少？</span><span class="sxs-lookup"><span data-stu-id="92e01-287">How much will using Customer Key cost?</span></span>
<span data-ttu-id="92e01-288"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-288"></span></span>

<span data-ttu-id="92e01-289">除了客户密钥所需的许可外，客户还将产生密钥保管库使用成本。</span><span class="sxs-lookup"><span data-stu-id="92e01-289">In addition to the licensing required for Customer Key, customers will incur a cost for Key Vault usage.</span></span> <span data-ttu-id="92e01-290">[Azure 密钥保管库定价详细信息](https://azure.microsoft.com/en-us/pricing/details/key-vault/)描述成本模型，并将有助于估算成本模型。</span><span class="sxs-lookup"><span data-stu-id="92e01-290">[Azure Key Vault pricing details](https://azure.microsoft.com/en-us/pricing/details/key-vault/) describes the cost model and will assist with estimating.</span></span> <span data-ttu-id="92e01-291">由于使用模式不同，无法预测任何客户将产生的确切成本。</span><span class="sxs-lookup"><span data-stu-id="92e01-291">There is no way to predict the exact cost that any customer will incur because usage patterns vary.</span></span> <span data-ttu-id="92e01-292">经验表明，成本非常低，通常属于每个用户每月 0.002 到 0.005 美元的范围，再加上 HSM 支持的密钥的成本。</span><span class="sxs-lookup"><span data-stu-id="92e01-292">Experience has shown that the cost is very low and generally falls within the range of $0.002 to $0.005 per user per month plus the cost of HSM-backed keys.</span></span> <span data-ttu-id="92e01-293">成本还将根据客户选择的日志记录配置和用于 Azure 密钥保管库日志的 Azure 存储量而有所不同。</span><span class="sxs-lookup"><span data-stu-id="92e01-293">The cost will also vary according to the logging configuration chosen by the customer and the amount of Azure storage used for Azure Key Vault logs.</span></span> 
  
## <a name="for-more-information"></a><span data-ttu-id="92e01-294">如需詳細資訊</span><span class="sxs-lookup"><span data-stu-id="92e01-294">For more information</span></span>
<span data-ttu-id="92e01-295"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="92e01-295"></span></span>

<span data-ttu-id="92e01-296">要开始使用客户密钥，请参阅[使用客户密钥在 Office 365 中控制数据。](controlling-your-data-using-customer-key.md)</span><span class="sxs-lookup"><span data-stu-id="92e01-296">To get started with Customer Key, see [Controlling your data in Office 365 using Customer Key](controlling-your-data-using-customer-key.md).</span></span>
  

