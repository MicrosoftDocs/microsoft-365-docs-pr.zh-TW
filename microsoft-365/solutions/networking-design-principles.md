---
title: 將 (網路連接至雲端) —一種架構師的視點
description: 描述。
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
localization_priority: Normal
ms.collection:
- M365-identity-device-management
- M365-security-compliance
ms.custom: ''
f1.keywords: NOCSH
ms.openlocfilehash: a005d56dcca08c05eb433ef75ca3870785b39f19
ms.sourcegitcommit: 555d756c69ac9031d1fb928f2e1f9750beede066
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2020
ms.locfileid: "47308126"
---
# <a name="networking-up-to-the-cloud--one-architects-viewpoint"></a><span data-ttu-id="698ac-103">將 (網路連接至雲端) —一種架構師的視點</span><span class="sxs-lookup"><span data-stu-id="698ac-103">Networking up (to the cloud) — One architect’s viewpoint</span></span>

<span data-ttu-id="698ac-104">在本文中， [Fisher](https://www.linkedin.com/in/edfisher/)的安全性 & 規範架構架構中，說明如何透過避免最常見的陷阱，為雲端連線優化您的網路。</span><span class="sxs-lookup"><span data-stu-id="698ac-104">In this article, [Ed Fisher](https://www.linkedin.com/in/edfisher/), Security & Compliance Architect at Microsoft, describes how to optimize your network for cloud connectivity by avoiding the most common pitfalls.</span></span> 

## <a name="about-the-author"></a><span data-ttu-id="698ac-105">關於作者</span><span class="sxs-lookup"><span data-stu-id="698ac-105">About the author</span></span>

![Ed Fisher 相片](../media/solutions-architecture-center/ed-fisher-networking.jpg) 

<span data-ttu-id="698ac-107">我目前是位於東南亞地區的主要技術專家，著重于安全性 & 合規性。</span><span class="sxs-lookup"><span data-stu-id="698ac-107">I am currently a Principal Technical Specialist in the South East region focusing on Security & Compliance.</span></span> <span data-ttu-id="698ac-108">我已在過去十年裡，與客戶移至 Office 365。</span><span class="sxs-lookup"><span data-stu-id="698ac-108">I have worked with customers moving to Office 365 for the past ten years.</span></span> <span data-ttu-id="698ac-109">我已使用小型店，具有許多地方的政府機構和企業，有成千上萬的使用者在世界各地散佈，許多其他客戶都有成千上萬的使用者、世界各部分的多個位置，需要更高的安全性，以及許多法規遵從性需求。</span><span class="sxs-lookup"><span data-stu-id="698ac-109">I’ve worked with smaller shops with a handful of locations to government agencies and enterprises with millions of users distributed around the world, and many other customers in between, with the majority having tens of thousands of users, multiple locations in various parts of the world, the need for a higher degree of security, and a multitude of compliance requirements.</span></span> <span data-ttu-id="698ac-110">我已經協助數以百計的企業和數百萬的使用者可以安全且安全地移至雲端。</span><span class="sxs-lookup"><span data-stu-id="698ac-110">I have helped hundreds of enterprises and millions of users move to the cloud safely and securely.</span></span>

<span data-ttu-id="698ac-111">透過過去25年的背景，包含安全性、基礎結構及網路工程，並在加入 Microsoft 之前將兩個先前的雇主移至 Office 365，我已在您的表格的一面執行大量時間，並記住類似的專案。</span><span class="sxs-lookup"><span data-stu-id="698ac-111">With a background over the past 25 years that includes security, infrastructure, and network engineering, and having moved two of my previous employers to Office 365 before joining Microsoft, I’ve been on your side of the table plenty of times, and do remember what that’s like.</span></span> <span data-ttu-id="698ac-112">雖然不是兩個客戶完全相同，也有相似的需求，而且在使用標準化服務（例如任何 SaaS 或 PaaS 平臺）時，最佳的做法一般都相同。</span><span class="sxs-lookup"><span data-stu-id="698ac-112">While no two customers are ever the same, most have similar needs, and when consuming a standardized service such as any SaaS or PaaS platform, the best approaches tend to be the same.</span></span>



## <a name="its-not-the-network--its-how-youre-misusing-it"></a><span data-ttu-id="698ac-113">這不是網路，就是您使用 (mis) 時，如何使用！</span><span class="sxs-lookup"><span data-stu-id="698ac-113">It’s not the network — it’s how you’re (mis)using it!</span></span>

<span data-ttu-id="698ac-114">不論發生多少次，它永遠無法 amaze 我的 *創意* 安全性小組和網路小組如何嘗試如何連接至 Microsoft 雲端服務。</span><span class="sxs-lookup"><span data-stu-id="698ac-114">No matter how many times it happens, it never fails to amaze me how *creative* security teams and networking teams try to get with how they think they should connect to Microsoft cloud services.</span></span> <span data-ttu-id="698ac-115">永遠都堅持使用一些安全性原則、符合性標準或更好的方式，而不願意參與與其嘗試完成的談話，或是更好、更輕鬆、更具成本效益及更具效能*的方式。*</span><span class="sxs-lookup"><span data-stu-id="698ac-115">There’s always some security policy, compliance standard, or better way they insist on using, without being willing to engage in a conversation about what it is they are trying to accomplish, or *how* they are better, easier, more cost-effective, and more performant ways of doing so.</span></span> 

<span data-ttu-id="698ac-116">當這類內容上報給我時，我一般會願意採取挑戰，並透過 hows 及 whys，將其移至所需的位置。</span><span class="sxs-lookup"><span data-stu-id="698ac-116">When this sort of thing is escalated to me, I’m usually willing to take the challenge and walk them through the hows and the whys and get them to where they need to be.</span></span> <span data-ttu-id="698ac-117">不過，如果我已完全告別，我必須分享，有時我只想讓他們執行他們的動作，然後再回告訴您，當他們最後 concede 時，就不會這麼做。</span><span class="sxs-lookup"><span data-stu-id="698ac-117">But if I am being completely frank, I have to share that sometimes I want to just let them do what they will, and come back to say I told you so when they finally concede it doesn’t work.</span></span> <span data-ttu-id="698ac-118">我可能會想這麼做，但 *不*這麼做。</span><span class="sxs-lookup"><span data-stu-id="698ac-118">I may want to do that sometimes, but I *don’t*.</span></span> <span data-ttu-id="698ac-119">我所做的就是嘗試說明我即將在此文章中包含的所有專案。</span><span class="sxs-lookup"><span data-stu-id="698ac-119">What I do is try to explain all of what I am going to include in this post.</span></span> <span data-ttu-id="698ac-120">不論您的角色為何，如果您的組織想要使用 Microsoft 雲端服務，可能會有一些可協助您找出的智慧。</span><span class="sxs-lookup"><span data-stu-id="698ac-120">Regardless of your role, if your organization wants to use Microsoft cloud services, there’s probably some wisdom in what follows that can help you out.</span></span>


## <a name="guiding-principles"></a><span data-ttu-id="698ac-121">指導原則</span><span class="sxs-lookup"><span data-stu-id="698ac-121">Guiding principles</span></span>
<span data-ttu-id="698ac-122">讓我們從周圍的部分基本規則開始。</span><span class="sxs-lookup"><span data-stu-id="698ac-122">Let’s start with some ground rules around what we’re doing here.</span></span> <span data-ttu-id="698ac-123">我們正在討論如何安全地連線至雲端服務，以確保最低的複雜性和最大的效能，同時維持實際的安全性。</span><span class="sxs-lookup"><span data-stu-id="698ac-123">We are discussing how to securely connect to cloud services to ensure the minimum complexity, and the maximum performance, while maintaining real security.</span></span> <span data-ttu-id="698ac-124">無論您或您的客戶，都不會將其計數器的計數器計數器的任何計數器，都將無法使用您最喜歡的 proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="698ac-124">None of what follows is counter to any of that, even if you, or your customer, won’t get to use your favorite proxy server for everything.</span></span>

- <span data-ttu-id="698ac-125">**這是因為您可以做的，並非表示您應該** （或從 Jurassic 駐留影片） paraphrase Dr.. Ian Malcolm。</span><span class="sxs-lookup"><span data-stu-id="698ac-125">**Just because you can, doesn’t mean you should** — Or to paraphrase Dr. Ian Malcolm from the Jurassic Park movie “.</span></span> <span data-ttu-id="698ac-126">.</span><span class="sxs-lookup"><span data-stu-id="698ac-126">.</span></span> <span data-ttu-id="698ac-127">.</span><span class="sxs-lookup"><span data-stu-id="698ac-127">.</span></span> <span data-ttu-id="698ac-128">是的，是的，但是您的安全性小組非常 preoccupied，但他們是否可以讓他們不會停止思考是否應該。</span><span class="sxs-lookup"><span data-stu-id="698ac-128">Yeah, yeah, but your security team was so preoccupied with whether or not they could that they didn't stop to think if they should.”</span></span>    
- <span data-ttu-id="698ac-129">**安全性不意味著複雜性** ，您只是因為您花更多資金、路由傳送更多裝置，或按一下 [更多按鈕] 而不是更安全。</span><span class="sxs-lookup"><span data-stu-id="698ac-129">**Security does not mean complexity** — You are not more secure just because you spend more money, route through more devices, or click more buttons.</span></span>
- <span data-ttu-id="698ac-130">**Office 365 是透過網際網路存取** ，但這與 office 365 是網際網路的功能不同。</span><span class="sxs-lookup"><span data-stu-id="698ac-130">**Office 365 is accessed over the Internet** — But that’s not the same thing as Office 365 is the Internet.</span></span> <span data-ttu-id="698ac-131">這是由 Microsoft 所管理並由您管理的 SaaS 服務。</span><span class="sxs-lookup"><span data-stu-id="698ac-131">It’s a SaaS service managed by Microsoft and administered by you.</span></span> <span data-ttu-id="698ac-132">與您在網際網路上流覽的網站不同的是，您實際上可以查看 curtain，而且可以套用您所需的控制項以滿足您的原則和相容性標準，只要您瞭解在您可以符合您的目標時，您可能只需要以不同的方式來執行。</span><span class="sxs-lookup"><span data-stu-id="698ac-132">Unlike websites you visit on the Internet, you actually do get to peek behind the curtain, and can apply the controls you need to meet your policies and your compliance standards, as long as you understand that while you can meet your objectives, you may just have to do them in a different way.</span></span>
- <span data-ttu-id="698ac-133">**Chokepoints 已損壞，已當地語系化的 breakouts 很不錯** ：每個人都永遠都想要 backhaul 所有使用者對某些中心點的所有網際網路流量，但通常是因為其可在其所有位置中布建網際網路存取，或其方式完全不足。</span><span class="sxs-lookup"><span data-stu-id="698ac-133">**Chokepoints are bad, localized breakouts are good** — Everybody always wants to backhaul all their Internet traffic for all their users to some central point, usually so they can monitor it and enforce policy, but often because it’s either cheaper than provisioning Internet access in all their locations, or it’s just how they do it.</span></span> <span data-ttu-id="698ac-134">但這些 chokepoints 都是正確的 .。。流量淺的點。</span><span class="sxs-lookup"><span data-stu-id="698ac-134">But those chokepoints are exactly that…points where traffic chokes.</span></span> <span data-ttu-id="698ac-135">無法防止使用者流覽 Instagram 或流式顯示的 cat 影片，但不會以相同的方式處理重要的商務應用程式流量。</span><span class="sxs-lookup"><span data-stu-id="698ac-135">There’s nothing wrong with preventing your users from browsing to Instagram or streaming cat videos, but don’t treat your mission-critical business application traffic the same way.</span></span>
- <span data-ttu-id="698ac-136">[！注意]**如果 dns ain't 快樂，ain't 毫無**效果-最佳設計網路可透過不良的 dns 加以 hamstrung，不論是對世界其他區域的伺服器提出 recursing 的要求，或是使用 ISP 的 dns 伺服器或其他快取 dns 解析資訊的公用 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="698ac-136">**If DNS ain’t happy, ain’t nothing happy** — The best designed network can be hamstrung by poor DNS, whether that is by recursing requests to servers in other areas of the world or using your ISP’s DNS servers or other public DNS servers that cache DNS resolution information.</span></span> 
- <span data-ttu-id="698ac-137">這**是因為這是您如何使用的方式，不表示這是您現在應該採取的方式**：不斷的技術變更，Office 365 並無例外。</span><span class="sxs-lookup"><span data-stu-id="698ac-137">**Just because that’s how you used to do it, doesn’t mean that’s how you should do it now** — Technology changes constantly and Office 365 is no exception.</span></span> <span data-ttu-id="698ac-138">套用內部部署服務開發及部署的安全性措施，或控制隨意瀏覽不會提供相同等級的安全性保證，而且可能會對效能造成嚴重的負面影響。</span><span class="sxs-lookup"><span data-stu-id="698ac-138">Applying security measures that were developed and deployed for on-premises services or to control web surfing aren’t going to provide the same level of security assurance, and can have a significant negative impact on performance.</span></span>
- <span data-ttu-id="698ac-139">**Office 365 是為透過網際網路存取而建立** 的-這是一種簡而言之。</span><span class="sxs-lookup"><span data-stu-id="698ac-139">**Office 365 was built to be accessed over the Internet** — That’s it in a nutshell.</span></span> <span data-ttu-id="698ac-140">無論您想要在您的使用者和 edge 之間進行什麼動作，當該流量離開您的網路之後及進入我們之前，該流量仍會透過網際網路傳送。</span><span class="sxs-lookup"><span data-stu-id="698ac-140">No matter what you want to do between your users and your edge, the traffic still goes over the Internet once it leaves your network and before it gets onto ours.</span></span> <span data-ttu-id="698ac-141">即使您是使用 Azure ExpressRoute 直接將網路的某些延遲機密流量路由傳送給我們，您絕對需要有網際網路連線能力。</span><span class="sxs-lookup"><span data-stu-id="698ac-141">Even if you are using Azure ExpressRoute to route some latency sensitive traffic from your network directly to ours, Internet connectivity is absolutely required.</span></span> <span data-ttu-id="698ac-142">接受。</span><span class="sxs-lookup"><span data-stu-id="698ac-142">Accept it.</span></span> <span data-ttu-id="698ac-143">請勿 overthink。</span><span class="sxs-lookup"><span data-stu-id="698ac-143">Don’t overthink it.</span></span>

## <a name="where-bad-choices-are-often-made"></a><span data-ttu-id="698ac-144">經常進行不良選擇的地方</span><span class="sxs-lookup"><span data-stu-id="698ac-144">Where bad choices are often made</span></span>

<span data-ttu-id="698ac-145">當安全性名稱中有很多地方會發生不良決策時，這些是我經常遇到的客戶。</span><span class="sxs-lookup"><span data-stu-id="698ac-145">While there are plenty of places where bad decisions are made in the name of security, these are the ones I encounter most often with customers.</span></span> <span data-ttu-id="698ac-146">許多客戶交談都包含所有這些討論。</span><span class="sxs-lookup"><span data-stu-id="698ac-146">Many customer conversations involve all of these at once.</span></span>

### <a name="insufficient-resources-at-the-edge"></a><span data-ttu-id="698ac-147">Edge 沒有足夠的資源</span><span class="sxs-lookup"><span data-stu-id="698ac-147">Insufficient resources at the edge</span></span>
<span data-ttu-id="698ac-148">許多客戶都在部署嶄新環境，而且他們的使用者可以運作的使用者以及網際網路出口的方式，都有多年的經驗。</span><span class="sxs-lookup"><span data-stu-id="698ac-148">Very few customers are deploying greenfield environments, and they have years of experience with how their users work and what their Internet egress is like.</span></span> <span data-ttu-id="698ac-149">客戶是否有 proxy 伺服器或允許直接存取，以及是否只是 NAT 輸出流量，在幾年內就是這麼做，而且不會考慮在將傳統的內部應用程式移至雲端時，要開始逐步傳送的程度。</span><span class="sxs-lookup"><span data-stu-id="698ac-149">Whether customers have proxy servers or allow direct access and simply NAT outbound traffic, they’ve been doing it for years and don’t consider just how much more they are going to start pumping through their edge as they move traditionally internal applications out to the cloud.</span></span>

<span data-ttu-id="698ac-150">頻寬一定很重要，但 NAT 裝置可能無法處理增加的負載，而且可能會啟動較早關閉的連線來釋放資源。</span><span class="sxs-lookup"><span data-stu-id="698ac-150">Bandwidth is always a concern, but NAT devices may not have enough horsepower to handle the increased load and may start prematurely closing connections to free up resources.</span></span> <span data-ttu-id="698ac-151">大多數連接至 Office 365 的用戶端軟體都需要持續連線，而使用者完全使用 Office 365 時，可能會有32或多個同時連線。</span><span class="sxs-lookup"><span data-stu-id="698ac-151">Most of the client software that connects to Office 365 expects persistent connections and a user fully utilizing Office 365 may have 32 or more concurrent connections.</span></span> <span data-ttu-id="698ac-152">如果 NAT 裝置將其提前除去，這些應用程式可能會在嘗試使用不再存在的連接時，變成無回應。</span><span class="sxs-lookup"><span data-stu-id="698ac-152">If the NAT device is dropping them prematurely, those apps may become unresponsive as they try to use the connections that are no longer there.</span></span> <span data-ttu-id="698ac-153">當他們放棄並嘗試建立新的連線時，其網路設備上的負載會進一步增加。</span><span class="sxs-lookup"><span data-stu-id="698ac-153">When they give up and try to establish new connections, they put even more load on your network gear.</span></span>

### <a name="localized-breakout"></a><span data-ttu-id="698ac-154">當地語系化的專題討論</span><span class="sxs-lookup"><span data-stu-id="698ac-154">Localized breakout</span></span>
<span data-ttu-id="698ac-155">在此清單中的其他專案會立即向外移動一件事。</span><span class="sxs-lookup"><span data-stu-id="698ac-155">Everything else in this list comes down to one thing —  getting off your network and onto ours as quickly as possible.</span></span> <span data-ttu-id="698ac-156">將您的使用者流量 Backhauling 至中央出局點，尤其是當該出局點位於您的使用者所在的其他地區時，會帶來不必要的延遲，同時會影響用戶端經驗和下載速度。</span><span class="sxs-lookup"><span data-stu-id="698ac-156">Backhauling your users’ traffic to a central egress point, especially when that egress point is in another region than your users are in, introduces unnecessary latency and impacts both the client experience and download speeds.</span></span> <span data-ttu-id="698ac-157">Microsoft 在世界各地都有一個目前狀態，所有服務和對等都是以幾乎每個主要的 ISP 所建立的所有服務和對等狀態，所以將使用者的流量路由傳送至 *本機* ，可確保在最小延遲的情況下，快速進入網路</span><span class="sxs-lookup"><span data-stu-id="698ac-157">Microsoft has points of presence throughout the world with front ends for all our services and peering established with practically every major ISP, so routing your users’ traffic out *locally* ensures it gets into our network quickly with minimum latency.</span></span> 

### <a name="dns-resolution-traffic-should-follow-the-internet-egress-path"></a><span data-ttu-id="698ac-158">DNS 解析流量應該遵循網際網路出局路徑</span><span class="sxs-lookup"><span data-stu-id="698ac-158">DNS resolution traffic should follow the Internet egress path</span></span>
<span data-ttu-id="698ac-159">當然，用戶端若要尋找任何端點，則必須使用 DNS。</span><span class="sxs-lookup"><span data-stu-id="698ac-159">Of course, for a client to find any endpoint, it needs to use DNS.</span></span> <span data-ttu-id="698ac-160">Microsoft 的 DNS 伺服器評估 DNS 要求的來源，以確保我們傳回與要求來源最接近的回應（以網際網路字詞為單位）。</span><span class="sxs-lookup"><span data-stu-id="698ac-160">Microsoft’s DNS servers evaluate the source of DNS requests to ensure we return the response that is, in Internet terms, closest to the source of the request.</span></span> <span data-ttu-id="698ac-161">確定您的 DNS 已設定，因此名稱解析要求會與使用者的流量完全相同的路徑，lest 您將其授與其他地區的端點。</span><span class="sxs-lookup"><span data-stu-id="698ac-161">Make sure your DNS is configured so that name resolution requests go out the same path as your users’ traffic, lest you give them local egress but to an endpoint in another region.</span></span> <span data-ttu-id="698ac-162">這表示讓本機 DNS 伺服器「移至 root」，而不是轉寄至遠端資料中心的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="698ac-162">That means letting local DNS servers “go to root” rather than forwarding to DNS servers in remote data centers.</span></span> <span data-ttu-id="698ac-163">並留意公開及私人 DNS 服務，其可能會從世界上一個部分快取結果，並提供給他們，來自世界其他部分的要求。</span><span class="sxs-lookup"><span data-stu-id="698ac-163">And watch out for public and private DNS services, which may cache results from one part of the world and serve them to requests from other parts of the world.</span></span>

### <a name="to-proxy-or-not-to-proxy-that-is-the-question"></a><span data-ttu-id="698ac-164">若為 proxy 或非 proxy，即表示問題</span><span class="sxs-lookup"><span data-stu-id="698ac-164">To proxy or not to proxy, that is the question</span></span>
<span data-ttu-id="698ac-165">考慮的第一個考慮因素是是否要 proxy 使用者的連線到 Office 365。</span><span class="sxs-lookup"><span data-stu-id="698ac-165">One of the first things to consider is whether to proxy users’ connections to Office 365.</span></span> <span data-ttu-id="698ac-166">這一點很簡單;不 proxy。</span><span class="sxs-lookup"><span data-stu-id="698ac-166">That one’s easy; do not proxy.</span></span> <span data-ttu-id="698ac-167">Office 365 是透過網際網路存取，但不是網際網路。</span><span class="sxs-lookup"><span data-stu-id="698ac-167">Office 365 is accessed over the Internet, but it is not THE Internet.</span></span> <span data-ttu-id="698ac-168">它是核心服務的擴充，應視為這樣。</span><span class="sxs-lookup"><span data-stu-id="698ac-168">It’s an extension of your core services and should be treated as such.</span></span> <span data-ttu-id="698ac-169">您可以在服務中使用 proxy 執行的任何動作（如 DLP 或反惡意程式碼或內容檢查），而且可以在規模上使用，而不需要破譯 TLS 加密的連線。</span><span class="sxs-lookup"><span data-stu-id="698ac-169">Anything you might want a proxy to do, such as DLP or antimalware or content inspection, is already available to you in the service, and can be used at scale and without needing to crack TLS-encrypted connections.</span></span> <span data-ttu-id="698ac-170">不過，如果您真的想要以其他方式控制的流量 proxy，請注意我們的指導方針 [https://aka.ms/pnc](https://aka.ms/pnc) 和流量類別 [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) 。</span><span class="sxs-lookup"><span data-stu-id="698ac-170">But if you really want to proxy traffic that you cannot otherwise control, pay attention to our guidance at [https://aka.ms/pnc](https://aka.ms/pnc) and the categories of traffic at [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs).</span></span> <span data-ttu-id="698ac-171">我們有三種類型的流量用於 Office 365。</span><span class="sxs-lookup"><span data-stu-id="698ac-171">We have three categories of traffic for Office 365.</span></span> <span data-ttu-id="698ac-172">優化和允許真的應該是直接的，並略過您的 proxy。</span><span class="sxs-lookup"><span data-stu-id="698ac-172">Optimize and Allow really should go direct and bypass your proxy.</span></span> <span data-ttu-id="698ac-173">預設值可為 proxy。</span><span class="sxs-lookup"><span data-stu-id="698ac-173">Default can be proxied.</span></span> <span data-ttu-id="698ac-174">這些檔中的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="698ac-174">The details are in those docs .</span></span> <span data-ttu-id="698ac-175">.</span><span class="sxs-lookup"><span data-stu-id="698ac-175">.</span></span> <span data-ttu-id="698ac-176">.</span><span class="sxs-lookup"><span data-stu-id="698ac-176">.</span></span> <span data-ttu-id="698ac-177">閱讀。</span><span class="sxs-lookup"><span data-stu-id="698ac-177">read them.</span></span>

<span data-ttu-id="698ac-178">使用 proxy 的大多數客戶在實際查看其執行內容時，請先意識到當用戶端對 proxy 進行 HTTP 連線要求時，proxy 現在只會有昂貴的額外路由器。</span><span class="sxs-lookup"><span data-stu-id="698ac-178">Most customers who insist on using a proxy, when they actually look at what they are doing, come to realize that when the client makes an HTTP CONNECT request to the proxy, the proxy is now just an expensive extra router.</span></span> <span data-ttu-id="698ac-179">在使用中的通訊協定（例如 MAPI 和 RTC）甚至不是網頁 proxy 所知道的通訊協定，所以即使 TLS 破譯，也不會真正取得任何額外的安全性。</span><span class="sxs-lookup"><span data-stu-id="698ac-179">The protocols in use such as MAPI and RTC are not even protocols that web proxies understand, so even with TLS cracking you’re not really getting any extra security.</span></span> <span data-ttu-id="698ac-180">您取得額外 *的* 延遲。</span><span class="sxs-lookup"><span data-stu-id="698ac-180">You *are* getting extra latency.</span></span> <span data-ttu-id="698ac-181">[https://aka.ms/pnc](https://aka.ms/pnc)如需詳細資訊，請參閱，包括 Microsoft 365 流量的優化、允許和預設類別。</span><span class="sxs-lookup"><span data-stu-id="698ac-181">See [https://aka.ms/pnc](https://aka.ms/pnc) for more on this, including the Optimize, Allow, and Default categories for Microsoft 365 traffic.</span></span>

<span data-ttu-id="698ac-182">最後，請考慮 proxy 的整體影響及其對應的回應，以應對這種影響。</span><span class="sxs-lookup"><span data-stu-id="698ac-182">Finally, consider the overall impact to the proxy and its corresponding response to deal with that impact.</span></span> <span data-ttu-id="698ac-183">隨著透過 proxy 進行越來越多的連線，它可能會降低 TCP 規模因素，使其不需要大量增加流量的緩衝。</span><span class="sxs-lookup"><span data-stu-id="698ac-183">As more and more connections are being made through the proxy, it may decrease the TCP Scale Factor so that it doesn’t have to buffer so much traffic.</span></span> <span data-ttu-id="698ac-184">我已看到客戶的客戶，其 proxy 因其使用的比例因數為0而超載。</span><span class="sxs-lookup"><span data-stu-id="698ac-184">I’ve seen customers where their proxies were so overloaded that they were using a Scale Factor of 0.</span></span> <span data-ttu-id="698ac-185">因為縮放比例是指數值，我們喜歡使用8，所以每個比例因數值的減少都會對輸送量造成極大的負面影響。</span><span class="sxs-lookup"><span data-stu-id="698ac-185">Since Scale Factor is an exponential value and we like to use 8, each reduction in the Scale Factor value is a huge negative impact to throughput.</span></span>

<span data-ttu-id="698ac-186">TLS 檢查是指安全性！</span><span class="sxs-lookup"><span data-stu-id="698ac-186">TLS Inspection means SECURITY!</span></span> <span data-ttu-id="698ac-187">但不是真的！</span><span class="sxs-lookup"><span data-stu-id="698ac-187">But not really!</span></span> <span data-ttu-id="698ac-188">許多具有 proxy 的客戶都想使用它們來檢查所有流量，這表示 TLS "中斷並檢查"。</span><span class="sxs-lookup"><span data-stu-id="698ac-188">Many customers with proxies want to use them to inspect all traffic, and that means TLS “break and inspect.”</span></span> <span data-ttu-id="698ac-189">當您針對透過 HTTPS 存取的網站執行此作業時 (隱私權考慮，但) proxy 可能必須針對10個或20個以上的資料流程進行10個或20個以上的併發資料流程。</span><span class="sxs-lookup"><span data-stu-id="698ac-189">When you do that for a website accessed over HTTPS (privacy concerns notwithstanding) your proxy may have to do that for ten or even twenty concurrent streams for a few hundred milliseconds.</span></span> <span data-ttu-id="698ac-190">如果有較大的下載或可能的影片，其中一或多個連線可能會更長一些，但是在整體上，大多數的連線會很快地建立、傳送和關閉。</span><span class="sxs-lookup"><span data-stu-id="698ac-190">If there’s a large download or maybe a video involved, one or more of those connections may last much longer, but on the whole, most of those connections establish, transfer, and close very quickly.</span></span> <span data-ttu-id="698ac-191">「中斷」和「檢查」表示 proxy 必須加倍工作。</span><span class="sxs-lookup"><span data-stu-id="698ac-191">Doing break and inspect means the proxy must do double the work.</span></span> <span data-ttu-id="698ac-192">對於從用戶端到 proxy 的每個連線，proxy 還必須對端點進行個別的連線。</span><span class="sxs-lookup"><span data-stu-id="698ac-192">For each connection from the client to the proxy, the proxy must also make a separate connection back to the endpoint.</span></span> <span data-ttu-id="698ac-193">因此，一個會變成二、兩個變成四，32會變成64。</span><span class="sxs-lookup"><span data-stu-id="698ac-193">So, one becomes two, two becomes four, thirty-two becomes sixty-four .</span></span> <span data-ttu-id="698ac-194">.</span><span class="sxs-lookup"><span data-stu-id="698ac-194">.</span></span> <span data-ttu-id="698ac-195">.</span><span class="sxs-lookup"><span data-stu-id="698ac-195">.</span></span> <span data-ttu-id="698ac-196">查看我要前往何處？</span><span class="sxs-lookup"><span data-stu-id="698ac-196">see where I am going?</span></span> <span data-ttu-id="698ac-197">您很可能會為一般網頁衝浪調整 proxy 方案的大小，但是當您嘗試對 Office 365 的用戶端連線執行相同的作業時，並行連線的數量可能會比您所調整的數量還要大。</span><span class="sxs-lookup"><span data-stu-id="698ac-197">You probably sized your proxy solution just fine for typical web surfing, but when you try to do the same thing for client connections to Office 365, the number of concurrent, long-lived connections may be orders of magnitude greater than what you sized for.</span></span>

### <a name="streaming-isnt-important-except-that-it-is"></a><span data-ttu-id="698ac-198">流式處理並不重要，只 *是*</span><span class="sxs-lookup"><span data-stu-id="698ac-198">Streaming isn’t important, except that it *is*</span></span>
<span data-ttu-id="698ac-199">使用 UDP 的 Office 365 中唯一的服務是 Skype (即將淘汰) 和 Microsoft 團隊。</span><span class="sxs-lookup"><span data-stu-id="698ac-199">The only services in Office 365 that use UDP are Skype (soon to be retired) and Microsoft Teams.</span></span> <span data-ttu-id="698ac-200">小組對資料流程流量（包括音訊、影片及簡報共用）使用 UDP。</span><span class="sxs-lookup"><span data-stu-id="698ac-200">Teams uses UDP for streaming traffic including audio, video, and presentation sharing.</span></span> <span data-ttu-id="698ac-201">流式流量是即時的，例如當您使用語音、影片和展示卡片或演示程式進行線上會議時。</span><span class="sxs-lookup"><span data-stu-id="698ac-201">Streaming traffic is live, such as when you are having an online meeting with voice, video, and presenting decks or performing demos.</span></span> <span data-ttu-id="698ac-202">這類使用 UDP 是因為如果丟棄或無序接收封包，它實際上是由使用者 unnoticeable，而且資料流程可以繼續進行。</span><span class="sxs-lookup"><span data-stu-id="698ac-202">These use UDP because if packets are dropped, or arrive out of order, it’s practically unnoticeable by the user and the stream can just keep going.</span></span> 

<span data-ttu-id="698ac-203">當您不允許來自用戶端的輸出 UDP 流量給服務時，他們可以回退使用 TCP。</span><span class="sxs-lookup"><span data-stu-id="698ac-203">When you don’t permit outbound UDP traffic from clients to the service, they can fall back to using TCP.</span></span> <span data-ttu-id="698ac-204">不過，如果丟棄 TCP 封包， *所有專案都會停止* ，直到重新傳輸超時 (RTO) 到期，而且遺失的封包可以重新傳輸。</span><span class="sxs-lookup"><span data-stu-id="698ac-204">But if a TCP packet is dropped, *everything stops* until the Retransmission Timeout (RTO) expires and the missing packet can be retransmitted.</span></span> <span data-ttu-id="698ac-205">如果封包到達順序不正常，所有的封包都會停止，直到其他的封包到達，而且可依順序重新組合。</span><span class="sxs-lookup"><span data-stu-id="698ac-205">If a packet arrives out of order, everything stops until the other packets arrive and can be reassembled in order.</span></span> <span data-ttu-id="698ac-206">這兩種情況都會導致音訊 () 和影片的最大餘地？和影片 (您按一下 someth。</span><span class="sxs-lookup"><span data-stu-id="698ac-206">Both lead to perceptible glitches in the audio (remember Max Headroom?) and video (did you click someth .</span></span> <span data-ttu-id="698ac-207">.</span><span class="sxs-lookup"><span data-stu-id="698ac-207">.</span></span> <span data-ttu-id="698ac-208">.</span><span class="sxs-lookup"><span data-stu-id="698ac-208">.</span></span> <span data-ttu-id="698ac-209">哦，它已) ，會導致效能不良及不良的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="698ac-209">oh, there it is) and lead to poor performance and a bad user experience.</span></span> <span data-ttu-id="698ac-210">請記得我在 proxy 上放置的內容？</span><span class="sxs-lookup"><span data-stu-id="698ac-210">And remember what I put up above about proxies?</span></span> <span data-ttu-id="698ac-211">當您強制團隊用戶端使用 proxy 時，強制其使用 TCP。</span><span class="sxs-lookup"><span data-stu-id="698ac-211">When you force a Teams client to use a proxy, you force it to use TCP.</span></span> <span data-ttu-id="698ac-212">現在，您會造成負面效能影響兩次。</span><span class="sxs-lookup"><span data-stu-id="698ac-212">So now you’re causing negative performance impacts twice.</span></span>

### <a name="split-tunneling-may-seem-scary"></a><span data-ttu-id="698ac-213">分割的隧道可能似乎有點可怕</span><span class="sxs-lookup"><span data-stu-id="698ac-213">Split tunneling may seem scary</span></span>
<span data-ttu-id="698ac-214">但不是。</span><span class="sxs-lookup"><span data-stu-id="698ac-214">But it isn’t.</span></span> <span data-ttu-id="698ac-215">所有與 Office 365 的連線都是透過 TLS。</span><span class="sxs-lookup"><span data-stu-id="698ac-215">All connections to Office 365 are over TLS.</span></span> <span data-ttu-id="698ac-216">我們現在已經為您提供了 TLS 1.2，而且即將停用舊版用戶端，因為舊版用戶端仍會使用它們，而且這是一種風險。</span><span class="sxs-lookup"><span data-stu-id="698ac-216">We have been offering TLS 1.2 for quite a while now and will be disabling older versions soon because legacy clients still use them and that’s a risk.</span></span>

<span data-ttu-id="698ac-217">強制執行 TLS 連線（或32）以先透過 VPN 傳送，然後再移至服務，不會增加安全性。</span><span class="sxs-lookup"><span data-stu-id="698ac-217">Forcing a TLS connection, or thirty-two of them, to go over a VPN before they then go to the service does not add security.</span></span> <span data-ttu-id="698ac-218">它會增加延遲，並減少整體輸送量。</span><span class="sxs-lookup"><span data-stu-id="698ac-218">It does add latency and reduces overall throughput.</span></span> <span data-ttu-id="698ac-219">在某些 VPN 解決方案中，它甚至會強行透過 TCP 進行 UDP 的隧道，進而對資料流程流量產生非常負面的影響。</span><span class="sxs-lookup"><span data-stu-id="698ac-219">In some VPN solutions, it even forces UDP to tunnel through TCP which again will have a very negative impact on streaming traffic.</span></span> <span data-ttu-id="698ac-220">而且，除非您執行 TLS 檢查，否則沒有任何不利的不利因素。</span><span class="sxs-lookup"><span data-stu-id="698ac-220">And, unless you are doing TLS inspection, there is no upside, all downside.</span></span> <span data-ttu-id="698ac-221">目前客戶的共同主題是大多數的工作力是 remote，因為他們會看到大量的頻寬和效能影響，讓所有使用者都能使用 VPN 來進行連線，而不是設定分割隧道以供 access [優化類別 Office 365 端點](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles#new-office-365-endpoint-categories)。</span><span class="sxs-lookup"><span data-stu-id="698ac-221">A very common theme among customers at present, now that most of their workforce is remote, is that they are seeing significant bandwidth and performance impacts from making all their users connect using a VPN, instead of configuring split tunneling for access to [Optimize category Office 365 endpoints](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles#new-office-365-endpoint-categories).</span></span>

<span data-ttu-id="698ac-222">這是一種簡單的修復方式，可讓您進行分割，也就是您應該執行的工作。</span><span class="sxs-lookup"><span data-stu-id="698ac-222">It’s an easy fix to do split tunneling and it’s one you should do.</span></span> <span data-ttu-id="698ac-223">如需詳細資訊，請確定您已透過 [VPN 分割隧道，針對遠端使用者，查看 [優化 Office 365 的連線能力](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel)]。</span><span class="sxs-lookup"><span data-stu-id="698ac-223">For more, make sure you review [Optimize Office 365 connectivity for remote users using VPN split tunneling](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel).</span></span>


## <a name="the-sins-of-the-past"></a><span data-ttu-id="698ac-224">過去的原罪</span><span class="sxs-lookup"><span data-stu-id="698ac-224">The sins of the past</span></span>
<span data-ttu-id="698ac-225">許多情況下，進行不良選擇的原因來自于 (1) 不知道服務的運作方式， (2) 嘗試遵循在採用雲端之前所撰寫的公司原則，而 (3) 安全性小組，他們可能不會輕易相信有多種方式可以達成其目標。</span><span class="sxs-lookup"><span data-stu-id="698ac-225">Many times, the reason bad choices are made comes from a combination of (1) not knowing how the service works, (2) trying to adhere to company policies that were written before adopting the cloud, and (3) security teams who may not be easily convinced that there’s more than one way to accomplish their goals.</span></span> <span data-ttu-id="698ac-226">但願上述及下列連結將協助您使用第一個。</span><span class="sxs-lookup"><span data-stu-id="698ac-226">Hopefully the above, and the links below, will help with the first.</span></span> <span data-ttu-id="698ac-227">必須有執行的資助，才可超過第二個。</span><span class="sxs-lookup"><span data-stu-id="698ac-227">Executive sponsorship may be required to get past the second.</span></span> <span data-ttu-id="698ac-228">解決安全性原則的目標，而不是其方法，可協助第三個。</span><span class="sxs-lookup"><span data-stu-id="698ac-228">Addressing the security policies’ goals, rather than their methods, helps with the third.</span></span> <span data-ttu-id="698ac-229">從設定內容仲裁、DLP 到資訊保護、端點驗證到零天威脅的條件式存取，任何最終目標合理的安全性原則都可以利用 Office 365 中提供的功能來完成，而且不會對內部部署網路齒輪、強制 VPN 隧道及 TLS 中斷及檢查產生任何相依性。</span><span class="sxs-lookup"><span data-stu-id="698ac-229">From conditional access to content moderation, DLP to information protection, endpoint validation to zero-day threats — any end goal a reasonable security policy may have can be accomplished with what is available in Office 365, and without any dependency upon on-premises network gear, forced VPN tunnels, and TLS break and inspect.</span></span> 

<span data-ttu-id="698ac-230">其他情況下，在組織開始移至雲端之前所調整和購買的硬體，只是無法擴充以處理新的流量模式和載入。</span><span class="sxs-lookup"><span data-stu-id="698ac-230">Other times, hardware that was sized and purchased before the organization started to move to the cloud simply cannot be scaled up to handle the new traffic patterns and loads.</span></span> <span data-ttu-id="698ac-231">如果您真的必須透過單一出局點路由傳送所有流量，以及/或 proxy，請先準備好升級網路設備和頻寬。</span><span class="sxs-lookup"><span data-stu-id="698ac-231">If you truly must route all traffic through a single egress point, and/or proxy it, be prepared to upgrade network equipment and bandwidth accordingly.</span></span> <span data-ttu-id="698ac-232">小心監視兩者上的使用狀況，因為隨著以上的使用者，經驗不會變慢。</span><span class="sxs-lookup"><span data-stu-id="698ac-232">Carefully monitor utilization on both, as the experience won’t diminish slowly as more users onboard.</span></span> <span data-ttu-id="698ac-233">所有人都會順利進入，直到到達問題點為止，所有人都會受到影響。</span><span class="sxs-lookup"><span data-stu-id="698ac-233">Everything will be fine until the tipping point is reached, then everyone suffers.</span></span> 

## <a name="exceptions-to-the-rules"></a><span data-ttu-id="698ac-234">規則的例外狀況</span><span class="sxs-lookup"><span data-stu-id="698ac-234">Exceptions to the rules</span></span>

<span data-ttu-id="698ac-235">如果您的組織需要 [租使用者限制](https://docs.microsoft.com/azure/active-directory/manage-apps/tenant-restrictions)，您必須使用具有 TLS 中斷的 proxy，並檢查以強制透過 proxy 執行某些流量，但是您不需要強制所有流量透過它。</span><span class="sxs-lookup"><span data-stu-id="698ac-235">If your organization requires [tenant restrictions](https://docs.microsoft.com/azure/active-directory/manage-apps/tenant-restrictions), you’ll need to use a proxy with TLS break and inspect to  force some traffic through the proxy, but you don’t have to force all traffic through it.</span></span>  <span data-ttu-id="698ac-236">這不是全部或任何的主張，所以請注意 proxy 必須修改的內容。</span><span class="sxs-lookup"><span data-stu-id="698ac-236">It’s not an all or nothing proposition, so pay attention to what does need to be modified by the proxy.</span></span> 

<span data-ttu-id="698ac-237">如果您要允許分割分割，但同時使用 proxy 進行一般 web 流量，請確定您的 PAC 檔案會定義必須直接走向的內容，以及如何為透過 VPN 隧道定義的有趣流量定義。</span><span class="sxs-lookup"><span data-stu-id="698ac-237">If you are going to permit split tunneling but also use a proxy for general web traffic, make sure your PAC file defines what must go direct as well as how you define interesting traffic for what goes through the VPN tunnel.</span></span> <span data-ttu-id="698ac-238">我們會提供範例 PAC 檔案 [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) ，讓這項管理工作變得更容易。</span><span class="sxs-lookup"><span data-stu-id="698ac-238">We offer sample PAC files at [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) that will make this easier to manage.</span></span>

## <a name="conclusion"></a><span data-ttu-id="698ac-239">總結</span><span class="sxs-lookup"><span data-stu-id="698ac-239">Conclusion</span></span>

<span data-ttu-id="698ac-240">成千上萬的組織（包括幾乎所有的《財富500」）都會針對其使命至關重要的功能使用 Office 365。</span><span class="sxs-lookup"><span data-stu-id="698ac-240">Tens of thousands of organizations, including almost all the Fortune 500, use Office 365 everyday for their mission critical functions.</span></span> <span data-ttu-id="698ac-241">它們會安全地進行，也可以透過網際網路進行。</span><span class="sxs-lookup"><span data-stu-id="698ac-241">They do so securely, and they do so over the Internet.</span></span>

 <span data-ttu-id="698ac-242">不論您在玩什麼樣的安全性目標，都有沒有必要的方法可讓您完成，不需要 VPN 連線、proxy 伺服器、TLS 中斷及檢查或集中式網際網路出口，以盡可能快地讓使用者的流量從您的網路和我們的流量中取得，而不論您的網路是公司總部，還是一部遠端辦公室。，或該使用者在家運作。</span><span class="sxs-lookup"><span data-stu-id="698ac-242">No matter what security goals you have in play, there are ways to accomplish them that don’t require VPN connections, proxy servers, TLS break and inspect, or centralized Internet egress to get your users’ traffic off your network and on to ours as quickly as you can, which provides the best performance, whether your network is the company headquarters, a remote office, or that user working at home.</span></span> <span data-ttu-id="698ac-243">我們的指導方針取決於如何建立 Office 365 服務，以確保安全且性能的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="698ac-243">Our guidance is based on how the Office 365 services are built and to ensure a secure and performant user experience.</span></span>

## <a name="further-reading"></a><span data-ttu-id="698ac-244">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="698ac-244">Further reading</span></span>

[<span data-ttu-id="698ac-245">Office 365 網路連接原則</span><span class="sxs-lookup"><span data-stu-id="698ac-245">The Office 365 Network Connectivity Principles</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles)

[<span data-ttu-id="698ac-246">Office 365 URL 與 IP 位址範圍</span><span class="sxs-lookup"><span data-stu-id="698ac-246">Office 365 URLs and IP address ranges</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/urls-and-ip-address-ranges)

[<span data-ttu-id="698ac-247">管理 Office 365 端點</span><span class="sxs-lookup"><span data-stu-id="698ac-247">Managing Office 365 endpoints</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/managing-office-365-endpoints)

[<span data-ttu-id="698ac-248">Office 365 IP 位址和 URL Web 服務</span><span class="sxs-lookup"><span data-stu-id="698ac-248">Office 365 IP Address and URL Web service</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-ip-web-service)

[<span data-ttu-id="698ac-249">評估 Office 365 的網路連線能力</span><span class="sxs-lookup"><span data-stu-id="698ac-249">Assessing Office 365 network connectivity</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[<span data-ttu-id="698ac-250">Office 365 網路與效能調整</span><span class="sxs-lookup"><span data-stu-id="698ac-250">Office 365 network and performance tuning</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/network-planning-and-performance)

[<span data-ttu-id="698ac-251">評估 Office 365 的網路連線能力</span><span class="sxs-lookup"><span data-stu-id="698ac-251">Assessing Office 365 network connectivity</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[<span data-ttu-id="698ac-252">使用基準與效能歷程記錄進行 Office 365 效能調整</span><span class="sxs-lookup"><span data-stu-id="698ac-252">Office 365 performance tuning using baselines and performance history</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/performance-tuning-using-baselines-and-history)

[<span data-ttu-id="698ac-253">Office 365 的效能疑難排解規劃</span><span class="sxs-lookup"><span data-stu-id="698ac-253">Performance troubleshooting plan for Office 365</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/performance-troubleshooting-plan)

[<span data-ttu-id="698ac-254">內容傳遞網路</span><span class="sxs-lookup"><span data-stu-id="698ac-254">Content Delivery Networks</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/content-delivery-networks)

[<span data-ttu-id="698ac-255">Microsoft 365 連線測試</span><span class="sxs-lookup"><span data-stu-id="698ac-255">Microsoft 365 connectivity test</span></span>](https://connectivity.office.com/)

[<span data-ttu-id="698ac-256">Microsoft 如何建置其快速且可靠的全域網路</span><span class="sxs-lookup"><span data-stu-id="698ac-256">How Microsoft builds its fast and reliable global network</span></span>](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

[<span data-ttu-id="698ac-257">Office 365 網路部落格</span><span class="sxs-lookup"><span data-stu-id="698ac-257">Office 365 Networking blog</span></span>](https://techcommunity.microsoft.com/t5/office-365-networking/bd-p/Office365Networking)

[<span data-ttu-id="698ac-258">使用 VPN 分割隧道的遠端使用者的 Office 365 連線能力</span><span class="sxs-lookup"><span data-stu-id="698ac-258">Office 365 connectivity for remote users using VPN split tunneling</span></span>](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel)


